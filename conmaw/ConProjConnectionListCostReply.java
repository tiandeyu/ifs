/*
 *                 IFS Research & Development
 *
 *  This program is protected by copyright law and by international
 *  conventions. All licensing, renting, lending or copying (including
 *  for private use), and all other use of the program, which is not
 *  expressively permitted by IFS Research & Development (IFS), is a
 *  violation of the rights of IFS. Such violations will be reported to the
 *  appropriate authorities.
 *
 *  VIOLATIONS OF ANY COPYRIGHT IS PUNISHABLE BY LAW AND CAN LEAD
 *  TO UP TO TWO YEARS OF IMPRISONMENT AND LIABILITY TO PAY DAMAGES.
 * ----------------------------------------------------------------------------
 * File                          :
 * Description                   :
 * Notes                         :
 * Other Programs Called :
 * ----------------------------------------------------------------------------
 * Modified    : Automatically generated by IFS/Design
 * ----------------------------------------------------------------------------
 */

//-----------------------------------------------------------------------------
//-----------------------------   Package def  ------------------------------
//-----------------------------------------------------------------------------

package ifs.conmaw;

//-----------------------------------------------------------------------------
//-----------------------------   Import def  ------------------------------
//-----------------------------------------------------------------------------

import java.io.UnsupportedEncodingException;

import ifs.fnd.asp.ASPBlock;
import ifs.fnd.asp.ASPBlockLayout;
import ifs.fnd.asp.ASPBuffer;
import ifs.fnd.asp.ASPCommand;
import ifs.fnd.asp.ASPCommandBar;
import ifs.fnd.asp.ASPConfig;
import ifs.fnd.asp.ASPManager;
import ifs.fnd.asp.ASPPageProvider;
import ifs.fnd.asp.ASPQuery;
import ifs.fnd.asp.ASPRowSet;
import ifs.fnd.asp.ASPTable;
import ifs.fnd.asp.ASPTransactionBuffer;
import ifs.fnd.service.FndException;
import ifs.fnd.service.Util;
import ifs.hzwflw.HzASPPageProviderWf;

//-----------------------------------------------------------------------------
//-----------------------------   Class def  ------------------------------
//-----------------------------------------------------------------------------


public class ConProjConnectionListCostReply extends HzASPPageProviderWf {

   public ConProjConnectionListCostReply(ASPManager mgr, String pagePath) {
      super(mgr, pagePath);
   }
      // TODO Auto-generated constructor stub
      public static boolean DEBUG = Util.isDebugEnabled("ifs.conmaw.ConProjConnectionListCostReply");

      //-----------------------------------------------------------------------------
      //---------- Header Instances created on page creation --------
      //-----------------------------------------------------------------------------

      private ASPBlock headblk;
      private ASPRowSet headset;
      private ASPCommandBar headbar;
      private ASPTable headtbl;
      private ASPBlockLayout headlay;

      //-----------------------------------------------------------------------------
      //---------- Item Instances created on page creation --------
      //-----------------------------------------------------------------------------

      private ASPBlock con_connection_list_line_blk;
      private ASPRowSet con_connection_list_line_set;
      private ASPCommandBar con_connection_list_line_bar;
      private ASPTable con_connection_list_line_tbl;
      private ASPBlockLayout con_connection_list_line_lay;


      //-----------------------------------------------------------------------------
      //------------------------  Construction  ---------------------------
      //-----------------------------------------------------------------------------
      public void run() throws FndException
      {
         super.run();
         ASPManager mgr = getASPManager();
         String comnd; 
         if( mgr.commandBarActivated() ){
            eval(mgr.commandBarFunction());
            comnd = mgr.readValue("__COMMAND");
            if (  "ITEM1.SaveReturn".equals(comnd) ||  "ITEM1.Delete".equals(comnd) )
               headset.refreshAllRows();
            else if("ITEM1.SaveNew".equals(comnd))
               headset.refreshAllRows();
         }
         else if(mgr.dataTransfered())
            okFind();
         else if( !mgr.isEmpty(mgr.getQueryStringValue("SEARCH")) )
            okFind();
         else if( !mgr.isEmpty(mgr.getQueryStringValue("ID")) )
            okFind();
         else if( !mgr.isEmpty(mgr.getQueryStringValue("VALIDATE")) )
            validate();
         else
            okFind();

         adjust();
      }
      //-----------------------------------------------------------------------------
      //------------------------  Command Bar functions  ---------------------------
      //-----------------------------------------------------------------------------

      public void okFind()
      {
         ASPManager mgr = getASPManager();
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPQuery q;

         mgr.createSearchURL(headblk);
         q = trans.addQuery(headblk);
         q.includeMeta("ALL");
         q.addWhereCondition("CON_LIST_TYPE_DB = 'COSTREPLY'");
         if(mgr.dataTransfered())
            q.addOrCondition(mgr.getTransferedData());
         mgr.querySubmit(trans,headblk);
         if (  headset.countRows() == 0 )
         {
            mgr.showAlert("CONPROJCONNECTIONLISTNODATA: No data found.");
            headset.clear();
         }
         else
         {
            okFindITEM1();
         }

      }



      public void countFind()
      {
         ASPManager mgr = getASPManager();
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPQuery q;

         q = trans.addQuery(headblk);
         q.setSelectList("to_char(count(*)) N");
         mgr.submit(trans);
         headlay.setCountValue(toInt(headset.getValue("N")));
         headset.clear();
      }



      public void newRow()
      {
         ASPManager mgr = getASPManager();
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPBuffer data;
         ASPCommand cmd;

         cmd = trans.addEmptyCommand("HEAD","CON_PROJ_CONNECTION_LIST_API.New__",headblk);
         cmd.setOption("ACTION","PREPARE");
         trans = mgr.perform(trans);
         data = trans.getBuffer("HEAD/DATA");
         
         data.setFieldItem("CON_LIST_TYPE_DB", "COSTREPLY");
         data.setFieldItem("IS_VALID", "FALSE");
         data.setFieldItem("HAS_FEEDBACK", "FALSE");
         
         headset.addRow(data);
      }


      //-----------------------------------------------------------------------------
      //------------------------  Item block cmd bar functions  ---------------------------
      //-----------------------------------------------------------------------------


      public void okFindITEM1()
      {
         ASPManager mgr = getASPManager();
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPQuery q;
         int headrowno;

         q = trans.addQuery(con_connection_list_line_blk);
         q.addWhereCondition("PROJ_NO = ? AND ID = ?");
         q.addParameter("PROJ_NO", headset.getValue("PROJ_NO"));
         q.addParameter("ID", headset.getValue("ID"));
         q.includeMeta("ALL");
         headrowno = headset.getCurrentRowNo();
         mgr.querySubmit(trans,con_connection_list_line_blk);
         headset.goTo(headrowno);
      }
      public void newRowITEM1()
      {
         ASPManager mgr = getASPManager();
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPCommand cmd;
         ASPBuffer data;

         
         cmd = trans.addEmptyCommand("ITEM1","CON_CONNECTION_LIST_LINE_API.New__",con_connection_list_line_blk);
         cmd.setOption("ACTION","PREPARE");
         cmd.setParameter("ITEM0_PROJ_NO", headset.getValue("PROJ_NO"));
         cmd.setParameter("ITEM0_ID", headset.getValue("ID"));
         cmd.setParameter("ITEM0_CONTRACT_ID", headset.getValue("CONTRACT_ID"));
         trans = mgr.perform(trans);
         data = trans.getBuffer("ITEM1/DATA");
         con_connection_list_line_set.addRow(data);
      }


      //-----------------------------------------------------------------------------
      //------------------------  Predefines Head ---------------------------
      //-----------------------------------------------------------------------------

      public void  preDefine()
      {
         ASPManager mgr = getASPManager();

         headblk = mgr.newASPBlock("MAIN");
         headblk.addField("OBJID").
                 setHidden();
         headblk.addField("OBJVERSION").
                 setHidden();
         headblk.addField("PROJ_NO").
                 setDynamicLOV("GENERAL_PROJECT").
                 setInsertable().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYPROJNO: Proj No").
                 setSize(30);
         headblk.addField("GENERAL_PROJECT_PROJ_DESC").
                 setFunction("GENERAL_PROJECT_API.GET_PROJ_DESC (:PROJ_NO)").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYGENERALPROJECTPROJDESC: General Project Proj Desc").
                 setSize(30).
                 setReadOnly();
         
         mgr.getASPField("PROJ_NO").setValidation("GENERAL_PROJECT_PROJ_DESC");
         
         headblk.addField("LIST_NO").
                 setInsertable().
                 setDynamicLOV("CON_PROJ_CONNECTION_LIST_LOV","PROJ_NO").
                 setLOVProperty("WHERE", " (CON_LIST_TYPE_DB = 'COSTOWNER' OR  CON_LIST_TYPE_DB = 'COSTORG') AND STATUS = '2' AND IS_VALID = 'TRUE' AND HAS_FEEDBACK = 'FALSE' ").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYLISTNO: List No").  
                 setSize(30).
                 setCustomValidation("PROJ_NO,LIST_NO", "LIST_NO_DESC,CONTRACT_ID,CONTRACT_NAME,BOOK_NO,BOOK_NAME,SUB_PROJ_NO,REAL_ESTIMATE_COST,SEND_TO,SEND_TO_NAME,COPY_TO,COPY_TO_NAME");
         headblk.addField("LIST_NO_DESC").
                 setReadOnly().
                 setFunction("CON_PROJ_CONNECTION_LIST_API.Get_List_No ( :PROJ_NO,:LIST_NO)").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYLISTNODESC: List No Desc").
                 setSize(30);
         headblk.addField("REPLY_LIST_NO").
                 setInsertable().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYREPLYLISTNO: Reply List No").
                 setSize(30);
         headblk.addField("LIST_NAME").
                 setInsertable().
                 setMandatory().
                 setWfProperties().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYLISTNAME: List Name").
                 setSize(30);
         headblk.addField("CONTRACT_ID").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCONTRACTID: Contract Id").
                 setSize(30).
                 setReadOnly();
         headblk.addField("CONTRACT_NAME").
                 setFunction("PROJECT_CONTRACT_API.Get_Contract_Desc (:PROJ_NO,CON_PROJ_CONNECTION_LIST_API.Get_Contract_Id ( :PROJ_NO,:LIST_NO))").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCONTRACTNNAME: Contract Name").
                 setSize(30).
                 setReadOnly();

         headblk.addField("BOOK_NO").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYBOOKNO: Book No").
                 setSize(30).
                 setFunction("CON_PROJ_CONNECTION_LIST_API.Get_Book_No ( :PROJ_NO,:LIST_NO)").
                 setReadOnly();

         headblk.addField("BOOK_NAME").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYBOOKNAME: Book Name").
                 setSize(30).
                 setFunction("Doc_Booklet_Api.Get_Booklet_Name(CON_PROJ_CONNECTION_LIST_API.Get_Book_No ( :PROJ_NO,:LIST_NO))").
                 setReadOnly();
         headblk.addField("REAL_ESTIMATE_COST").
                 setReadOnly().
                 setFunction("CON_CONNECTION_LIST_LINE_API.Get_All_Cost_Estimate( :PROJ_NO, :LIST_NO)").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYREALESTIMATECOST: Real Estimate Cost").
                 setSize(30);
         headblk.addField("ESTIMATE_COST").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYESTIMATECOST: Estimate Cost").
                 setSize(30).
                 setReadOnly();

         headblk.addField("ACTUAL_COST").
                 setHidden().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYACTUALCOST: Actual Cost").
                 setSize(30);
         headblk.addField("SUB_PROJ_NO").
                 setDefaultNotVisible().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYSUBPROJNO: Sub Proj No").
                 setSize(30).
                 setFunction("CON_PROJ_CONNECTION_LIST_API.Get_Sub_Proj_No ( :PROJ_NO,:LIST_NO)").
                 setReadOnly();

         headblk.addField("ID").
                 setInsertable().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYID: Id").
                 setSize(30);
         //Cost Only Fields
         headblk.addField("IS_VALID").
                 setReadOnly().
                 setLabel("CONPROJCONNECTIONLISTCOSTORGISVALID: Is Valid").
                 setCheckBox("FALSE,TRUE").
                 setSize(30);
         headblk.addField("HAS_FEEDBACK").
                 setHidden().
                 setLabel("CONPROJCONNECTIONLISTCOSTORGHASFEEDBACK: Has Feedback").
                 setCheckBox("FALSE,TRUE").
                 setSize(30);
         headblk.addField("FEEDBACK_NO").
                 setReadOnly().
                 setLabel("CONPROJCONNECTIONLISTCOSTORGFEEDBACKNO: Feedback No").
                 setSize(30);
            
        
         headblk.addField("CREATE_PERSON").
                 setInsertable().
                 setDefaultNotVisible().
                 setDynamicLOV("PERSON_INFO").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCREATEPERSON: Create Person").
                 setSize(30).
                 setCustomValidation("CREATE_PERSON", "CREATE_PERSON_NAME,START_ORG,START_ORG_NAME");
         headblk.addField("CREATE_PERSON_NAME").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCREATEPERSONNAME: Create Person Name").
                 setSize(30).
                 setFunction("PERSON_INFO_API.GET_NAME ( :CREATE_PERSON)").
                 setReadOnly();
         
         headblk.addField("START_ORG").
                 setDynamicLOV("GENERAL_ZONE", "PROJ_NO").
                 setDefaultNotVisible().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYSTARTORG: Start Org").
                 setSize(30);
 
         headblk.addField("START_ORG_NAME").
                 setFunction("GENERAL_ZONE_API.Get_Zone_Desc(:START_ORG)").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYSTARTORGNAME: Start Org Name").
                 setSize(30).
                 setReadOnly();
         
         mgr.getASPField("START_ORG").setValidation("START_ORG_NAME");
 
         headblk.addField("CONTRACT_NO").
                 setInsertable().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCONTRACTNO: Contract No").
                 setSize(30); 
         headblk.addField("CREATE_TIME","Date").
                 setInsertable().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCREATETIME: Create Time").
                 setSize(30);
         headblk.addField("IS_REPLY").
                 setInsertable().
                 setCheckBox("0,1").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYISREPLY: Is Reply").
                 setSize(30);
         headblk.addField("SEND_TO").
                 setReadOnly().
                 setDynamicLOV("GENERAL_ORGANIZATION_LOV", "PROJ_NO").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYSENDTO: Send To").
                 setSize(30);
         headblk.addField("SEND_TO_NAME").
                 setFunction("GENERAL_ORGANIZATION_API.Get_Org_Desc( :SEND_TO)").
                 setReadOnly().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYSENDTONAME: Send To Name").
                 setSize(30);
         mgr.getASPField("SEND_TO").setValidation("SEND_TO_NAME");
         headblk.addField("COPY_TO").
                 setReadOnly().
                 setDynamicLOV("GENERAL_ORGANIZATION_LOV", "PROJ_NO").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCOPYTO: Copy To").
                 setSize(30);
         headblk.addField("COPY_TO_NAME").
                 setFunction("GENERAL_ORGANIZATION_API.Get_Org_Desc(:COPY_TO)").
                 setReadOnly().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCOPYTONAME: Copy To Name").
                 setSize(30);
         mgr.getASPField("COPY_TO").setValidation("COPY_TO_NAME");      
         headblk.addField("STATUS").
                 setHidden().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYSTATUS: Status").
                 setSize(30);
         headblk.addField("STATUS_DESC").
                 setReadOnly().
                 setFunction("FLOW_STATUS_API.Get_Status_Desc (:STATUS)").
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYSTATUSDESC: Status Desc").
                 setSize(30);
         headblk.addField("EXE_CONDITION").
                 setInsertable().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYEXECONDITION: Exe Condition").
                 setSize(130).
                 setHeight(5);
         headblk.addField("NOTE").
                 setInsertable().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYNOTE: Note").
                 setSize(130).
                 setHeight(5);
         
         headblk.addField("CONTENT").
                 setInsertable().
                 setLabel("CONPROJCONNECTIONLISTCOSTREPLYCONTENT: Content").
                 setSize(130).
                 setHeight(5);
         headblk.addField("CON_LIST_TYPE_DB").setHidden();
         
         headblk.setView("CON_PROJ_CONNECTION_LIST");
         headblk.defineCommand("CON_PROJ_CONNECTION_LIST_API","New__,Modify__,Remove__");
         headset = headblk.getASPRowSet();
         headbar = mgr.newASPCommandBar(headblk);
         headbar.addCustomCommand("printReport", "CONPROJCONNECTIONLISTCOSTREPLYREPORT: Print Proj Connection List Cost Reply Report...");
         headbar.addCustomCommand("setValid", "CONPROJCONNECTIONLISTSETVALID: Set Valid");
         headbar.addCommandValidConditions("setValid", "IS_VALID", "Disable", "TRUE");
         headtbl = mgr.newASPTable(headblk);
         headtbl.setTitle("CONPROJCONNECTIONLISTTBLHEAD: Con Proj Connection List Cost");
         headtbl.enableRowSelect();
         headtbl.setWrap();
         headlay = headblk.getASPBlockLayout();
         
         headlay.setSimple("CONTRACT_NAME");
         headlay.setSimple("BOOK_NAME");
         headlay.setSimple("CREATE_PERSON_NAME");
         headlay.setSimple("GENERAL_PROJECT_PROJ_DESC");
         headlay.setSimple("START_ORG_NAME");
         headlay.setSimple("LIST_NO_DESC");
         headlay.setSimple("SEND_TO_NAME");
         headlay.setSimple("COPY_TO_NAME");
         headlay.setDataSpan("NOTE", 5);
         headlay.setDataSpan("EXE_CONDITION", 5);
         headlay.setDataSpan("STATUS_DESC", 5);
         headlay.setDefaultLayoutMode(headlay.MULTIROW_LAYOUT);
    


         con_connection_list_line_blk = mgr.newASPBlock("ITEM1");
         con_connection_list_line_blk.addField("ITEM0_OBJID").
                                      setHidden().
                                      setDbName("OBJID");
         con_connection_list_line_blk.addField("ITEM0_OBJVERSION").
                                      setHidden().
                                      setDbName("OBJVERSION");
         con_connection_list_line_blk.addField("ITEM0_PROJ_NO").
                                      setDbName("PROJ_NO").                           
                                      setInsertable().
                                      setHidden().
                                      setLabel("CONCONNECTIONLISTLINEITEM0PROJNO: Proj No").
                                      setSize(50);
         con_connection_list_line_blk.addField("ITEM0_CONTRACT_ID").
                                      setDbName("CONTRACT_ID").
                                      setInsertable().
                                      setHidden().
                                      setLabel("CONCONNECTIONLISTLINEITEM0CONTRACTID: Contract Id").
                                      setSize(30);
         con_connection_list_line_blk.addField("ITEM0_ID").
                                      setDbName("ID").
                                      setInsertable().
                                      setHidden().  
                                      setLabel("CONCONNECTIONLISTLINEITEM0ID: Id").
                                      setSize(200);
         con_connection_list_line_blk.addField("LINE_NO").
                                      setReadOnly().
                                      setDynamicLOV("PROJECT_CONTRACT_ITEM","PROJ_NO,CONTRACT_ID"). 
                                      setLabel("CONCONNECTIONLISTLINELINENO: Line No").
                                      setSize(30).
                                      setCustomValidation("PROJ_NO,CONTRACT_ID,LINE_NO", "JOB_LIST_CONTENT,UNIT,PRICE,BUDGET_LINE_NO,BUDGET_NAME,BUDGET_AMOUNT,CONTRACT_SIGN_AMOUNT");
         con_connection_list_line_blk.addField("JOB_LIST_CONTENT").
                                      setReadOnly().
                                      setLabel("CONCONNECTIONLISTLINEJOBLISTCONTENT: Job List Content").
                                      setSize(30);
         con_connection_list_line_blk.addField("QUANTITIES","Number","#0.00").
                                      setInsertable().
                                      setMandatory().
                                      setCustomValidation("QUANTITIES,PRICE","COST_ESTIMATE").
                                      setLabel("CONCONNECTIONLISTLINEQUANTITIES: Quantities").
                                      setSize(30);
         con_connection_list_line_blk.addField("UNIT").
                                      setReadOnly().
                                      setLabel("CONCONNECTIONLISTLINEUNIT: Unit").
                                      setSize(30);
         con_connection_list_line_blk.addField("PRICE","Money","#0.00").
                                      setInsertable().
                                      setLabel("CONCONNECTIONLISTLINEPRICE: Price").
                                      setCustomValidation("PRICE,QUANTITIES","COST_ESTIMATE").
                                      setSize(30);      
         con_connection_list_line_blk.addField("COST_ESTIMATE","Money","#0.00").
                                      setReadOnly().
                                      setLabel("CONCONNECTIONLISTLINECOSTESTIMATE: Cost Estimate").
                                      setSize(30);
         con_connection_list_line_blk.addField("BUDGET_NO").
                                      setReadOnly().
                                      setFunction("PROJECT_CONTRACT_ITEM_API.Get_Budget_No (:PROJ_NO , :CONTRACT_ID , :JOB_LIST_CONTENT)").
                                      setLabel("CONCONNECTIONLISTLINEBUDGETNO: Budget No 2").
                                      setSize(30);
         con_connection_list_line_blk.addField("BUDGET_LINE_NO").
                                      setReadOnly().
                                      setDynamicLOV("PROJECT_BUDGET_LINE").
                                      setCustomValidation("PROJ_NO,BUDGET_LINE_NO", "BUDGET_NAME").
                                      setLabel("CONCONNECTIONLISTLINEBUDGETLINENO: Budget No").
                                      setSize(30);
         con_connection_list_line_blk.addField("BUDGET_NAME").
                                      setReadOnly().
                                      setFunction("PROJECT_BUDGET_LINE_API.Get_Budget_Name (:PROJ_NO , :BUDGET_LINE_NO)").
                                      setLabel("CONCONNECTIONLISTLINEBUDGETNAME: Budget Name").
                                      setSize(30);
         con_connection_list_line_blk.addField("BUDGET_AMOUNT").
                                      setHidden().
                                      setFunction("PROJECT_BUDGET_LINE_API.Get_Amount (:PROJ_NO,PROJECT_CONTRACT_ITEM_API.Get_Budget_No (:PROJ_NO , :CONTRACT_ID , :JOB_LIST_CONTENT),PROJECT_CONTRACT_ITEM_API.Get_Budget_Line_No (:PROJ_NO ,:CONTRACT_ID ,:JOB_LIST_CONTENT))").
                                      setLabel("CONCONNECTIONLISTLINEBUDGETAMOUNT: Budget Amount ").
                                      setSize(30);
         con_connection_list_line_blk.addField("CONTRACT_SIGN_AMOUNT").
                                      setReadOnly().
                                      setFunction("PROJECT_CONTRACT_API.Cal_Ori_Contract_Total(:PROJ_NO, :CONTRACT_ID)").
                                      setLabel("CONCONNECTIONLISTLINECONTRACTSIGNAMOUNT: Contract Sign Amount").
                                      setSize(30);
         con_connection_list_line_blk.addField("ITEM_NO").
                                      setInsertable().
                                      setLabel("CONCONNECTIONLISTLINEITEMNO: No").
                                      setSize(30);
         con_connection_list_line_blk.setView("CON_CONNECTION_LIST_LINE");
         con_connection_list_line_blk.defineCommand("CON_CONNECTION_LIST_LINE_API","New__,Modify__,Remove__");
         con_connection_list_line_blk.setMasterBlock(headblk);
         con_connection_list_line_set = con_connection_list_line_blk.getASPRowSet();
         con_connection_list_line_bar = mgr.newASPCommandBar(con_connection_list_line_blk);
         con_connection_list_line_bar.defineCommand(con_connection_list_line_bar.OKFIND, "okFindITEM1");
         con_connection_list_line_bar.defineCommand(con_connection_list_line_bar.NEWROW, "newRowITEM1");
         con_connection_list_line_tbl = mgr.newASPTable(con_connection_list_line_blk);
         con_connection_list_line_tbl.setTitle("CONCONNECTIONLISTLINEITEMHEAD1: ConConnectionListLine");
         con_connection_list_line_tbl.enableRowSelect();
         con_connection_list_line_tbl.setWrap();
         con_connection_list_line_lay = con_connection_list_line_blk.getASPBlockLayout();
         con_connection_list_line_lay.setDefaultLayoutMode(con_connection_list_line_lay.MULTIROW_LAYOUT);

      }

    //Report  Function
      public void  printReport() throws FndException, UnsupportedEncodingException
      {
       ASPManager mgr = getASPManager();
       ASPConfig cfg = getASPConfig();
       String URL=cfg.getParameter("APPLICATION/RUNQIAN/SERVER_URL");
       if (headlay.isMultirowLayout())
          headset.goTo(headset.getRowSelected());
       if (headset.countRows()>0 )
             {   
                String proj_no = headset.getValue("PROJ_NO");
                String id = headset.getValue("ID");
                 appendDirtyJavaScript("window.open('"+URL+"/showReport.jsp?raq=RptConProjConnectionListCostReply.raq&proj_no="+proj_no+"&id="+id
                   + "','_blank','height=600, width=780, top=200, left=350, toolbar=no, menubar=no, scrollbars=yes, resizable=yes,location=no, status=no');");                                
            }
      }


      public void  adjust() throws FndException
      {
         // fill function body
         ASPManager mgr = getASPManager();
         super.adjust();
         mgr.getASPField("ID").setHidden();
         mgr.getASPField("IS_REPLY").setHidden();
         mgr.getASPField("CONTENT").setHidden();
         mgr.getASPField("CONTRACT_NO").setHidden();
         mgr.getASPField("ITEM0_PROJ_NO").setHidden();
         mgr.getASPField("ITEM0_ID").setHidden();
         mgr.getASPField("ITEM_NO").setHidden();
         mgr.getASPField("ITEM0_CONTRACT_ID").setHidden();
         mgr.getASPField("BUDGET_NO").setHidden();
         mgr.getASPField("CONTRACT_SIGN_AMOUNT").setHidden();
         if(headset.countRows() > 0 && headlay.isSingleLayout()){
            con_connection_list_line_bar.disableCommand(headbar.DELETE);
            con_connection_list_line_bar.disableCommand(headbar.NEWROW);
         }
         if(headset.countRows() > 0 && headlay.isMultirowLayout()){
            headbar.disableCommand("setValid");
         }
      }
      
      public void setValid(){
         ASPManager mgr = getASPManager();
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPCommand cmd;
         cmd = trans.addCustomCommand("PROJ_NO,ID,LIST_NO","CON_PROJ_CONNECTION_LIST_API.SET_VALID");
         cmd.setParameter("PROJ_NO", headset.getValue("PROJ_NO"));
         cmd.setParameter("ID", headset.getValue("ID"));
         cmd.setParameter("LIST_NO", headset.getValue("LIST_NO"));
         trans = mgr.perform(trans);
         cmd.clear();
         okFind();
      }

      //-----------------------------------------------------------------------------
      //------------------------  Presentation functions  ---------------------------
      //-----------------------------------------------------------------------------
      public void validate() {
         ASPManager mgr = getASPManager();
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPCommand cmd;
         
         ASPTransactionBuffer trans1 = mgr.newASPTransactionBuffer();
         ASPCommand cmd1;
         ASPTransactionBuffer trans2 = mgr.newASPTransactionBuffer();
         ASPCommand cmd2;
         ASPTransactionBuffer trans3 = mgr.newASPTransactionBuffer();
         ASPCommand cmd3;
         String val = mgr.readValue("VALIDATE");
         String txt = "";
         String PERSONMAE = "";
         String STARTORG = "";
         String STARTORGNAME = "";
         String ITEMCONTRACTID = "";
         String CONTRACTID = "";
         String BOOKNO = "";
         String BOOKNAME = "";
         String SUBPROJNO = "";
         String PRICE = "";
         String BUDGETNO = "";
         String BUDGETLINENO = "";
         String BUDGETNAME = "";
         String UNIT = "";
         String BUDGETAMOUNT = "";
         String CONTRACTSIGNAMOUNT = "";
         String JOBLISTCONTENT = "";
         String ID1 = "";
         String  contractName = "";
         String QUANTITIES = "";
         String ACTUALCOSTS = "";
         String LISTNODESC = "";
         String REALESTIMATECOST = "";
         String send_to = "";
         String copy_to = "";
         String send_to_name = "";
         String copy_to_name = "";
         float tempValue;
         
         if ("CREATE_PERSON".equals(val)) {
            
            
            cmd1 = trans1.addCustomFunction("GETSTARTORG", 
                  "PERSON_ZONE_API.Get_Person_Def_Zone", "START_ORG");
          cmd1.addParameter("CREATE_PERSON");
          
          trans1 = mgr.validate(trans1);
          STARTORG = trans1.getValue("GETSTARTORG/DATA/START_ORG");
          
          
          cmd = trans.addCustomFunction("GETCREATEPERSONNAME", 
                "PERSON_INFO_API.GET_NAME", "CREATE_PERSON_NAME");
          cmd.addParameter("CREATE_PERSON");
          
          cmd = trans.addCustomFunction("GETSTARTORGNAME", 
                "GENERAL_ZONE_API.Get_Zone_Desc", "START_ORG_NAME");
          cmd.addParameter("START_ORG",STARTORG);
          
          trans = mgr.validate(trans);
          
          PERSONMAE = trans.getValue("GETCREATEPERSONNAME/DATA/CREATE_PERSON_NAME");
          STARTORGNAME = trans.getValue("GETSTARTORGNAME/DATA/START_ORG_NAME");

          txt = ((mgr.isEmpty(PERSONMAE)) ? "" : PERSONMAE )+ "^" +((mgr.isEmpty(STARTORG)) ? "" : STARTORG )+ "^" + ((mgr.isEmpty(STARTORGNAME)) ? "" : STARTORGNAME )+ "^";
          
            mgr.responseWrite(txt);
         }
         else if ("LIST_NO".equals(val)) {
            cmd = trans.addCustomFunction("GETLISTNODESC", 
                  "CON_PROJ_CONNECTION_LIST_API.Get_List_No", "LIST_NO_DESC");
            cmd.addParameter("PROJ_NO,LIST_NO");
            
            cmd = trans.addCustomFunction("GETCONTRACTID", 
                  "CON_PROJ_CONNECTION_LIST_API.Get_Contract_Id", "CONTRACT_ID");
            cmd.addParameter("PROJ_NO,LIST_NO");
            
            cmd = trans.addCustomFunction("GETBOOKNO", 
                  "CON_PROJ_CONNECTION_LIST_API.Get_Book_No", "BOOK_NO");
            cmd.addParameter("PROJ_NO,LIST_NO");
            
            cmd = trans.addCustomFunction("GETSUBPROJNO", 
                  "CON_PROJ_CONNECTION_LIST_API.Get_Sub_Proj_No", "SUB_PROJ_NO");
            cmd.addParameter("PROJ_NO,LIST_NO");
            
            cmd = trans.addCustomFunction("GETREALESTIMATECOST", 
                  "CON_CONNECTION_LIST_LINE_API.Get_All_Cost_Estimate", "REAL_ESTIMATE_COST");
            cmd.addParameter("PROJ_NO,LIST_NO");
            
            cmd = trans.addCustomFunction("GETSENDTO", 
                  "CON_PROJ_CONNECTION_LIST_API.GET_SEND_TO", "SEND_TO");
            cmd.addParameter("PROJ_NO,LIST_NO");
            
            cmd = trans.addCustomFunction("GETCOPYTO", 
                  "CON_PROJ_CONNECTION_LIST_API.GET_COPY_TO", "COPY_TO");
            cmd.addParameter("PROJ_NO,LIST_NO");
            
            trans = mgr.validate(trans);
            
            LISTNODESC = trans.getValue("GETLISTNODESC/DATA/LIST_NO_DESC");
            CONTRACTID = trans.getValue("GETCONTRACTID/DATA/CONTRACT_ID");
            BOOKNO = trans.getValue("GETBOOKNO/DATA/BOOK_NO");
            SUBPROJNO = trans.getValue("GETSUBPROJNO/DATA/SUB_PROJ_NO");
            REALESTIMATECOST = trans.getValue("GETREALESTIMATECOST/DATA/REAL_ESTIMATE_COST");
            send_to = trans.getValue("GETSENDTO/DATA/SEND_TO");
            copy_to = trans.getValue("GETCOPYTO/DATA/COPY_TO");
            
            cmd1 = trans1.addCustomFunction("GETBOOKNAME", 
                  "Doc_Booklet_Api.Get_Booklet_Name", "BOOK_NAME");
            cmd1.addParameter("BOOK_NO",BOOKNO);
            
            cmd1 = trans1.addCustomFunction("GETCONTRACTNAME", 
                  "PROJECT_CONTRACT_API.Get_Contract_Desc", "CONTRACT_NAME");
            cmd1.addParameter("PROJ_NO");
            cmd1.addParameter("CONTRACT_ID",CONTRACTID);
            
            cmd1 = trans1.addCustomFunction("GETSENDTONAME", 
                  "GENERAL_ORGANIZATION_API.GET_ORG_DESC", "SEND_TO_NAME");
            cmd1.addParameter("SEND_TO",send_to);
            
            cmd1 = trans1.addCustomFunction("GETCOPYTONAME", 
                  "GENERAL_ORGANIZATION_API.GET_ORG_DESC", "COPY_TO_NAME");
            cmd1.addParameter("COPY_TO",copy_to);
            
            
            
            
            trans1 = mgr.validate(trans1);
            BOOKNAME = trans1.getValue("GETBOOKNAME/DATA/BOOK_NAME");
            contractName = trans1.getValue("GETCONTRACTNAME/DATA/CONTRACT_NAME");
            send_to_name = trans1.getValue("GETSENDTONAME/DATA/SEND_TO_NAME");
            copy_to_name = trans1.getValue("GETCOPYTONAME/DATA/GETCOPYTONAME");
            

            txt = ((mgr.isEmpty(LISTNODESC)) ? "" : LISTNODESC )+ "^" + 
                  ((mgr.isEmpty(CONTRACTID)) ? "" : CONTRACTID )+ "^" + 
                  ((mgr.isEmpty(contractName)) ? "" : contractName )+ "^" + 
                  ((mgr.isEmpty(BOOKNO)) ? "" : BOOKNO )+ "^" + 
                  ((mgr.isEmpty(BOOKNAME)) ? "" : BOOKNAME )+ "^" + 
                  ((mgr.isEmpty(SUBPROJNO)) ? "" : SUBPROJNO )+ "^" + 
                  ((mgr.isEmpty(REALESTIMATECOST)) ? "" : REALESTIMATECOST )+ "^" +
                  ((mgr.isEmpty(send_to)) ? "" : send_to )+ "^" +
                  ((mgr.isEmpty(send_to_name)) ? "" : send_to_name )+ "^" +
                  ((mgr.isEmpty(copy_to)) ? "" : copy_to )+ "^" +
                  ((mgr.isEmpty(send_to_name)) ? "" : send_to_name )+ "^" ;
            
            mgr.responseWrite(txt);
         }
         else if("LINE_NO".equals(val)){
            
            cmd1 = trans1.addCustomFunction("GETITEMCONTRACTID", 
                  "CON_PROJ_CONNECTION_LIST_API.Get_Contract_Id", "ITEM0_CONTRACT_ID");
            cmd1.addParameter("ITEM0_PROJ_NO");
            cmd1.addParameter("ITEM0_ID1");  
            
            cmd1 = trans1.addCustomFunction("GETJOBLISTCONTENT", 
                  "CON_CONNECTION_LIST_LINE_API.Get_Job_List_Content", "JOB_LIST_CONTENT");
            cmd1.addParameter("ITEM0_PROJ_NO");
            cmd1.addParameter("ITEM0_ID1"); 
            cmd1.addParameter("LINE_NO");
            
            cmd1 = trans1.addCustomFunction("GETQUANTITIES", 
                  "CON_CONNECTION_LIST_LINE_API.Get_Quantities", "QUANTITIES");
            cmd1.addParameter("ITEM0_PROJ_NO");
            cmd1.addParameter("ITEM0_ID1"); 
            cmd1.addParameter("LINE_NO");
            
            cmd1 = trans1.addCustomFunction("GETCOSTESTIMATE", 
                  "CON_CONNECTION_LIST_LINE_API.Get_Cost_Estimate", "ACTUAL_COSTS");
            cmd1.addParameter("ITEM0_PROJ_NO");
            cmd1.addParameter("ITEM0_ID1"); 
            cmd1.addParameter("LINE_NO");
            
            
            
            
            trans1 = mgr.validate(trans1);
            
            ITEMCONTRACTID = trans1.getValue("GETITEMCONTRACTID/DATA/CONTRACT_ID");
            JOBLISTCONTENT = trans1.getValue("GETJOBLISTCONTENT/DATA/JOB_LIST_CONTENT");
            QUANTITIES = trans1.getValue("GETQUANTITIES/DATA/QUANTITIES");
            ACTUALCOSTS = trans1.getValue("GETCOSTESTIMATE/DATA/ACTUAL_COSTS");
            
            cmd2 = trans2.addCustomFunction("GETPRICE", 
                  "PROJECT_CONTRACT_ITEM_API.GET_PRICE", "PRICE");
            cmd2.addParameter("ITEM0_PROJ_NO");
            cmd2.addParameter("ITEM0_CONTRACT_ID",ITEMCONTRACTID);
            cmd2.addParameter("JOB_LIST_CONTENT",JOBLISTCONTENT);
            
            cmd2 = trans2.addCustomFunction("GETBUDGETNO", 
                  "PROJECT_CONTRACT_ITEM_API.Get_Budget_No", "BUDGET_NO");
            cmd2.addParameter("ITEM0_PROJ_NO");
            cmd2.addParameter("ITEM0_CONTRACT_ID",ITEMCONTRACTID);
            cmd2.addParameter("JOB_LIST_CONTENT",JOBLISTCONTENT);
            
            cmd2 = trans2.addCustomFunction("GETBUDGETLINENO", 
                   "PROJECT_CONTRACT_ITEM_API.Get_Budget_Line_No", "BUDGET_LINE_NO");
            cmd2.addParameter("ITEM0_PROJ_NO");
            cmd2.addParameter("ITEM0_CONTRACT_ID",ITEMCONTRACTID);
            cmd2.addParameter("JOB_LIST_CONTENT",JOBLISTCONTENT);
            
            cmd2 = trans2.addCustomFunction("GETCONTRACTSIGNAMOUNT", 
                  "PROJECT_CONTRACT_API.Cal_Ori_Contract_Total", "CONTRACT_SIGN_AMOUNT");
            cmd2.addParameter("ITEM0_PROJ_NO");
            cmd2.addParameter("ITEM0_CONTRACT_ID",ITEMCONTRACTID);
            
            trans2 = mgr.validate(trans2);
            
            PRICE = trans2.getValue("GETPRICE/DATA/PRICE");
            BUDGETNO = trans2.getValue("GETBUDGETNO/DATA/BUDGET_NO");
            BUDGETLINENO = trans2.getValue("GETBUDGETLINENO/DATA/BUDGET_LINE_NO");
            CONTRACTSIGNAMOUNT = trans2.getValue("GETCONTRACTSIGNAMOUNT/DATA/CONTRACT_SIGN_AMOUNT");
            
            cmd3 = trans3.addCustomFunction("GETUNIT", 
                  "PROJECT_BUDGET_LINE_API.Get_Unit_Code", "UNIT");
            cmd3.addParameter("ITEM0_PROJ_NO");    
            cmd3.addParameter("BUDGET_NO",BUDGETNO);
            cmd3.addParameter("BUDGET_LINE_NO",BUDGETLINENO);
            
            cmd3 = trans3.addCustomFunction("GETBUDGETNAME",      
                  "PROJECT_BUDGET_LINE_API.Get_Budget_Name", "BUDGET_NAME");
            cmd3.addParameter("ITEM0_PROJ_NO");
            cmd3.addParameter("BUDGET_NO",BUDGETNO);  
            cmd3.addParameter("BUDGET_LINE_NO",BUDGETLINENO);
            
            cmd3 = trans3.addCustomFunction("GETBUDGETAMOUNT", 
                  "PROJECT_BUDGET_LINE_API.Get_Amount", "BUDGET_AMOUNT");
            cmd3.addParameter("ITEM0_PROJ_NO");
            cmd3.addParameter("BUDGET_NO",BUDGETNO);
            cmd3.addParameter("BUDGET_LINE_NO",BUDGETLINENO);               
            

            trans3 = mgr.validate(trans3);    
           
            UNIT = trans3.getValue("GETUNIT/DATA/UNIT");
            BUDGETNAME = trans3.getValue("GETBUDGETNAME/DATA/BUDGET_NAME");
            BUDGETAMOUNT = trans3.getValue("GETBUDGETAMOUNT/DATA/BUDGET_AMOUNT");

            txt = ((mgr.isEmpty(JOBLISTCONTENT)) ? "" : JOBLISTCONTENT )+ "^"
                  +((mgr.isEmpty(QUANTITIES)) ? "" : QUANTITIES )+ "^"
                  +((mgr.isEmpty(UNIT)) ? "" : UNIT )+ "^"
                  +((mgr.isEmpty(PRICE)) ? "" : PRICE )+ "^" 
                  +((mgr.isEmpty(ACTUALCOSTS)) ? "" : ACTUALCOSTS )+ "^" 
                  + ((mgr.isEmpty(BUDGETLINENO)) ? "" : BUDGETLINENO )+ "^"
                  + ((mgr.isEmpty(BUDGETNAME)) ? "" : BUDGETNAME )+ "^" 
                  + ((mgr.isEmpty(BUDGETAMOUNT)) ? "" : BUDGETAMOUNT )+ "^"
                  + ((mgr.isEmpty(CONTRACTSIGNAMOUNT)) ? "" : CONTRACTSIGNAMOUNT )+ "^";
            
            mgr.responseWrite(txt);
         }
         else if ("QUANTITIES".equals(val)) {         
            tempValue = ((mgr.readValue("QUANTITIES")==null)?0:Float.parseFloat(mgr.readValue("QUANTITIES")))*((mgr.readValue("PRICE")==null)?0:Float.parseFloat(mgr.readValue("PRICE")));
            mgr.responseWrite(String.valueOf(tempValue)+"^");
         }
         else if ("PRICE".equals(val)) {         
            tempValue = ((mgr.readValue("PRICE")==null)?0:Float.parseFloat(mgr.readValue("PRICE")))*((mgr.readValue("QUANTITIES")==null)?0:Float.parseFloat(mgr.readValue("QUANTITIES")));
            mgr.responseWrite(String.valueOf(tempValue)+"^");
         }
         
         
         mgr.endResponse();
         
      }

      
      protected String getDescription()
      {
         return "CONPROJCONNECTIONLISTCOSTREPLYDESC: Con Proj Connection List Cost Reply";
      }


      protected String getTitle()
      {
         return getDescription();
      }


      protected void printContents() throws FndException
      {
         ASPManager mgr = getASPManager();
         if (headlay.isVisible())
             appendToHTML(headlay.show());
         else 
         {
            headlay.setLayoutMode(headlay.CUSTOM_LAYOUT);
            appendToHTML(headlay.show());
         }  
         if ((headlay.isSingleLayout() || headlay.isCustomLayout()) && headset.countRows() > 0)
         {
            appendToHTML(con_connection_list_line_lay.show());
         }
      }
      
      protected ASPBlock getBizWfBlock()
      {
         return headblk;      
      }
   }