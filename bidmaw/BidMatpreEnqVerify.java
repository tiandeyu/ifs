/*
*                 IFS Research & Development
*
*  This program is protected by copyright law and by international
*  conventions. All licensing, renting, lending or copying (including
*  for private use), and all other use of the program, which is not
*  expressively permitted by IFS Research & Development (IFS), is a
*  violation of the rights of IFS. Such violations will be reported to the
*  appropriate authorities.
*
*  VIOLATIONS OF ANY COPYRIGHT IS PUNISHABLE BY LAW AND CAN LEAD
*  TO UP TO TWO YEARS OF IMPRISONMENT AND LIABILITY TO PAY DAMAGES.
* ----------------------------------------------------------------------------
* File                          :
* Description                   :
* Notes                         :
* Other Programs Called :
* ----------------------------------------------------------------------------
* Modified    : Automatically generated by IFS/Design
* ----------------------------------------------------------------------------
*/

//-----------------------------------------------------------------------------
//-----------------------------   Package def  ------------------------------
//-----------------------------------------------------------------------------

package ifs.bidmaw;
//-----------------------------------------------------------------------------
//-----------------------------   Import def  ------------------------------
//-----------------------------------------------------------------------------

import java.io.UnsupportedEncodingException;

import ifs.fnd.asp.*;
import ifs.fnd.buffer.*;
import ifs.fnd.service.*;
import ifs.fnd.*;
import ifs.hzwflw.HzASPPageProviderWf;

//-----------------------------------------------------------------------------
//-----------------------------   Class def  ------------------------------
//-----------------------------------------------------------------------------

public class BidMatpreEnqVerify extends HzASPPageProviderWf
{

   //-----------------------------------------------------------------------------
   //---------- Static constants ------------------------------------------------
   //-----------------------------------------------------------------------------

   public static boolean DEBUG = Util.isDebugEnabled("ifs.bidmaw.BidMatpreEnqVerify");

   //-----------------------------------------------------------------------------
   //---------- Header Instances created on page creation --------
   //-----------------------------------------------------------------------------

   private ASPBlock headblk;
   private ASPRowSet headset;
   private ASPCommandBar headbar;
   private ASPTable headtbl;
   private ASPBlockLayout headlay;

   //-----------------------------------------------------------------------------
   //---------- Item Instances created on page creation --------
   //-----------------------------------------------------------------------------

   private ASPBlock bid_matpre_enq_org_blk;
   private ASPRowSet bid_matpre_enq_org_set;
   private ASPCommandBar bid_matpre_enq_org_bar;
   private ASPTable bid_matpre_enq_org_tbl;
   private ASPBlockLayout bid_matpre_enq_org_lay;
   
   private ASPBlock bid_enq_mat_list_blk;
   private ASPRowSet bid_enq_mat_list_set;
   private ASPCommandBar bid_enq_mat_list_bar;
   private ASPTable bid_enq_mat_list_tbl;
   private ASPBlockLayout bid_enq_mat_list_lay;
   private ASPTabContainer tabs;
   private int activetab;
   

   //-----------------------------------------------------------------------------
   //------------------------  Construction  ---------------------------
   //-----------------------------------------------------------------------------

   public  BidMatpreEnqVerify (ASPManager mgr, String page_path)
   {
      super(mgr,page_path);
   }

   public void run() throws FndException
   {
      super.run();  
      ASPManager mgr = getASPManager();

      if( mgr.commandBarActivated() )
         eval(mgr.commandBarFunction());
      else if(mgr.dataTransfered())
         okFind();
      else if( !mgr.isEmpty(mgr.getQueryStringValue("SEARCH")) )
         okFind();
      else if( !mgr.isEmpty(mgr.getQueryStringValue("BID_MAT_ID")) )
         okFind();
      else if(!mgr.isEmpty(mgr.getQueryStringValue("VALIDATE")))
         validate();
      else
         okFind();
      tabs.saveActiveTab(); 
      adjust();
   }
   
   public void validate(){
      ASPManager mgr = getASPManager();
      String val = mgr.readValue("VALIDATE");    
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPCommand cmd;
      ASPTransactionBuffer trans1 = mgr.newASPTransactionBuffer();
      ASPCommand cmd1;
      String txt = "";
      String matName = "";
      String prodModle = "";
      String matName1,matProdModel;
      String budgetLineNo,budgetName2;
      float tempValue = 0;
      
     if ("MAT_NO".equals(val)) {
         cmd = trans.addCustomFunction("GETMATNAME", 
               "MAT_CODE_API.GET_MAT_NAME", "MAT_NAME");
         cmd.addParameter("ITEM0_PROJ_NO,MAT_NO");
         
         cmd = trans.addCustomFunction("GETSPECIFYTYPE", 
               "MAT_CODE_API.GET_PROD_MODEL", "SPECIFY_TYPE");
         cmd.addParameter("ITEM0_PROJ_NO,MAT_NO");
         
         trans = mgr.validate(trans);
         
         matName = trans.getValue("GETMATNAME/DATA/MAT_NAME");
         prodModle = trans.getValue("GETSPECIFYTYPE/DATA/SPECIFY_TYPE");

         txt = ((mgr.isEmpty(matName)) ? "" : matName )+ "^" + 
               ((mgr.isEmpty(prodModle)) ? "" : prodModle )+ "^";
         
         mgr.responseWrite(txt);
      }
     else if("ITEM1_MAT_NO".equals(val)){
        cmd = trans.addCustomFunction("MATNAME", 
              "MAT_CODE_API.Get_Mat_Name", "ITEM1_MAT_NAME");
        cmd.addParameter("ITEM1_PROJ_NO, ITEM1_MAT_NO");
        
        cmd = trans.addCustomFunction("PRODMODEL", 
              "MAT_CODE_API.Get_Prod_Model", "PROD_MODLE");
        cmd.addParameter("ITEM1_PROJ_NO, ITEM1_MAT_NO");
        
        cmd = trans.addCustomFunction("ITEM1BUDGETLINENO", 
              "MAT_CODE_API.Get_Budget_Line_No", "ITEM1_BUDGET_LINE_NO");
        cmd.addParameter("ITEM1_PROJ_NO, ITEM1_MAT_NO");
        
        trans = mgr.validate(trans);
        matName1 = trans.getValue("MATNAME/DATA/ITEM1_MAT_NAME");
        matProdModel = trans.getValue("PRODMODEL/DATA/PROD_MODLE");
        budgetLineNo = trans.getValue("ITEM1BUDGETLINENO/DATA/ITEM1_BUDGET_LINE_NO");
        
        cmd1 = trans1.addCustomFunction("ITEM1BUDGETNAME", 
              "PROJECT_BUDGET_LINE_API.GET_BUDGET_NAME", "ITEM1_BUDGET_NAME");
        cmd1.addParameter("ITEM1_PROJ_NO");
        cmd1.addParameter("ITEM1_BUDGET_LINE_NO",budgetLineNo);
        trans1= mgr.validate(trans1);
        budgetName2 = trans1.getValue("ITEM1BUDGETNAME/DATA/ITEM1_BUDGET_NAME");
        
        txt = ((mgr.isEmpty(matName1)) ? "" : matName1 )+ "^" + 
        ((mgr.isEmpty(matProdModel)) ? "" : matProdModel )+ "^" + 
        ((mgr.isEmpty(budgetLineNo)) ? "" : budgetLineNo )+ "^" +
        ((mgr.isEmpty(budgetName2)) ? "" : budgetName2 )+ "^";
        mgr.responseWrite(txt);
     }else 
      {
        if("COUNT".equals(val)) {         
           tempValue = ((mgr.readValue("COUNT")==null)?0:Float.parseFloat(mgr.readValue("COUNT")))*((mgr.readValue("PRICE")==null)?0:Float.parseFloat(mgr.readValue("PRICE")));
         }
         else if("PRICE".equals(val)){
            tempValue = ((mgr.readValue("COUNT")==null)?0:Float.parseFloat(mgr.readValue("COUNT")))*((mgr.readValue("PRICE")==null)?0:Float.parseFloat(mgr.readValue("PRICE")));
         }else if ("ITEM1_COUNT".equals(val)) {         
           tempValue = ((mgr.readValue("ITEM1_COUNT")==null)?0:Float.parseFloat(mgr.readValue("ITEM1_COUNT")))*((mgr.readValue("ITEM1_PRICE")==null)?0:Float.parseFloat(mgr.readValue("ITEM1_PRICE")));
         }
         else if("ITEM1_PRICE".equals(val)){
            tempValue = ((mgr.readValue("ITEM1_COUNT")==null)?0:Float.parseFloat(mgr.readValue("ITEM1_COUNT")))*((mgr.readValue("ITEM1_PRICE")==null)?0:Float.parseFloat(mgr.readValue("ITEM1_PRICE")));
         }
         mgr.responseWrite(String.valueOf(tempValue)+"^");
     }
      mgr.endResponse(); 
   }
   
   //-----------------------------------------------------------------------------
   //------------------------  Command Bar functions  ---------------------------
   //-----------------------------------------------------------------------------

   public void okFind()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;

      mgr.createSearchURL(headblk);
      q = trans.addQuery(headblk);
      q.includeMeta("ALL");
      if(mgr.dataTransfered())
         q.addOrCondition(mgr.getTransferedData());
      mgr.querySubmit(trans,headblk);
      if (  headset.countRows() == 0 )
      {
         mgr.showAlert("BIDMATPREENQVERIFYNODATA: No data found.");
         headset.clear();
      }
      else{
         okFindITEM1();
         okFindITEM2();
      }
      eval( bid_matpre_enq_org_set.syncItemSets() );
   }



   public void countFind()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;

      q = trans.addQuery(headblk);
      q.setSelectList("to_char(count(*)) N");
      mgr.submit(trans);
      headlay.setCountValue(toInt(headset.getValue("N")));
      headset.clear();
   }



   public void newRow()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPBuffer data;
      ASPCommand cmd;

      cmd = trans.addEmptyCommand("HEAD","BID_MATPRE_ENQ_VERIFY_API.New__",headblk);
      cmd.setOption("ACTION","PREPARE");
      trans = mgr.perform(trans);
      data = trans.getBuffer("HEAD/DATA");
      headset.addRow(data);
   }


   //-----------------------------------------------------------------------------
   //------------------------  Item block cmd bar functions  ---------------------------
   //-----------------------------------------------------------------------------


   public void okFindITEM1()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      int headrowno;

      q = trans.addQuery(bid_matpre_enq_org_blk);
      q.addWhereCondition("PROJ_NO = ? AND CRE_ID = ? AND BID_MAT_ID = ?");
      q.addParameter("PROJ_NO", headset.getValue("PROJ_NO"));
      q.addParameter("CRE_ID", headset.getValue("CRE_ID"));
      q.addParameter("BID_MAT_ID", headset.getValue("BID_MAT_ID"));
      q.includeMeta("ALL");
      headrowno = headset.getCurrentRowNo();
      mgr.querySubmit(trans,bid_matpre_enq_org_blk);
      headset.goTo(headrowno);
   }
   public void newRowITEM1()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPCommand cmd;
      ASPBuffer data;

      
      cmd = trans.addEmptyCommand("ITEM1","BID_MATPRE_ENQ_ORG_API.New__",bid_matpre_enq_org_blk);
      cmd.setOption("ACTION","PREPARE");
      cmd.setParameter("ITEM0_PROJ_NO", headset.getValue("PROJ_NO"));
      cmd.setParameter("ITEM0_CRE_ID", headset.getValue("CRE_ID"));
      cmd.setParameter("ITEM0_BID_MAT_ID", headset.getValue("BID_MAT_ID"));
      trans = mgr.perform(trans);
      data = trans.getBuffer("ITEM1/DATA");
      bid_matpre_enq_org_set.addRow(data);
   }
   public void okFindITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      int headrowno;

      q = trans.addQuery(bid_enq_mat_list_blk);
      q.addWhereCondition("PROJ_NO = ? AND CRE_ID = ?");
      q.addParameter("PROJ_NO", headset.getValue("PROJ_NO"));
      q.addParameter("CRE_ID", headset.getValue("CRE_ID"));
      q.includeMeta("ALL");
      headrowno = headset.getCurrentRowNo();
      mgr.querySubmit(trans,bid_enq_mat_list_blk);
      headset.goTo(headrowno);
   }
   
   public void newRowITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPCommand cmd;
      ASPBuffer data;

      
      cmd = trans.addEmptyCommand("ITEM2","BID_ENQ_MAT_LIST_API.New__",bid_enq_mat_list_blk);
      cmd.setOption("ACTION","PREPARE");
      cmd.setParameter("ITEM1_PROJ_NO", headset.getValue("PROJ_NO"));
      cmd.setParameter("ITEM1_CRE_ID", headset.getValue("CRE_ID"));
      trans = mgr.perform(trans);
      data = trans.getBuffer("ITEM2/DATA");
      bid_enq_mat_list_set.addRow(data);
   }


   //-----------------------------------------------------------------------------
   //------------------------  Predefines Head ---------------------------
   //-----------------------------------------------------------------------------

   public void  preDefine()
   {
      ASPManager mgr = getASPManager();

      headblk = mgr.newASPBlock("MAIN");
      headblk.addField("OBJID").
              setHidden();
      headblk.addField("OBJVERSION").
              setHidden();
      headblk.addField("PROJ_NO").
              setMandatory().
              setInsertable().
              setDefaultNotVisible().
              setDynamicLOV("GENERAL_PROJECT",600,445).
              setLabel("BIDMATPREENQVERIFYPROJNO: Proj No").
              setSize(30);
      headblk.addField("GENERAL_PROJECT_PROJ_DESC").
              setFunction("GENERAL_PROJECT_API.GET_PROJ_DESC ( :PROJ_NO)").
              setLabel("BIDMATPREENQVERIFYGENERALPROJECTPROJDESC: General Project Proj Desc").
              setReadOnly().
              setSize(30);  
      mgr.getASPField("PROJ_NO").setValidation("GENERAL_PROJECT_PROJ_DESC");
      headblk.addField("CRE_ID").
              setMandatory().
              setInsertable().
              setDefaultNotVisible().
              setDynamicLOV("BID_CRE_PROJ_APPLY_LOV","PROJ_NO").
              setLOVProperty("WHERE", "STATUS='2' AND BID_PROJ_TYPE_DB = 'MAT'").
              setLabel("BIDMATPREENQVERIFYCREID: Cre Id").
              setSize(30);
      headblk.addField("CREATE_BID_NAME").
              setFunction("BID_CRE_PROJ_APPLY_API.Get_Create_Bid_Name ( :PROJ_NO, :CRE_ID)").
              setLabel("BIDMATPREENQVERIFYCREATEBIDNAME: Create Bid Name").
              setReadOnly().
              setSize(30);
      mgr.getASPField("CRE_ID").setValidation("CREATE_BID_NAME");
      headblk.addField("BID_MAT_ID").
              setHidden().
              setLabel("BIDMATPREENQVERIFYBIDMATID: Bid Mat Id").
              setSize(30);
      headblk.addField("VERIFY_BILL_NO").
              setInsertable().
              setDefaultNotVisible().
              setWfProperties().
              setLabel("BIDMATPREENQVERIFYVERIFYBILLNO: Verify Bill No").
              setSize(30);
      headblk.addField("DOC_ID").
              setInsertable().
              setDefaultNotVisible().
              setMandatory().
              setDynamicLOV("BID_ENQ_DOC_MAN", "PROJ_NO,CRE_ID").
              setLOVProperty("WHERE", "BID_PROJ_TYPE_DB='MAT'").
              setLabel("BIDMATPREENQVERIFYDOCID: Doc Id").
              setSize(30); 
      headblk.addField("ENQUIRY_NAME").
              setReadOnly().
              setFunction("Bid_Enq_Doc_Man_Api.Get_Enquiry_Name (:PROJ_NO, :CRE_ID, :DOC_ID)").
              setLabel("BIDMATPREENQVERIFYENQUIRYNAME: Enquiry Name").
              setSize(30);
      mgr.getASPField("DOC_ID").setValidation("ENQUIRY_NAME");
      headblk.addField("CREATE_DATE","Date").
              setInsertable().
              setDefaultNotVisible().
              setLabel("BIDMATPREENQVERIFYCREATEDATE: Create Date").
              setSize(30);
      headblk.addField("CREATE_PERSON").
              setReadOnly().
              setDefaultNotVisible().
              setLabel("BIDMATPREENQVERIFYCREATEPERSON: Create Person").
              setSize(30);
      headblk.addField("CREATE_PERSON_NAME").
              setFunction("PERSON_INFO_API.GET_NAME ( :CREATE_PERSON)").
              setDefaultNotVisible().
              setLabel("BIDMATENQJUDGECREATEPERSONNAME: Create Person Name").
              setSize(30).
              setReadOnly();
      headblk.addField("CREATE_ORG").
              setInsertable().
              setDefaultNotVisible().
              setLabel("BIDMATPREENQVERIFYCREATEORG: Create Org").
              setSize(30).
              setDynamicLOV("GENERAL_ORGANIZATION");
      headblk.addField("START_ORG_NAME").
              setFunction("GENERAL_ORGANIZATION_API.Get_Org_Desc(:CREATE_ORG)").
              setLabel("CONPROJCONNECTIONLISTFREENOREPLYSTARTORGNAME: Start Org Name").
              setSize(30).
              setReadOnly();
      mgr.getASPField("CREATE_ORG").setValidation("START_ORG_NAME");
      headblk.addField("STATUS").
              setHidden().
              setLabel("BIDMATPREENQVERIFYSTATUS: Status").
              setSize(30);
      //Dec 10th 2014 add status's desc by natic
      headblk.addField("STATUS_DESC").
              setReadOnly().
              setFunction("FLOW_STATUS_API.Get_Status_Desc (:STATUS)").
              setLabel("BIDCREPROJAPPLYSTATUSDESC: Status Desc").
              setSize(30);
      mgr.getASPField("STATUS").setValidation("STATUS_DESC");
      //add end
      headblk.addField("NOTE").
              setInsertable().
              setDefaultNotVisible().
              setLabel("BIDMATPREENQVERIFYNOTE: Note").
              setHeight(5).
              setSize(129);
           
      headblk.setView("BID_MATPRE_ENQ_VERIFY");
      headblk.defineCommand("BID_MATPRE_ENQ_VERIFY_API","New__,Modify__,Remove__");
      headset = headblk.getASPRowSet();
      headbar = mgr.newASPCommandBar(headblk);
      headtbl = mgr.newASPTable(headblk);
      headtbl.setTitle("BIDMATPREENQVERIFYTBLHEAD: Bid Matpre Enq Verifys");
      headtbl.enableRowSelect();
      headtbl.setWrap();
      headlay = headblk.getASPBlockLayout();
      headlay.setDefaultLayoutMode(headlay.MULTIROW_LAYOUT);
      headbar.addCustomCommand("printReport", "BIDMATPREENQVERIFYPFILECHECKPRINTREPORT: Print Report...");
      headlay.setDataSpan("NOTE", 5);
      headlay.setSimple("ENQUIRY_NAME");
      headlay.setSimple("GENERAL_PROJECT_PROJ_DESC");
      headlay.setSimple("CREATE_BID_NAME");
      headlay.setSimple("CREATE_PERSON_NAME");
      headlay.setSimple("START_ORG_NAME");
      headbar.addCustomCommand("activateITEM1",mgr.translate("BIDMATPREENQORG: Bid Matpre Enq Org"));
      headbar.addCustomCommand("activateITEM2",mgr.translate("BIDENQMATLIST: Bid Enq Mat List"));
      
      
      
      bid_matpre_enq_org_blk = mgr.newASPBlock("ITEM1");
      bid_matpre_enq_org_blk.addField("ITEM0_OBJID").
                             setHidden().
                             setDbName("OBJID");
      bid_matpre_enq_org_blk.addField("ITEM0_OBJVERSION").
                             setHidden().
                             setDbName("OBJVERSION");
      bid_matpre_enq_org_blk.addField("ITEM0_PROJ_NO").
                             setDbName("PROJ_NO").
                             setHidden().
                             setLabel("BIDMATPREENQORGITEM0PROJNO: Proj No").
                             setSize(30);
      bid_matpre_enq_org_blk.addField("ITEM0_CRE_ID").
                             setDbName("CRE_ID").
                             setHidden().
                             setLabel("BIDMATPREENQORGITEM0CREID: Cre Id").
                             setSize(30);
      bid_matpre_enq_org_blk.addField("ITEM0_BID_MAT_ID").
                             setDbName("BID_MAT_ID").
                             setHidden().
                             setLabel("BIDMATPREENQORGITEM0BIDMATID: Bid Mat Id").
                             setSize(30);
      bid_matpre_enq_org_blk.addField("ID").
                             setHidden().
                             setLabel("BIDMATPREENQORGID: Id").
                             setSize(30);
      bid_matpre_enq_org_blk.addField("MAT_NO").
                             setInsertable().
                             setReadOnly().
                             setLabel("BIDMATPREENQVERIFYMATNO: Mat No").
//                             setDynamicLOV("MAT_CODE_LOV", "ITEM0_PROJ_NO").
                             setSize(30).
                             setCustomValidation("ITEM0_PROJ_NO,MAT_NO", "MAT_NAME,SPECIFY_TYPE");
      bid_matpre_enq_org_blk.addField("MAT_NAME").
                             setReadOnly().
                             setLabel("BIDMATPREENQVERIFYMATNAME: Mat Name").
                             setFunction("Mat_Code_Api.Get_Mat_Name (:PROJ_NO, :MAT_NO)").
                             setSize(30);
      //mgr.getASPField("MAT_NO").setValidation("MAT_NAME");
      bid_matpre_enq_org_blk.addField("SPECIFY_TYPE").
                             setReadOnly().
                             setLabel("BIDMATPREENQORGSPECIFYTYPE: Specify Type").
                             setSize(30);
      bid_matpre_enq_org_blk.addField("COUNT","Number").
                             setReadOnly().
                             setLabel("BIDMATPREENQORGCOUNT: Count").
                             setSize(30);
      bid_matpre_enq_org_blk.addField("ENQUIRY_ORG_ONE").
                             setInsertable().
                             setLabel("BIDMATPREENQORGENQUIRYORGONE: Enquiry Org One").
                             setSize(129);
      bid_matpre_enq_org_blk.addField("ENQUIRY_ORG_TWO").
                             setInsertable().
                             setLabel("BIDMATPREENQORGENQUIRYORGTWO: Enquiry Org Two").
                             setSize(129);
      bid_matpre_enq_org_blk.addField("ENQUIRY_ORG_THREE").
                             setInsertable().
                             setLabel("BIDMATPREENQORGENQUIRYORGTHREE: Enquiry Org Three").
                             setSize(129);
      bid_matpre_enq_org_blk.setView("BID_MATPRE_ENQ_ORG");
      bid_matpre_enq_org_blk.defineCommand("BID_MATPRE_ENQ_ORG_API","Modify__");
      bid_matpre_enq_org_blk.setMasterBlock(headblk);
      bid_matpre_enq_org_set = bid_matpre_enq_org_blk.getASPRowSet();
      bid_matpre_enq_org_bar = mgr.newASPCommandBar(bid_matpre_enq_org_blk);
      bid_matpre_enq_org_bar.defineCommand(bid_matpre_enq_org_bar.OKFIND, "okFindITEM1");
      bid_matpre_enq_org_bar.defineCommand(bid_matpre_enq_org_bar.NEWROW, "newRowITEM1");
      bid_matpre_enq_org_tbl = mgr.newASPTable(bid_matpre_enq_org_blk);
      bid_matpre_enq_org_tbl.setTitle("BIDMATPREENQORGITEMHEAD1: BidMatpreEnqOrg");
      bid_matpre_enq_org_tbl.enableRowSelect();
      bid_matpre_enq_org_tbl.setWrap();
      bid_matpre_enq_org_lay = bid_matpre_enq_org_blk.getASPBlockLayout();
      bid_matpre_enq_org_lay.setDefaultLayoutMode(bid_matpre_enq_org_lay.MULTIROW_LAYOUT);
      bid_matpre_enq_org_lay.setDataSpan("COUNT", 5);
      bid_matpre_enq_org_lay.setDataSpan("ENQUIRY_ORG_ONE", 5);
      bid_matpre_enq_org_lay.setDataSpan("ENQUIRY_ORG_TWO", 5);
      bid_matpre_enq_org_lay.setDataSpan("ENQUIRY_ORG_THREE", 5);
      bid_matpre_enq_org_lay.setSimple("MAT_NAME");
      
      //Ìí¼ÓtabÒ³
      bid_enq_mat_list_blk = mgr.newASPBlock("ITEM2");
      bid_enq_mat_list_blk.addField("ITEM1_OBJID").
                           setHidden().
                           setDbName("OBJID");
      bid_enq_mat_list_blk.addField("ITEM1_OBJVERSION").
                           setHidden().
                           setDbName("OBJVERSION");
      bid_enq_mat_list_blk.addField("ITEM1_PROJ_NO").
                           setDbName("PROJ_NO").
                           setMandatory().
                           setHidden().
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1PROJNO: Proj No").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_CRE_ID").
                           setDbName("CRE_ID").
                           setHidden().
                           setMandatory().
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1CREID: Cre Id").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_DOC_ID").
                           setDbName("DOC_ID").
                           setMandatory().
                           setInsertable().
                           setHidden().
                           setLabel("BIDENQMATLISTITEM1DOCID: Doc Id").
                           setSize(30);
      bid_enq_mat_list_blk.addField("MAT_LINE_NO").
                           setMandatory().
                           setHidden().
                           setInsertable().
                           setLabel("BIDENQMATLISTMATLINENO: Mat Line No").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_CONTRACT_SIGN_COUNT","Number").
                           setDbName("CONTRACT_SIGN_COUNT").
                           setHidden().
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1CONTRACTSIGNCOUNT: Contract Sign Count").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_CONTRACT_SIGN_AMOUNT","Number").
                           setDbName("CONTRACT_SIGN_AMOUNT").
                           setHidden().
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1CONTRACTSIGNAMOUNT: Contract Sign Amount").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_MAT_NO").
                           setDbName("MAT_NO").
                           setInsertable().
                           setLabel("BIDENQMATLISTMATNO: Mat No").
                           setDynamicLOV("MAT_CODE_LOV", "ITEM1_PROJ_NO").
                           setCustomValidation("ITEM1_PROJ_NO,ITEM1_MAT_NO", "ITEM1_MAT_NAME,PROD_MODLE,ITEM1_BUDGET_LINE_NO,ITEM1_BUDGET_NAME").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_MAT_NAME").
                           setDbName("MAT_NAME").
                           setReadOnly().
                           setLabel("BIDENQMATLISTMATNAME: Mat Name").
                           setSize(30);
      bid_enq_mat_list_blk.addField("PROD_MODLE").
                           setReadOnly().
                           setLabel("BIDENQMATLISTPRODMODLE: Prod Modle").
                           setSize(30);
      //add budget_no & name
      bid_enq_mat_list_blk.addField("ITEM1_BUDGET_LINE_NO").
                           setReadOnly().
                           setFunction("MAT_CODE_API.Get_Budget_Line_No (:PROJ_NO,:MAT_NO)").
                           setLabel("MATCODEBUDGETLINENO: Budget Line No").
                           setSize(30);
      
      bid_enq_mat_list_blk.addField("ITEM1_BUDGET_NAME").
                           setLabel("MATCODEBUDGETNAME: Budget Name").
                           setFunction("PROJECT_BUDGET_LINE_API.GET_BUDGET_NAME ( :PROJ_NO,MAT_CODE_API.Get_Budget_Line_No (:PROJ_NO,:MAT_NO))").
                           setSize(30).
                           setReadOnly();
      //end of add
      bid_enq_mat_list_blk.addField("ITEM1_PRICE","Number").
                           setDbName("PRICE").
                           setInsertable().
                           setHidden().
                           setLabel("BIDENQMATLISTITEM1PRICE: Price").
                           setCustomValidation("ITEM1_PRICE,ITEM1_COUNT","ITEM1_TOTAL_PRICE").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_COUNT","Number").
                           setDbName("COUNT").
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1COUNT: Count").
                           setCustomValidation("ITEM1_PRICE,ITEM1_COUNT","ITEM1_TOTAL_PRICE").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_TOTAL_PRICE","Number").
                           setDbName("TOTAL_PRICE").
                           setReadOnly().
                           setHidden().
                           setLabel("BIDENQMATLISTITEM1TOTALPRICE: Total Price").
                           setSize(30);
      
      bid_enq_mat_list_blk.setView("BID_ENQ_MAT_LIST");
      bid_enq_mat_list_blk.defineCommand("BID_ENQ_MAT_LIST_API","Modify__");
      bid_enq_mat_list_blk.setMasterBlock(headblk);
      bid_enq_mat_list_set = bid_enq_mat_list_blk.getASPRowSet();
      bid_enq_mat_list_bar = mgr.newASPCommandBar(bid_enq_mat_list_blk);
      bid_enq_mat_list_bar.defineCommand(bid_enq_mat_list_bar.OKFIND, "okFindITEM2");
      bid_enq_mat_list_bar.defineCommand(bid_enq_mat_list_bar.NEWROW, "newRowITEM2");
      bid_enq_mat_list_tbl = mgr.newASPTable(bid_enq_mat_list_blk);
      bid_enq_mat_list_tbl.setTitle("BIDENQMATLISTITEMHEAD2: BidEnqMatList");
      bid_enq_mat_list_tbl.enableRowSelect();
      bid_enq_mat_list_tbl.setWrap();
      bid_enq_mat_list_lay = bid_enq_mat_list_blk.getASPBlockLayout();
      bid_enq_mat_list_lay.setDefaultLayoutMode(bid_enq_mat_list_lay.MULTIROW_LAYOUT);
      bid_enq_mat_list_lay.setSimple("MAT_NAME");
      
      tabs = newASPTabContainer("TAB");      
      tabs.addTab("BIDMATPREENQORG: Bid Matpre Enq Org","javascript:commandSet('MAIN.activateITEM1','')");
      tabs.addTab("BIDENQMATLIST: Bid Enq Mat List","javascript:commandSet('MAIN.activateITEM2','')");
      tabs.setContainerSpace(0);
      tabs.setLeftTabSpace(0);
      tabs.setTabWidth(68);
      tabs.setTableVisibility(false); 
      //½áÊø

   }

   public void activateITEM1() {
      tabs.setActiveTab(1);  
      okFindITEM1();
   }
   public void activateITEM2() {
      tabs.setActiveTab(2); 
      okFindITEM2();
   }

   public void  adjust()
   {
      try {
         super.adjust();
      } catch (FndException e) {
         // TODO Auto-generated catch block
         e.printStackTrace();
      }
      // fill function body
      headbar.removeCustomCommand("activateITEM1");
      headbar.removeCustomCommand("activateITEM2");
     /* if(bid_matpre_enq_org_set!=null&&bid_matpre_enq_org_set.countRows()>0){   
         bid_matpre_enq_org_bar.disableCommand(bid_matpre_enq_org_bar.DELETE);
         bid_matpre_enq_org_bar.disableCommand(bid_matpre_enq_org_bar.NEWROW);
      }*/
   }

   public void  printReport() throws FndException, UnsupportedEncodingException
   {
    ASPManager mgr = getASPManager();
    ASPConfig cfg = getASPConfig();
    String URL=cfg.getParameter("APPLICATION/RUNQIAN/SERVER_URL");
    if (headlay.isMultirowLayout())
       headset.goTo(headset.getRowSelected());
    if (headset.countRows()>0 )
          {   
              String proj_no = headset.getValue("PROJ_NO");
              String cre_id = headset.getValue("CRE_ID");
              String bid_mat_id = headset.getValue("BID_MAT_ID");
              appendDirtyJavaScript("window.open('"+URL+"/showReport.jsp?raq=BidMatpreEnqVerify.raq&proj_no="+proj_no+"&cre_id="+cre_id+"&bid_mat_id="+bid_mat_id
                + "','_blank','height=600, width=780, top=200, left=350, toolbar=no, menubar=no, scrollbars=yes, resizable=yes,location=no, status=no');");                                
         }
   }   
   
   //-----------------------------------------------------------------------------
   //------------------------  Presentation functions  ---------------------------
   //-----------------------------------------------------------------------------

   protected String getDescription()
   {
      return "BIDMATPREENQVERIFYDESC: Bid Matpre Enq Verify";
   }


   protected String getTitle()
   {
      return "BIDMATPREENQVERIFYTITLE: Bid Matpre Enq Verify";
   }


   protected void printContents() throws FndException
   {
      ASPManager mgr = getASPManager();
      if (headlay.isVisible())
          appendToHTML(headlay.show());
//      if (bid_matpre_enq_org_lay.isVisible())
//          appendToHTML(bid_matpre_enq_org_lay.show());
      else 
      {
         headlay.setLayoutMode(headlay.CUSTOM_LAYOUT);
         appendToHTML(headlay.show());
      }  
      if (headset.countRows()>0)
      {
         if (headlay.isSingleLayout()||headlay.isCustomLayout() ||headlay.isEditLayout())
         {
            appendToHTML(tabs.showTabsInit());
            if (tabs.getActiveTab()== 1)
            {
               appendToHTML(bid_matpre_enq_org_lay.show());
            }else if(tabs.getActiveTab()== 2){
               appendToHTML(bid_enq_mat_list_lay.show());
            }   
            appendToHTML(tabs.showTabsFinish());
            
          } 
      }

   }
   protected ASPBlock getBizWfBlock()
   {
      return headblk;
   }
}
