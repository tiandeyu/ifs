/*
*                 IFS Research & Development
*
*  This program is protected by copyright law and by international
*  conventions. All licensing, renting, lending or copying (including
*  for private use), and all other use of the program, which is not
*  expressively permitted by IFS Research & Development (IFS), is a
*  violation of the rights of IFS. Such violations will be reported to the
*  appropriate authorities.
*
*  VIOLATIONS OF ANY COPYRIGHT IS PUNISHABLE BY LAW AND CAN LEAD
*  TO UP TO TWO YEARS OF IMPRISONMENT AND LIABILITY TO PAY DAMAGES.
* ----------------------------------------------------------------------------
* File                          :
* Description                   :
* Notes                         :
* Other Programs Called :
* ----------------------------------------------------------------------------
* Modified    : Automatically generated by IFS/Design
* ----------------------------------------------------------------------------
*/

//-----------------------------------------------------------------------------
//-----------------------------   Package def  ------------------------------
//-----------------------------------------------------------------------------

package ifs.bidmaw;
//-----------------------------------------------------------------------------
//-----------------------------   Import def  ------------------------------
//-----------------------------------------------------------------------------

import java.io.UnsupportedEncodingException;

import ifs.fnd.asp.*;
import ifs.fnd.buffer.*;
import ifs.fnd.service.*;
import ifs.fnd.*;

//-----------------------------------------------------------------------------
//-----------------------------   Class def  ------------------------------
//-----------------------------------------------------------------------------

public class BidProjEnqJudge extends ASPPageProvider
{

   //-----------------------------------------------------------------------------
   //---------- Static constants ------------------------------------------------
   //-----------------------------------------------------------------------------

   public static boolean DEBUG = Util.isDebugEnabled("ifs.bidmaw.BidProjEnqJudge");

   //-----------------------------------------------------------------------------
   //---------- Header Instances created on page creation --------
   //-----------------------------------------------------------------------------

   private ASPBlock headblk;
   private ASPRowSet headset;
   private ASPCommandBar headbar;
   private ASPTable headtbl;
   private ASPBlockLayout headlay;

   //-----------------------------------------------------------------------------
   //---------- Item Instances created on page creation --------
   //-----------------------------------------------------------------------------

   private ASPBlock bid_proj_enq_result_blk;
   private ASPRowSet bid_proj_enq_result_set;
   private ASPCommandBar bid_proj_enq_result_bar;
   private ASPTable bid_proj_enq_result_tbl;
   private ASPBlockLayout bid_proj_enq_result_lay;

   private ASPBlock bid_judge_quan_list_blk;
   private ASPRowSet bid_judge_quan_list_set;
   private ASPCommandBar bid_judge_quan_list_bar;
   private ASPTable bid_judge_quan_list_tbl;
   private ASPBlockLayout bid_judge_quan_list_lay;
   private ASPTabContainer tabs;
   private String comnd;

   //-----------------------------------------------------------------------------
   //------------------------  Construction  ---------------------------
   //-----------------------------------------------------------------------------

   public  BidProjEnqJudge (ASPManager mgr, String page_path)
   {
      super(mgr,page_path);
   }

   public void run()
   {
      ASPManager mgr = getASPManager();

      if( mgr.commandBarActivated() ){
         eval(mgr.commandBarFunction());
         comnd = mgr.readValue("__COMMAND");
         if ( "ITEM2.SaveReturn".equals(comnd)  )
         {
            okFindITEM2();
         }
      }
      else if(mgr.dataTransfered())
         okFind();
      else if( !mgr.isEmpty(mgr.getQueryStringValue("SEARCH")) )
         okFind();
      else if( !mgr.isEmpty(mgr.getQueryStringValue("ID")) )
         okFind();
      else if( !mgr.isEmpty(mgr.getQueryStringValue("VALIDATE")) )
         validate();
      else
         okFind();
      adjust();
      tabs.saveActiveTab(); 
   }
   //-----------------------------------------------------------------------------
   //------------------------  Command Bar functions  ---------------------------
   //-----------------------------------------------------------------------------

   public void okFind()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;

      mgr.createSearchURL(headblk);
      q = trans.addQuery(headblk);
      q.includeMeta("ALL");
      if(mgr.dataTransfered())
         q.addOrCondition(mgr.getTransferedData());      
      mgr.querySubmit(trans,headblk);
      if (  headset.countRows() == 0 )
      {
         mgr.showAlert("BIDPROJENQJUDGENODATA: No data found.");
         headset.clear();
      }
      eval( bid_proj_enq_result_set.syncItemSets() );
      eval( bid_judge_quan_list_set.syncItemSets() );
   }



   public void countFind()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;

      q = trans.addQuery(headblk);
      q.setSelectList("to_char(count(*)) N");
      mgr.submit(trans);
      headlay.setCountValue(toInt(headset.getValue("N")));
      headset.clear();
   }



   public void newRow()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPBuffer data;
      ASPCommand cmd;

      cmd = trans.addEmptyCommand("HEAD","BID_PROJ_ENQ_JUDGE_API.New__",headblk);
      cmd.setOption("ACTION","PREPARE");
      trans = mgr.perform(trans);
      data = trans.getBuffer("HEAD/DATA");
      headset.addRow(data);
   }


   //-----------------------------------------------------------------------------
   //------------------------  Item block cmd bar functions  ---------------------------
   //-----------------------------------------------------------------------------


   public void okFindITEM1()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      int headrowno;

      q = trans.addQuery(bid_proj_enq_result_blk);
      q.addWhereCondition("PROJ_NO = ? AND CRE_ID = ? AND BID_PROJ_ID = ? AND ID = ?");
      q.addParameter("PROJ_NO", headset.getValue("PROJ_NO"));
      q.addParameter("CRE_ID", headset.getValue("CRE_ID"));
      q.addParameter("BID_PROJ_ID", headset.getValue("BID_PROJ_ID"));
      q.addParameter("ID", headset.getValue("ID"));
      q.includeMeta("ALL");
      headrowno = headset.getCurrentRowNo();
      mgr.querySubmit(trans,bid_proj_enq_result_blk);
      headset.goTo(headrowno);
   }
   public void newRowITEM1()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPCommand cmd;
      ASPBuffer data;

      
      cmd = trans.addEmptyCommand("ITEM1","BID_PROJ_ENQ_RESULT_API.New__",bid_proj_enq_result_blk);
      cmd.setOption("ACTION","PREPARE");
      cmd.setParameter("ITEM0_PROJ_NO", headset.getValue("PROJ_NO"));
      cmd.setParameter("ITEM0_CRE_ID", headset.getValue("CRE_ID"));
      cmd.setParameter("ITEM0_BID_PROJ_ID", headset.getValue("BID_PROJ_ID"));
      cmd.setParameter("ITEM0_ID", headset.getValue("ID"));
      trans = mgr.perform(trans);
      data = trans.getBuffer("ITEM1/DATA");
      bid_proj_enq_result_set.addRow(data);
   }
   public void okFindITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      int headrowno;

      q = trans.addQuery(bid_judge_quan_list_blk);
      q.addWhereCondition("PROJ_NO = ? AND CRE_ID = ? AND BID_PROJ_ID = ? AND ID = ?");
      q.addParameter("PROJ_NO", headset.getValue("PROJ_NO"));
      q.addParameter("CRE_ID", headset.getValue("CRE_ID"));
      q.addParameter("BID_PROJ_ID", headset.getValue("BID_PROJ_ID"));
      q.addParameter("ID", headset.getValue("ID"));
      q.includeMeta("ALL");
      headrowno = headset.getCurrentRowNo();
      mgr.querySubmit(trans,bid_judge_quan_list_blk);
      headset.goTo(headrowno);
   }

   public void newRowITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPCommand cmd;
      ASPBuffer data;

      
      cmd = trans.addEmptyCommand("ITEM2","BID_JUDGE_QUAN_LIST_API.New__",bid_judge_quan_list_blk);
      cmd.setOption("ACTION","PREPARE");
      cmd.setParameter("ITEM1_PROJ_NO", headset.getValue("PROJ_NO"));
      cmd.setParameter("ITEM1_CRE_ID", headset.getValue("CRE_ID"));
      cmd.setParameter("ITEM1_BID_PROJ_ID", headset.getValue("BID_PROJ_ID"));
      cmd.setParameter("ITEM1_ID", headset.getValue("ID"));
      trans = mgr.perform(trans);
      data = trans.getBuffer("ITEM2/DATA");
      bid_judge_quan_list_set.addRow(data);
   }
   
   public void validate()
   {
       ASPManager mgr = getASPManager();
       String val = mgr.readValue("VALIDATE");  
       ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
       ASPCommand cmd;
       ASPTransactionBuffer trans1 = mgr.newASPTransactionBuffer();
       ASPCommand cmd1;
       String txt = "";
       String bugLineNo = "";
       String unitCode = "";
       String totalPrice = "";
       String getCount = "";
       String feeName = "";
       String price = ""; 
       String createBidName="";
       String budgetPrice="";
       String budgetPrice1="";
       String budgetName = "";
       String budgetAmount = "";
       float tempValue=0;
       if ("QUAN_LINE_NO".equals(val)) {
          
          cmd = trans.addCustomFunction("BUDGET_UNIT_CODE", 
                  "BID_ENQ_QUAN_LIST_API.Get_Unit_Code", "BUDGET_UNIT_CODE");
          cmd.addParameter("ITEM1_PROJ_NO,ITEM1_CRE_ID,DOC_ID,QUAN_LINE_NO");
          
          cmd = trans.addCustomFunction("BUDGET_TOTAL_PRICE", 
                "BID_ENQ_QUAN_LIST_API.Get_Total_Price", "BUDGET_TOTAL_PRICE");
          cmd.addParameter("ITEM1_PROJ_NO,ITEM1_CRE_ID,DOC_ID,QUAN_LINE_NO");
          
          cmd = trans.addCustomFunction("BUDGET_FEE_NAME", 
                "BID_ENQ_QUAN_LIST_API.Get_Fee_Name", "BUDGET_FEE_NAME");
          cmd.addParameter("ITEM1_PROJ_NO,ITEM1_CRE_ID,DOC_ID,QUAN_LINE_NO");
          
          cmd = trans.addCustomFunction("VERIFY_PRICE", 
                "BID_ENQ_QUAN_LIST_API.Get_Price", "VERIFY_PRICE");
          cmd.addParameter("ITEM1_PROJ_NO,ITEM1_CRE_ID,DOC_ID,QUAN_LINE_NO");
          
          cmd = trans.addCustomFunction("COUNTCOUNT", 
                "BID_ENQ_QUAN_LIST_API.Get_Count", "COUNT");
          cmd.addParameter("ITEM1_PROJ_NO,ITEM1_CRE_ID,DOC_ID,QUAN_LINE_NO");
          
          cmd = trans.addCustomFunction("BUDGET_LINE_NO", 
                "BID_ENQ_QUAN_LIST_API.Get_Budget_Line_No", "BUDGET_LINE_NO");
          cmd.addParameter("ITEM1_PROJ_NO,ITEM1_CRE_ID,DOC_ID,QUAN_LINE_NO");
          
          
          trans = mgr.validate(trans);
   
          unitCode = trans.getValue("BUDGET_UNIT_CODE/DATA/BUDGET_UNIT_CODE");
          totalPrice = trans.getValue("BUDGET_TOTAL_PRICE/DATA/BUDGET_TOTAL_PRICE");
          getCount = trans.getValue("COUNT/DATA/COUNT");
          feeName = trans.getValue("BUDGET_FEE_NAME/DATA/BUDGET_FEE_NAME");
          price = trans.getValue("VERIFY_PRICE/DATA/VERIFY_PRICE");
          bugLineNo = trans.getValue("BUDGET_LINE_NO/DATA/BUDGET_LINE_NO");
          
          
          //BUDGET_LINE_NO带出BUDGET_NAME,BUDGET_PRICE,BUDGET_AMOUNT
          cmd1 = trans1.addCustomFunction("BUDGETNAME", 
                "PROJECT_BUDGET_LINE_API.Get_Budget_Name", "BUDGET_NAME");
          cmd1.addParameter("ITEM0_PROJ_NO");
          cmd1.addParameter("BUDGET_LINE_NO",bugLineNo);
          
          cmd1 = trans1.addCustomFunction("BUDGETAMOUNT", 
                "PROJECT_BUDGET_LINE_API.Get_Amount", "BUDGET_AMOUNT");
          cmd1.addParameter("ITEM0_PROJ_NO");
          cmd1.addParameter("BUDGET_LINE_NO",bugLineNo);
          
          cmd1 = trans1.addCustomFunction("BUDGETPRICE", 
                "PROJECT_BUDGET_LINE_API.Get_Price", "BUDGET_PRICE");
          cmd1.addParameter("ITEM0_PROJ_NO");
          cmd1.addParameter("BUDGET_LINE_NO",bugLineNo);
          
          trans1 = mgr.validate(trans1);
          budgetName = trans1.getValue("BUDGETNAME/DATA/BUDGET_NAME");
          budgetAmount = trans1.getValue("BUDGETAMOUNT/DATA/BUDGET_AMOUNT");
          budgetPrice1 = trans1.getValue("BUDGETPRICE/DATA/BUDGET_PRICE");
          
          txt = ((mgr.isEmpty(unitCode)) ? "" : unitCode )+ "^" + ((mgr.isEmpty(totalPrice)) ? "" : totalPrice )+ "^";
          txt = txt + ((mgr.isEmpty(getCount)) ? "" : getCount )+ "^" + ((mgr.isEmpty(feeName)) ? "" : feeName )+ "^";
          txt = txt + ((mgr.isEmpty(price)) ? "" : price )+ "^" ;
          txt = txt + ((mgr.isEmpty(bugLineNo)) ? "" : bugLineNo )+ "^";
          
          txt = txt+((mgr.isEmpty(budgetName)) ? "" : budgetName) + "^" + ((mgr.isEmpty(budgetAmount)) ? "0" : budgetAmount) + "^";
          txt = txt + ((mgr.isEmpty(budgetPrice1)) ? "0" : budgetPrice1) + "^";
          
          
          mgr.responseWrite(txt);
       }
       if("CRE_ID".equals(val)){
          cmd = trans.addCustomFunction("GETCREATEBIDNAME", 
                "BID_CRE_PROJ_APPLY_API.GET_CREATE_BID_NAME", "CREATE_BID_NAME");
          cmd.addParameter("PROJ_NO,CRE_ID");
          
          cmd = trans.addCustomFunction("GETFEEBUDGET", 
                "BID_CRE_PROJ_APPLY_API.GET_FEE", "FEE_BUDGET");
          cmd.addParameter("PROJ_NO,CRE_ID");
          trans = mgr.validate(trans);
          
          createBidName = trans.getValue("GETCREATEBIDNAME/DATA/CREATE_BID_NAME");
          budgetPrice = trans.getValue("GETFEEBUDGET/DATA/FEE_BUDGET");
          
          txt = ((mgr.isEmpty(createBidName)) ? "" : createBidName )+"^" + 
          ((mgr.isEmpty(budgetPrice)) ? "" : budgetPrice )+ "^";
    
          mgr.responseWrite(txt);
       }
       if("COUNT".equals(val)) {         
          tempValue = ((mgr.readValue("COUNT")==null)?0:Float.parseFloat(mgr.readValue("COUNT")))*((mgr.readValue("PRICE")==null)?0:Float.parseFloat(mgr.readValue("PRICE")));
          mgr.responseWrite(String.valueOf(tempValue)+"^");
       }
       else if("PRICE".equals(val)){
          tempValue = ((mgr.readValue("COUNT")==null)?0:Float.parseFloat(mgr.readValue("COUNT")))*((mgr.readValue("PRICE")==null)?0:Float.parseFloat(mgr.readValue("PRICE")));
          mgr.responseWrite(String.valueOf(tempValue)+"^");
       }
       mgr.endResponse();

   }
   //-----------------------------------------------------------------------------
   //------------------------  Predefines Head ---------------------------
   //-----------------------------------------------------------------------------

   public void  preDefine()
   {
      ASPManager mgr = getASPManager();

      headblk = mgr.newASPBlock("MAIN");
      headblk.addField("OBJID").
              setHidden();
      headblk.addField("OBJVERSION").
              setHidden();
      headblk.addField("PROJ_NO").
              setMandatory().
              setInsertable().
              setDynamicLOV("GENERAL_PROJECT",600,445).
              setLabel("BIDPROJENQJUDGEPROJNO: Proj No").
              setSize(30);
      headblk.addField("GENERAL_PROJECT_PROJ_DESC").
              setFunction("GENERAL_PROJECT_API.GET_PROJ_DESC ( :PROJ_NO)").
              setReadOnly().
              setLabel("BIDPROJENQJUDGEGENERALPROJECTPROJDESC: General Project Proj Desc").
              setSize(30);
      mgr.getASPField("PROJ_NO").setValidation("GENERAL_PROJECT_PROJ_DESC"); 
      headblk.addField("CRE_ID").
              setMandatory().
              setInsertable().
              setDynamicLOV("BID_CRE_PROJ_APPLY_LOV","PROJ_NO").
              setLOVProperty("WHERE", "STATE='完成' AND BID_PROJ_TYPE_DB='PROJECTSERVER'"). 
              setLabel("BIDPROJENQJUDGECREID: Cre Id").
              setCustomValidation("PROJ_NO,CRE_ID", "CREATE_BID_NAME,FEE_BUDGET").
              setSize(30);
      headblk.addField("CREATE_BID_NAME").
              setFunction("BID_CRE_PROJ_APPLY_API.Get_Create_Bid_Name ( :PROJ_NO, :CRE_ID)").
              setLabel("BIDPROJENQJUDGEGETCREATEBIDNAME: Create Bid Name").
              setReadOnly().
              setSize(30);
      headblk.addField("BID_PROJ_ID").
              setMandatory().
              setInsertable().
              setDynamicLOV("BID_PROJPRE_ENQ_VERIFY", "PROJ_NO,CRE_ID").
              setLOVProperty("WHERE", "STATUS='2'"). 
              setLabel("BIDPROJENQJUDGEBIDPROJID: Bid Proj Id").
              setSize(30);
      headblk.addField("DOC_ID").
              setInsertable().
              setMandatory().
              setDynamicLOV("BID_ENQ_DOC_MAN", "PROJ_NO,CRE_ID").
              setLOVProperty("WHERE", "BID_PROJ_TYPE_DB='PROJECTSERVER'").
              setLabel("BIDPROJENQJUDGEDOCID: Doc Id").
              setSize(30); 
      headblk.addField("ENQUIRY_NAME").
              setReadOnly().
              setFunction("Bid_Enq_Doc_Man_Api.Get_Enquiry_Name (:PROJ_NO, :CRE_ID, :DOC_ID)").
              setLabel("BIDPROJENQJUDGEENQUIRYNAME: Enquiry Name").
              setSize(30);
      mgr.getASPField("DOC_ID").setValidation("ENQUIRY_NAME");
      headblk.addField("ID").
              setHidden().
              setLabel("BIDPROJENQJUDGEID: Id").
              setSize(30);
      headblk.addField("FEE_BUDGET","Number").
              setReadOnly().
              setLabel("BIDPROJENQJUDGEFEEBUDGET: Fee Budget(The-Thousand)").
              setSize(30);
      headblk.addField("CREATE_DATE","Date").
              setInsertable().
              setLabel("BIDPROJENQJUDGECREATEDATE: Create Date").
              setSize(30);
      headblk.addField("CREATE_PERSON").
              setReadOnly().
              setLabel("BIDPROJENQJUDGECREATEPERSON: Create Person").
              setSize(30);
      headblk.addField("CREATE_PERSON_NAME").
              setFunction("PERSON_INFO_API.GET_NAME ( :CREATE_PERSON)").
              setLabel("BIDMATENQJUDGECREATEPERSONNAME: Create Person Name").
              setSize(30).
              setReadOnly();
      headblk.addField("CREATE_ORG").
              setInsertable().
              setLabel("BIDPROJENQJUDGECREATEORG: Create Org").
              setSize(30).
              setDynamicLOV("GENERAL_ORGANIZATION");
      headblk.addField("START_ORG_NAME").
              setFunction("GENERAL_ORGANIZATION_API.Get_Org_Desc(:CREATE_ORG)").
              setLabel("CONPROJCONNECTIONLISTFREENOREPLYSTARTORGNAME: Start Org Name").
              setSize(30).
              setReadOnly();
      mgr.getASPField("CREATE_ORG").setValidation("START_ORG_NAME");
      //Nov20th 2014 add doc status
      headblk.addField("VIEW_REF_FILE").
              setReadOnly().
              unsetQueryable().
              setFunction("''").
              setLabel("BIDPROJENQJUDGEVIEWFILE: View File").
              setHyperlink( mgr.getApplicationPath()
                    + "/" + mgr.getConfigParameter("DOCMAW/DOC_REF_URL")
                    + "?VIEW=" + mgr.URLEncode("BID_PROJ_ENQ_JUDGE"), "OBJID", "NEWWIN").
              setAsImageField();
      headblk.addField("EXIST_DOC_REF").
              setHidden().
              setCheckBox("FALSE,TRUE").
              setFunction("Doc_Reference_Object_API.Exist_Obj_Reference('BidProjEnqJudge',  'BID_PROJ_ID='|| bid_proj_id || '^CRE_ID='|| cre_id || '^ID=' || id || '^PROJ_NO='|| proj_no ||'^')").
              setSize(5);
      //add end
      headblk.addField("BID_DESC").
              setInsertable().
              setLabel("BIDPROJENQJUDGEBIDDESC: Bid Desc").
              setHeight(3).
              setSize(129);
      headblk.addField("STATUS").
              setHidden().
              setLabel("BIDPROJENQJUDGESTATUS: Status").
              setSize(30);
      headblk.addField("NOTE").
              setInsertable().
              setLabel("BIDPROJENQJUDGENOTE: Note").
              setHeight(5).
              setSize(129);
      
      headblk.setView("BID_PROJ_ENQ_JUDGE");
      headblk.defineCommand("BID_PROJ_ENQ_JUDGE_API","New__,Modify__,Remove__");
      headset = headblk.getASPRowSet();
      headbar = mgr.newASPCommandBar(headblk);
      headtbl = mgr.newASPTable(headblk);
      headtbl.setTitle("BIDPROJENQJUDGETBLHEAD: Bid Proj Enq Judges");
      headtbl.enableRowSelect();
      headtbl.setWrap();
      headlay = headblk.getASPBlockLayout();
      headlay.setDefaultLayoutMode(headlay.MULTIROW_LAYOUT);
      headbar.addCustomCommand("printReport", "BIDPROJENQJUDGEPRINTREPORT: Print Report...");
      headlay.setDataSpan("BID_DESC", 5);
      headlay.setDataSpan("NOTE", 5);
      headlay.setSimple("ENQUIRY_NAME");
      headlay.setSimple("GENERAL_PROJECT_PROJ_DESC");
      headlay.setSimple("CREATE_BID_NAME");
      headlay.setSimple("CREATE_PERSON_NAME");
      headlay.setSimple("START_ORG_NAME");
      headlay.setSimple("VIEW_REF_FILE");
      headbar.addCustomCommand("activateITEM1",mgr.translate("BIDPROJENQRESULT: Bid Proj Enq Result"));
      headbar.addCustomCommand("activateITEM2",mgr.translate("BIDJUDGEQUANLIST: Bid Judge Quan List"));
 
      bid_proj_enq_result_blk = mgr.newASPBlock("ITEM1");
      bid_proj_enq_result_blk.addField("ITEM0_OBJID").
                              setHidden().
                              setDbName("OBJID");
      bid_proj_enq_result_blk.addField("ITEM0_OBJVERSION").
                              setHidden().
                              setDbName("OBJVERSION");
      bid_proj_enq_result_blk.addField("ITEM0_PROJ_NO").
                              setDbName("PROJ_NO").
                              setHidden().
                              setLabel("BIDPROJENQRESULTITEM0PROJNO: Proj No").
                              setSize(30);
      bid_proj_enq_result_blk.addField("ITEM0_CRE_ID").
                              setDbName("CRE_ID").
                              setHidden().
                              setLabel("BIDPROJENQRESULTITEM0CREID: Cre Id").
                              setSize(30);
      bid_proj_enq_result_blk.addField("ITEM0_BID_PROJ_ID").
                              setDbName("BID_PROJ_ID").
                              setHidden().
                              setLabel("BIDPROJENQRESULTITEM0BIDPROJID: Bid Proj Id").
                              setSize(30);
      bid_proj_enq_result_blk.addField("ITEM0_ID").
                              setDbName("ID").
                              setHidden().
                              setLabel("BIDPROJENQRESULTITEM0ID: Id").
                              setSize(30);
      bid_proj_enq_result_blk.addField("LINE_NO").
                              setHidden().
                              setLabel("BIDPROJENQRESULTLINENO: Line No").
                              setSize(30);
      bid_proj_enq_result_blk.addField("ORG_NAME").
                              setInsertable().
                              setLabel("BIDPROJENQRESULTORGNAME: Org Name").
                              setDynamicLOV("BID_PROJPRE_ENQ_ORG", "ITEM0_PROJ_NO,ITEM0_CRE_ID,ITEM0_BID_PROJ_ID").
                              setLOVProperty("FORCE_KEY", "ORG_NAME").
                              setSize(30);
      bid_proj_enq_result_blk.addField("QUOTE","Number").
                              setInsertable().
                              setLabel("BIDPROJENQRESULTQUOTE: Quote").
                              setSize(30);
      bid_proj_enq_result_blk.addField("TECH_JUDGE").
                              setInsertable().
                              setLabel("BIDPROJENQRESULTTECHJUDGE: Tech Judge").
                              setSize(30);
      bid_proj_enq_result_blk.addField("BUSS_JUDGE").
                              setInsertable().
                              setLabel("BIDPROJENQRESULTBUSSJUDGE: Buss Judge").
                              setSize(30);
      bid_proj_enq_result_blk.addField("JUDGE_RANK").
                              setInsertable().
                              setLabel("BIDPROJENQRESULTJUDGERANK: Judge Rank").
                              setSize(30);
      bid_proj_enq_result_blk.addField("IS_BID").
                              setInsertable().
                              setCheckBox("FALSE,TRUE").
                              setLabel("BIDPROJENQRESULTISBID: Is Bid").
                              setSize(30);
      bid_proj_enq_result_blk.setView("BID_PROJ_ENQ_RESULT");
      bid_proj_enq_result_blk.defineCommand("BID_PROJ_ENQ_RESULT_API","New__,Modify__,Remove__");
      bid_proj_enq_result_blk.setMasterBlock(headblk);
      bid_proj_enq_result_set = bid_proj_enq_result_blk.getASPRowSet();
      bid_proj_enq_result_bar = mgr.newASPCommandBar(bid_proj_enq_result_blk);
      bid_proj_enq_result_bar.defineCommand(bid_proj_enq_result_bar.OKFIND, "okFindITEM1");
      bid_proj_enq_result_bar.defineCommand(bid_proj_enq_result_bar.NEWROW, "newRowITEM1");
      bid_proj_enq_result_tbl = mgr.newASPTable(bid_proj_enq_result_blk);
      bid_proj_enq_result_tbl.setTitle("BIDPROJENQRESULTITEMHEAD1: BidProjEnqResult");
      bid_proj_enq_result_tbl.enableRowSelect();
      bid_proj_enq_result_tbl.setWrap();
      bid_proj_enq_result_lay = bid_proj_enq_result_blk.getASPBlockLayout();
      bid_proj_enq_result_lay.setDefaultLayoutMode(bid_proj_enq_result_lay.MULTIROW_LAYOUT);

      bid_judge_quan_list_blk = mgr.newASPBlock("ITEM2");
      bid_judge_quan_list_blk.addField("ITEM1_OBJID").
                              setHidden().
                              setDbName("OBJID");
      bid_judge_quan_list_blk.addField("ITEM1_OBJVERSION").
                              setHidden().
                              setDbName("OBJVERSION");
      bid_judge_quan_list_blk.addField("ITEM1_PROJ_NO").
                              setDbName("PROJ_NO").
                              setHidden().
                              setLabel("BIDJUDGEQUANLISTITEM1PROJNO: Proj No").
                              setSize(30);
      bid_judge_quan_list_blk.addField("ITEM1_CRE_ID").
                              setDbName("CRE_ID").
                              setHidden().
                              setLabel("BIDJUDGEQUANLISTITEM1CREID: Cre Id").
                              setSize(30);
      bid_judge_quan_list_blk.addField("ITEM1_BID_PROJ_ID").
                              setDbName("BID_PROJ_ID").
                              setHidden().
                              setLabel("BIDJUDGEQUANLISTITEM1BIDPROJID: Bid Proj Id").
                              setSize(30);
      bid_judge_quan_list_blk.addField("ITEM1_ID").
                              setDbName("ID").
                              setHidden().
                              setLabel("BIDJUDGEQUANLISTITEM1ID: Id").
                              setSize(30);
      bid_judge_quan_list_blk.addField("ITEM1_LINE_NO").
                              setDbName("LINE_NO").
                              setHidden().
                              setLabel("BIDJUDGEQUANLISTITEM1LINENO: Line No").
                              setSize(30);
      bid_judge_quan_list_blk.addField("ITEM1_ORG_NAME").
                              setDbName("ORG_NAME").
                              setInsertable().
                              setHidden().
                              setLabel("BIDJUDGEQUANLISTITEM1ORGNAME: Org Name").
                              setSize(30);
      bid_judge_quan_list_blk.addField("ITEM1_DOC_ID").
                              setDbName("DOC_ID").
                              setHidden().
                              setLabel("BIDJUDGEQUANLISTDOCID: Doc Id").
                              setSize(30); 
      bid_judge_quan_list_blk.addField("QUAN_LINE_NO").
                              setReadOnly().
                              setLabel("BIDJUDGEQUANLISTQUANLINENO: Quan Line No").
                              setCustomValidation("ITEM1_PROJ_NO,ITEM1_CRE_ID,DOC_ID,QUAN_LINE_NO", "BUDGET_UNIT_CODE,BUDGET_TOTAL_PRICE,COUNT,BUDGET_FEE_NAME,VERIFY_PRICE,BUDGET_LINE_NO,BUDGET_NAME,BUDGET_PRICE,BUDGET_AMOUNT").
                              setSize(30);
      bid_judge_quan_list_blk.addField("BUDGET_LINE_NO").
                              setFunction("BID_ENQ_QUAN_LIST_API.Get_Budget_Line_No ( :ITEM1_PROJ_NO, :ITEM1_CRE_ID,:DOC_ID,:QUAN_LINE_NO)").
                              setLabel("BIDPROJENQJUDGEBUDGETLINENO: Budget Line No").
                              setReadOnly().
                              setSize(30);
      bid_judge_quan_list_blk.addField("BUDGET_NAME").
                              setLabel("BIDPROJENQJUDGEBUDGETNAME: Budget Name").
                              setFunction("PROJECT_BUDGET_LINE_API.GET_BUDGET_NAME ( :PROJ_NO,BID_ENQ_QUAN_LIST_API.Get_Budget_Line_No ( :ITEM1_PROJ_NO, :ITEM1_CRE_ID,:DOC_ID,:QUAN_LINE_NO))").
                              setSize(30).
                              setReadOnly();
      bid_judge_quan_list_blk.addField("BUDGET_PRICE","Number","#0.00").
                              setLabel("BIDPROJENQJUDGEBUDGETPRICE: Budget Price").
                              setFunction("PROJECT_BUDGET_LINE_API.GET_PRICE ( :PROJ_NO,BID_ENQ_QUAN_LIST_API.Get_Budget_Line_No ( :ITEM1_PROJ_NO, :ITEM1_CRE_ID,:DOC_ID,:QUAN_LINE_NO))").
                              setSize(30).
                              setReadOnly();
      bid_judge_quan_list_blk.addField("BUDGET_AMOUNT","Number","#0.00").
                              setLabel("BIDPROJENQJUDGEBUDGETAMOUNT: Budget Amount").
                              setFunction("PROJECT_BUDGET_LINE_API.GET_AMOUNT ( :PROJ_NO,BID_ENQ_QUAN_LIST_API.Get_Budget_Line_No ( :ITEM1_PROJ_NO, :ITEM1_CRE_ID,:DOC_ID,:QUAN_LINE_NO))").
                              setSize(30).
                              setReadOnly();
      bid_judge_quan_list_blk.addField("BUDGET_FEE_NAME").
                              setFunction("BID_ENQ_QUAN_LIST_API.Get_Fee_Name ( :ITEM1_PROJ_NO, :ITEM1_CRE_ID,:DOC_ID,:QUAN_LINE_NO)").
                              setLabel("BIDPROJENQJUDGEBUDGETFEENAME: Budget Fee Name").
                              setReadOnly().
                              setSize(30);
      bid_judge_quan_list_blk.addField("BUDGET_UNIT_CODE").
                              setFunction("BID_ENQ_QUAN_LIST_API.Get_Unit_Code ( :ITEM1_PROJ_NO, :ITEM1_CRE_ID,:DOC_ID,:QUAN_LINE_NO)").
                              setLabel("BIDPROJENQJUDGEBUDGETUNITCODE: Budget Unit Code").
                              setReadOnly().
                              setSize(30);
      bid_judge_quan_list_blk.addField("VERIFY_PRICE","Number","#0.00").
                              setFunction("BID_ENQ_QUAN_LIST_API.Get_Price ( :ITEM1_PROJ_NO, :ITEM1_CRE_ID,:DOC_ID,:QUAN_LINE_NO)").
                              setLabel("BIDPROJENQJUDGEVERIFYPRICE: Verify Price").
                              setReadOnly().
                              setHidden().
                              setSize(30);
      bid_judge_quan_list_blk.addField("PRICE","Number","#0.00").
                              setLabel("BIDPROJENQJUDGEPRICE: Price").
                              setInsertable().
                              setCustomValidation("COUNT,PRICE", "TOTAL_PRICE").
                              setSize(30);
      bid_judge_quan_list_blk.addField("COUNT","Number","#0.00").
                              setLabel("BIDPROJENQJUDGECOUNT: Count").
                              setInsertable().
                              setCustomValidation("COUNT,PRICE", "TOTAL_PRICE").
                              setSize(30);
      bid_judge_quan_list_blk.addField("TOTAL_PRICE","Number","#0.00").
                              setLabel("BIDPROJENQJUDGETOTALPRICE: Total Price").
                              setReadOnly().
                              setSize(30);
      bid_judge_quan_list_blk.addField("BUDGET_TOTAL_PRICE","Number","#0.00").
                              setFunction("BID_ENQ_QUAN_LIST_API.Get_Total_Price ( :ITEM1_PROJ_NO, :ITEM1_CRE_ID,:DOC_ID,:QUAN_LINE_NO)").
                              setLabel("BIDPROJENQJUDGEBUDGETTOTALPRICE: Budget Total Price").
                              setReadOnly().
                              setHidden().
                              setSize(30);


      
      bid_judge_quan_list_blk.setView("BID_JUDGE_QUAN_LIST");
      bid_judge_quan_list_blk.defineCommand("BID_JUDGE_QUAN_LIST_API","Modify__");
      bid_judge_quan_list_blk.setMasterBlock(headblk);
      bid_judge_quan_list_set = bid_judge_quan_list_blk.getASPRowSet();
      bid_judge_quan_list_bar = mgr.newASPCommandBar(bid_judge_quan_list_blk);
      bid_judge_quan_list_bar.defineCommand(bid_judge_quan_list_bar.OKFIND, "okFindITEM2");
      bid_judge_quan_list_bar.defineCommand(bid_judge_quan_list_bar.NEWROW, "newRowITEM2");
      bid_judge_quan_list_tbl = mgr.newASPTable(bid_judge_quan_list_blk);
      bid_judge_quan_list_tbl.setTitle("BIDJUDGEQUANLISTITEMHEAD2: BidJudgeQuanList");
      bid_judge_quan_list_tbl.enableRowSelect();
      bid_judge_quan_list_tbl.setWrap();
      bid_judge_quan_list_lay = bid_judge_quan_list_blk.getASPBlockLayout();
      bid_judge_quan_list_lay.setDefaultLayoutMode(bid_judge_quan_list_lay.MULTIROW_LAYOUT);

      tabs = newASPTabContainer("TAB");      
      tabs.addTab("BIDPROJENQRESULT: Bid Proj Enq Result","javascript:commandSet('MAIN.activateITEM1','')");
      tabs.addTab("BIDJUDGEQUANLIST: Bid Judge Quan List","javascript:commandSet('MAIN.activateITEM2','')");
      tabs.setContainerSpace(0);
      tabs.setLeftTabSpace(0);
      tabs.setTabWidth(68);
      tabs.setTableVisibility(false);
      headbar.removeCustomCommand("activateITEM1");
      headbar.removeCustomCommand("activateITEM2");
   }



   public void  adjust()
   {
      // fill function body
   }
   
   public void  printReport() throws FndException, UnsupportedEncodingException//TODO
   {
    ASPManager mgr = getASPManager();
    ASPConfig cfg = getASPConfig();
    String URL=cfg.getParameter("APPLICATION/RUNQIAN/SERVER_URL");
    if (headlay.isMultirowLayout())
       headset.goTo(headset.getRowSelected());
    if (headset.countRows()>0 )
          {   
             String proj_no = headset.getValue("PROJ_NO");
             String bid_proj_id = headset.getValue("BID_PROJ_ID");
             String cre_id = headset.getValue("CRE_ID");
             String id = headset.getValue("ID");
              appendDirtyJavaScript("window.open('"+URL+"/showReport.jsp?raq=BidProjEnqJudge.raq&proj_no="+proj_no+"&accept_id="+cre_id+"&bid_proj_id="+bid_proj_id+"&id="+id
                + "','_blank','height=600, width=780, top=200, left=350, toolbar=no, menubar=no, scrollbars=yes, resizable=yes,location=no, status=no');");                                
         }
   }   
   
   /**
    * Nov20th 2014 add by @natic
    * get Image of doc status
    */
   protected String getImageFieldTag(ASPField imageField, ASPRowSet rowset, int rowNum) throws FndException
   {
      ASPManager mgr = getASPManager();
      String imgSrc = mgr.getASPConfig().getImagesLocation();

      if (rowset.countRows() > 0 && "VIEW_REF_FILE".equals(imageField.getName()))
      {
         if ("TRUE".equals(rowset.getValueAt(rowNum, "EXIST_DOC_REF"))) {
            imgSrc += "folder.gif";
            return "<img src=\"" + imgSrc + "\" height=\"16\" width=\"16\" border=\"0\">";
         }
         else
         {
            return "";
         }
      }
      return "";
   }
   
   //-----------------------------------------------------------------------------
   //------------------------  Presentation functions  ---------------------------
   //-----------------------------------------------------------------------------

   public void activateITEM1() {
      tabs.setActiveTab(1);  
      okFindITEM1();
  }
  public void activateITEM2() {
      tabs.setActiveTab(2); 
      okFindITEM2();
  }      
  
   protected String getDescription()
   {
      return "BIDPROJENQJUDGEDESC: Bid Proj Enq Judge";
   }


   protected String getTitle()
   {
      return "BIDPROJENQJUDGETITLE: Bid Proj Enq Judge";
   }


   protected void printContents() throws FndException
   {
      if (headlay.isVisible())
          appendToHTML(headlay.show());
      else 
      {
         headlay.setLayoutMode(headlay.CUSTOM_LAYOUT);
         appendToHTML(headlay.show());
      }  
      if (  (headlay.isSingleLayout() || headlay.isCustomLayout())) {  
            appendToHTML(tabs.showTabsInit());
            if (tabs.getActiveTab() == 1){
               appendToHTML(bid_proj_enq_result_lay.show());
             }else if (tabs.getActiveTab() == 2){
               appendToHTML(bid_judge_quan_list_lay.show());
               }
               appendToHTML(tabs.showTabsFinish());  
            }            
    
   }
}
