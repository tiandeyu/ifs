/*
*                 IFS Research & Development
*
*  This program is protected by copyright law and by international
*  conventions. All licensing, renting, lending or copying (including
*  for private use), and all other use of the program, which is not
*  expressively permitted by IFS Research & Development (IFS), is a
*  violation of the rights of IFS. Such violations will be reported to the
*  appropriate authorities.
*
*  VIOLATIONS OF ANY COPYRIGHT IS PUNISHABLE BY LAW AND CAN LEAD
*  TO UP TO TWO YEARS OF IMPRISONMENT AND LIABILITY TO PAY DAMAGES.
* ----------------------------------------------------------------------------
* File                          :
* Description                   :
* Notes                         :
* Other Programs Called :
* ----------------------------------------------------------------------------
* Modified    : Automatically generated by IFS/Design
* ----------------------------------------------------------------------------
*/

//-----------------------------------------------------------------------------
//-----------------------------   Package def  ------------------------------
//-----------------------------------------------------------------------------

package ifs.bidmaw;
//-----------------------------------------------------------------------------
//-----------------------------   Import def  ------------------------------
//-----------------------------------------------------------------------------

import ifs.fnd.asp.*;
import ifs.fnd.buffer.*;
import ifs.fnd.service.*;
import ifs.fnd.*;

//-----------------------------------------------------------------------------
//-----------------------------   Class def  ------------------------------
//-----------------------------------------------------------------------------

public class BidEnqDocMan extends ASPPageProvider
{

   //-----------------------------------------------------------------------------
   //---------- Static constants ------------------------------------------------
   //-----------------------------------------------------------------------------

   public static boolean DEBUG = Util.isDebugEnabled("ifs.bidmaw.BidEnqDocMan");

   //-----------------------------------------------------------------------------
   //---------- Header Instances created on page creation --------
   //-----------------------------------------------------------------------------

   private ASPBlock headblk;
   private ASPRowSet headset;
   private ASPCommandBar headbar;
   private ASPTable headtbl;
   private ASPBlockLayout headlay;

   //-----------------------------------------------------------------------------
   //---------- Item Instances created on page creation --------
   //-----------------------------------------------------------------------------

   private ASPBlock bid_enq_quan_list_blk;
   private ASPRowSet bid_enq_quan_list_set;
   private ASPCommandBar bid_enq_quan_list_bar;
   private ASPTable bid_enq_quan_list_tbl;
   private ASPBlockLayout bid_enq_quan_list_lay;

   private ASPBlock bid_enq_mat_list_blk;
   private ASPRowSet bid_enq_mat_list_set;
   private ASPCommandBar bid_enq_mat_list_bar;
   private ASPTable bid_enq_mat_list_tbl;
   private ASPBlockLayout bid_enq_mat_list_lay;
   private ASPTabContainer tabs;

   //-----------------------------------------------------------------------------
   //------------------------  Construction  ---------------------------
   //-----------------------------------------------------------------------------

   public  BidEnqDocMan (ASPManager mgr, String page_path)
   {
      super(mgr,page_path);
   }

   public void run()
   {
      ASPManager mgr = getASPManager();

      if( mgr.commandBarActivated() )
         eval(mgr.commandBarFunction());
      else if(!mgr.isEmpty(mgr.getQueryStringValue("VALIDATE")))
         validate();
      else if(mgr.dataTransfered())
         okFind();
      else if( !mgr.isEmpty(mgr.getQueryStringValue("SEARCH")) )
         okFind();
      else if( !mgr.isEmpty(mgr.getQueryStringValue("DOC_ID")) )
         okFind();
      else
         okFind();
      adjust();
      tabs.saveActiveTab(); 
   }
   //-----------------------------------------------------------------------------
   //------------------------  Command Bar functions  ---------------------------
   //-----------------------------------------------------------------------------

   public void okFind()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;

      mgr.createSearchURL(headblk);
      q = trans.addQuery(headblk);
      q.includeMeta("ALL");
      if(mgr.dataTransfered())
         q.addOrCondition(mgr.getTransferedData());
      mgr.querySubmit(trans,headblk);
      if (  headset.countRows() == 0 )
      {
         mgr.showAlert("BIDENQDOCMANNODATA: No data found.");
         headset.clear();
      }
      eval( bid_enq_quan_list_set.syncItemSets() );
      eval( bid_enq_mat_list_set.syncItemSets() );
   }



   public void countFind()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;

      q = trans.addQuery(headblk);
      q.setSelectList("to_char(count(*)) N");
      mgr.submit(trans);
      headlay.setCountValue(toInt(headset.getValue("N")));
      headset.clear();
   }



   public void newRow()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPBuffer data;
      ASPCommand cmd;

      cmd = trans.addEmptyCommand("HEAD","BID_ENQ_DOC_MAN_API.New__",headblk);
      cmd.setOption("ACTION","PREPARE");
      trans = mgr.perform(trans);
      data = trans.getBuffer("HEAD/DATA");
      headset.addRow(data);
   }


   //-----------------------------------------------------------------------------
   //------------------------  Item block cmd bar functions  ---------------------------
   //-----------------------------------------------------------------------------


   public void okFindITEM1()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      int headrowno;

      q = trans.addQuery(bid_enq_quan_list_blk);
      q.addWhereCondition("PROJ_NO = ? AND CRE_ID = ? AND DOC_ID = ?");
      q.addParameter("PROJ_NO", headset.getValue("PROJ_NO"));
      q.addParameter("CRE_ID", headset.getValue("CRE_ID"));
      q.addParameter("DOC_ID", headset.getValue("DOC_ID"));
      q.includeMeta("ALL");
      headrowno = headset.getCurrentRowNo();
      mgr.querySubmit(trans,bid_enq_quan_list_blk);
      headset.goTo(headrowno);
   }
   public void newRowITEM1()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPCommand cmd;
      ASPBuffer data;

      
      cmd = trans.addEmptyCommand("ITEM1","BID_ENQ_QUAN_LIST_API.New__",bid_enq_quan_list_blk);
      cmd.setOption("ACTION","PREPARE");
      cmd.setParameter("ITEM0_PROJ_NO", headset.getValue("PROJ_NO"));
      cmd.setParameter("ITEM0_CRE_ID", headset.getValue("CRE_ID"));
      cmd.setParameter("ITEM0_DOC_ID", headset.getValue("DOC_ID"));
      trans = mgr.perform(trans);
      data = trans.getBuffer("ITEM1/DATA");
      bid_enq_quan_list_set.addRow(data);
   }
   public void okFindITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      int headrowno;

      q = trans.addQuery(bid_enq_mat_list_blk);
      q.addWhereCondition("PROJ_NO = ? AND CRE_ID = ? AND DOC_ID = ?");
      q.addParameter("PROJ_NO", headset.getValue("PROJ_NO"));
      q.addParameter("CRE_ID", headset.getValue("CRE_ID"));
      q.addParameter("DOC_ID", headset.getValue("DOC_ID"));
      q.includeMeta("ALL");
      headrowno = headset.getCurrentRowNo();
      mgr.querySubmit(trans,bid_enq_mat_list_blk);
      headset.goTo(headrowno);
   }
   public void newRowITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPCommand cmd;
      ASPBuffer data;

      
      cmd = trans.addEmptyCommand("ITEM2","BID_ENQ_MAT_LIST_API.New__",bid_enq_mat_list_blk);
      cmd.setOption("ACTION","PREPARE");
      cmd.setParameter("ITEM1_PROJ_NO", headset.getValue("PROJ_NO"));
      cmd.setParameter("ITEM1_CRE_ID", headset.getValue("CRE_ID"));
      cmd.setParameter("ITEM1_DOC_ID", headset.getValue("DOC_ID"));
      trans = mgr.perform(trans);
      data = trans.getBuffer("ITEM2/DATA");
      bid_enq_mat_list_set.addRow(data);
   }

   public void validate()
   {
       ASPManager mgr = getASPManager();
       ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
       ASPTransactionBuffer trans1 = mgr.newASPTransactionBuffer();
       String val = mgr.readValue("VALIDATE");    
       ASPCommand cmd;
       ASPCommand cmd1;
       String txt = "";
       String createBidName = "";
       String bidProjType = "";
       String budgetName = "";
       String budgetAmount = "";
       String budgetPrice = "";
       String matName,matProdModel;
       String budgetLineNo,budgetName2;
       String budgetName1="";
       String unitCode1="";
       String amount1="";
       String price1="";
       float tempValue = 0;
       String purchTypeNo = "";
       String desc = "";
       
       if ("CRE_ID".equals(val)) {         
          cmd = trans.addCustomFunction("CREATEBIDNAME", 
                "BID_CRE_PROJ_APPLY_API.GET_CREATE_BID_NAME", "CREATE_BID_NAME");
          cmd.addParameter("PROJ_NO, CRE_ID");
          
          cmd = trans.addCustomFunction("BIDPROJTYPE", 
                "BID_CRE_PROJ_APPLY_API.Get_Bid_Proj_Type", "BID_PROJ_TYPE");
          cmd.addParameter("PROJ_NO, CRE_ID");
          
          cmd = trans.addCustomFunction("PURCHTYPENO", 
                "BID_CRE_PROJ_APPLY_API.GET_PURCH_TYPE_NO", "PURCH_TYPE_NO");
          cmd.addParameter("PROJ_NO, CRE_ID");
          
          trans = mgr.validate(trans);
          createBidName = trans.getValue("CREATEBIDNAME/DATA/CREATE_BID_NAME");
          bidProjType = trans.getValue("BIDPROJTYPE/DATA/BID_PROJ_TYPE");
          purchTypeNo = trans.getValue("PURCHTYPENO/DATA/PURCH_TYPE_NO");
          
          cmd1 = trans1.addCustomFunction("DESCRIPTION", 
                "CONTRACT_PURCH_TYPE_API.GET_DESCRIPTION", "DESCRIPTION");
          cmd1.addParameter("PURCH_TYPE_NO",purchTypeNo);
          
          trans1 = mgr.validate(trans1);
          desc = trans1.getValue("DESCRIPTION/DATA/DESCRIPTION");
          
          txt = ((mgr.isEmpty(createBidName)) ? "" : createBidName) + "^" + 
                ((mgr.isEmpty(bidProjType)) ? "" : bidProjType )+ "^" + 
                ((mgr.isEmpty(purchTypeNo)) ? "" : purchTypeNo )+ "^" + 
                ((mgr.isEmpty(desc)) ? "" : desc )+ "^";
          mgr.responseWrite(txt);
       }
       else if("BUDGET_LINE_NO".equals(val)){
          cmd = trans.addCustomFunction("BUDGETNAME", 
                "PROJECT_BUDGET_LINE_API.Get_Budget_Name", "BUDGET_NAME");
          cmd.addParameter("ITEM0_PROJ_NO,BUDGET_LINE_NO");
          
          cmd = trans.addCustomFunction("BUDGETAMOUNT", 
                "PROJECT_BUDGET_LINE_API.Get_Amount", "BUDGET_AMOUNT");
          cmd.addParameter("ITEM0_PROJ_NO,BUDGET_LINE_NO");
          
          cmd = trans.addCustomFunction("BUDGETPRICE", 
                "PROJECT_BUDGET_LINE_API.Get_Price", "BUDGET_PRICE");
          cmd.addParameter("ITEM0_PROJ_NO,BUDGET_LINE_NO");
          
          trans = mgr.validate(trans);
          budgetName = trans.getValue("BUDGETNAME/DATA/BUDGET_NAME");
          budgetAmount = trans.getValue("BUDGETAMOUNT/DATA/BUDGET_AMOUNT");
          budgetPrice = trans.getValue("BUDGETPRICE/DATA/BUDGET_PRICE");
          txt = ((mgr.isEmpty(budgetName)) ? "" : budgetName) + "^" + ((mgr.isEmpty(budgetAmount)) ? "0" : budgetAmount) + "^";
          txt = txt + ((mgr.isEmpty(budgetPrice)) ? "0" : budgetPrice) + "^";
          mgr.responseWrite(txt);
       }
       else if("ITEM1_BUDGET_LINE_NO".equals(val)){
          cmd = trans.addCustomFunction("GETITEM1BUDGETNAME", 
                "PROJECT_BUDGET_LINE_API.GET_BUDGET_NAME", "ITEM1_BUDGET_NAME");
          cmd.addParameter("PROJ_NO,ITEM1_BUDGET_LINE_NO");
          
          cmd = trans.addCustomFunction("GETITEM1AMOUNT", 
                "PROJECT_BUDGET_LINE_API.GET_AMOUNT", "ITEM1_AMOUNT");
          cmd.addParameter("PROJ_NO,ITEM1_BUDGET_LINE_NO");
          
          cmd = trans.addCustomFunction("GETITEM2PRICE", 
                "PROJECT_BUDGET_LINE_API.GET_PRICE", "ITEM2_PRICE");
          cmd.addParameter("PROJ_NO,ITEM1_BUDGET_LINE_NO");
          
          cmd = trans.addCustomFunction("GETITEM1UNITCODE", 
                "PROJECT_BUDGET_LINE_API.GET_UNIT_CODE", "ITEM1_UNIT_CODE");
          cmd.addParameter("PROJ_NO,ITEM1_BUDGET_LINE_NO");
          trans = mgr.validate(trans);
          
          budgetName1 = trans.getValue("GETITEM1BUDGETNAME/DATA/ITEM1_BUDGET_NAME");
          amount1 = trans.getValue("GETITEM1AMOUNT/DATA/ITEM1_AMOUNT");
          price1 = trans.getValue("GETITEM2PRICE/DATA/ITEM2_PRICE");
          unitCode1 = trans.getValue("GETITEM1UNITCODE/DATA/ITEM1_UNIT_CODE");
          
          txt = ((mgr.isEmpty(budgetName1)) ? "" : budgetName1) + "^" + 
             ((mgr.isEmpty(amount1)) ? "" : amount1) + "^" +
             ((mgr.isEmpty(price1)) ? "" : price1) + "^" +
          ((mgr.isEmpty(unitCode1)) ? "" : unitCode1) + "^";
    
          mgr.responseWrite(txt);
       }
       else if("MAT_NO".equals(val)){
          cmd = trans.addCustomFunction("MATNAME", 
                "MAT_CODE_API.Get_Mat_Name", "MAT_NAME");
          cmd.addParameter("ITEM1_PROJ_NO, MAT_NO");
          
          cmd = trans.addCustomFunction("PRODMODEL", 
                "MAT_CODE_API.Get_Prod_Model", "PROD_MODLE");
          cmd.addParameter("ITEM1_PROJ_NO, MAT_NO");
          
         /* cmd = trans.addCustomFunction("ITEM1BUDGETLINENO", 
                "MAT_CODE_API.Get_Budget_Line_No", "ITEM1_BUDGET_LINE_NO");
          cmd.addParameter("ITEM1_PROJ_NO, MAT_NO");*/
          
          trans = mgr.validate(trans);
          matName = trans.getValue("MATNAME/DATA/MAT_NAME");
          matProdModel = trans.getValue("PRODMODEL/DATA/PROD_MODLE");
//          budgetLineNo = trans.getValue("ITEM1BUDGETLINENO/DATA/ITEM1_BUDGET_LINE_NO");
          
         /* cmd1 = trans1.addCustomFunction("ITEM1BUDGETNAME", 
                "PROJECT_BUDGET_LINE_API.GET_BUDGET_NAME", "ITEM1_BUDGET_NAME");
          cmd1.addParameter("ITEM1_PROJ_NO");
          cmd1.addParameter("ITEM1_BUDGET_LINE_NO",budgetLineNo);
          trans1= mgr.validate(trans1);
          budgetName2 = trans1.getValue("ITEM1BUDGETNAME/DATA/ITEM1_BUDGET_NAME");*/
          
          txt = ((mgr.isEmpty(matName)) ? "" : matName )+ "^" + 
          ((mgr.isEmpty(matProdModel)) ? "" : matProdModel )+ "^";
          /*((mgr.isEmpty(budgetLineNo)) ? "" : budgetLineNo )+ "^" +
          ((mgr.isEmpty(budgetName2)) ? "" : budgetName2 )+ "^";*/
          mgr.responseWrite(txt);
       }else 
        {
          if("COUNT".equals(val)) {         
             tempValue = ((mgr.readValue("COUNT")==null)?0:Float.parseFloat(mgr.readValue("COUNT")))*((mgr.readValue("PRICE")==null)?0:Float.parseFloat(mgr.readValue("PRICE")));
           }
           else if("PRICE".equals(val)){
              tempValue = ((mgr.readValue("COUNT")==null)?0:Float.parseFloat(mgr.readValue("COUNT")))*((mgr.readValue("PRICE")==null)?0:Float.parseFloat(mgr.readValue("PRICE")));
           }else if ("ITEM1_COUNT".equals(val)) {         
             tempValue = ((mgr.readValue("ITEM1_COUNT")==null)?0:Float.parseFloat(mgr.readValue("ITEM1_COUNT")))*((mgr.readValue("ITEM1_PRICE")==null)?0:Float.parseFloat(mgr.readValue("ITEM1_PRICE")));
           }
           else if("ITEM1_PRICE".equals(val)){
              tempValue = ((mgr.readValue("ITEM1_COUNT")==null)?0:Float.parseFloat(mgr.readValue("ITEM1_COUNT")))*((mgr.readValue("ITEM1_PRICE")==null)?0:Float.parseFloat(mgr.readValue("ITEM1_PRICE")));
           }
           mgr.responseWrite(String.valueOf(tempValue)+"^");
       }
       mgr.endResponse();
   }
   //-----------------------------------------------------------------------------
   //------------------------  Predefines Head ---------------------------
   //-----------------------------------------------------------------------------

   public void  preDefine()
   {
      ASPManager mgr = getASPManager();

      headblk = mgr.newASPBlock("MAIN");
      headblk.addField("OBJID").
              setHidden();
      headblk.addField("OBJVERSION").
              setHidden();
      headblk.addField("PROJ_NO").
              setMandatory().
              setInsertable().
              setDynamicLOV("GENERAL_PROJECT",600,445).
              setLabel("BIDENQDOCMANPROJNO: Proj No").
              setSize(30);
      headblk.addField("GENERAL_PROJECT_PROJ_DESC").
              setFunction("GENERAL_PROJECT_API.GET_PROJ_DESC ( :PROJ_NO)").
              setLabel("PBMCREPROJAPPLYGENERALPROJECTPROJDESC: General Project Proj Desc").
              setReadOnly().
              setSize(25);
      mgr.getASPField("PROJ_NO").setValidation("GENERAL_PROJECT_PROJ_DESC");
      headblk.addField("CRE_ID").
              setMandatory().
              setInsertable().
              setDynamicLOV("BID_CRE_PROJ_APPLY_LOV","PROJ_NO").
              setLOVProperty("WHERE", "STATUS='2'"). 
              setLabel("BIDENQDOCMANCREID: Cre Id").
              setCustomValidation("PROJ_NO,CRE_ID", "CREATE_BID_NAME,BID_PROJ_TYPE,PURCH_TYPE_NO,DESCRIPTION").
              setSize(30);
      headblk.addField("CREATE_BID_NAME").
              setFunction("BID_CRE_PROJ_APPLY_API.GET_CREATE_BID_NAME ( :PROJ_NO, :CRE_ID)").
              setLabel("PBMCREPROJAPPLYCREATEBIDNAME: Create Bid Name").
              setReadOnly().
              setSize(25);
      headblk.addField("DOC_ID").
              setHidden().
              setInsertable().
              setLabel("BIDENQDOCMANDOCID: Doc Id").
              setSize(200);
      headblk.addField("ENQUIRY_NO").
              setInsertable().
              setLabel("BIDENQDOCMANENQUIRYNO: Enquiry No").
              setSize(30);
      headblk.addField("ENQUIRY_NAME").
              setInsertable().
              setLabel("BIDENQDOCMANENQUIRYNAME: Enquiry Name").
              setSize(30);
      headblk.addField("PLAN_TIME","Date").
              setInsertable().
              setLabel("BIDENQDOCMANPLANTIME: Plan Time").
              setSize(30);
      headblk.addField("CREATE_TIME","Date").
              setInsertable().
              setLabel("BIDENQDOCMANCREATETIME: Create Time").
              setSize(30);
      headblk.addField("CREATE_PERSON").
              setReadOnly().
              setLabel("BIDENQDOCMANCREATEPERSON: Create Person").
              setSize(30);
      headblk.addField("CREATE_PERSON_NAME").
              setFunction("PERSON_INFO_API.GET_NAME ( :CREATE_PERSON)").
              setLabel("BIDMATENQJUDGECREATEPERSONNAME: Create Person Name").
              setSize(30).
              setReadOnly();
      headblk.addField("CREATE_ORG").
              setInsertable().
              setLabel("BIDENQDOCMANCREATEORG: Create Org").
              setSize(30).
              setDynamicLOV("GENERAL_ORGANIZATION");
      headblk.addField("START_ORG_NAME").
              setFunction("GENERAL_ORGANIZATION_API.Get_Org_Desc(:CREATE_ORG)").
              setLabel("CONPROJCONNECTIONLISTFREENOREPLYSTARTORGNAME: Start Org Name").
              setSize(30).
              setReadOnly();
      mgr.getASPField("CREATE_ORG").setValidation("START_ORG_NAME");
      headblk.addField("STATUS").
              setHidden().
              setLabel("BIDENQDOCMANSTATUS: Status").
              setSize(30);
      headblk.addField("BID_PROJ_TYPE").
              setReadOnly().
              setLabel("BIDENQDOCMANBIDPROJTYPE: Bid Proj Type").
              setSize(30);
      headblk.addField("BID_PROJ_TYPE_DB").
              setHidden().
              setLabel("BIDENQDOCMANBIDPROJTYPE: Bid Proj Type").
              setSize(30);
      headblk.addField("PURCH_TYPE_NO").
              setReadOnly().
              setDynamicLOV("CONTRACT_PURCH_TYPE").
              setLabel("BIDENQDOCMANPURCHTYPENO: Purch Type No").
              setSize(30);
      headblk.addField("DESCRIPTION").
              setFunction("CONTRACT_PURCH_TYPE_API.Get_Description ( :PURCH_TYPE_NO)").
              setLabel("PBMCREPROJAPPLYPURCHTYPEDESCRIPTION: Purch Type Description").
              setReadOnly().
              setSize(30);
      headblk.addField("NOTE").
              setInsertable().
              setLabel("BIDENQDOCMANNOTE: Note").
              setHeight(4).
              setSize(129);
      headblk.setView("BID_ENQ_DOC_MAN");
      headblk.defineCommand("BID_ENQ_DOC_MAN_API","New__,Modify__,Remove__");
      headset = headblk.getASPRowSet();
      headbar = mgr.newASPCommandBar(headblk);
      headtbl = mgr.newASPTable(headblk);
      headtbl.setTitle("BIDENQDOCMANTBLHEAD: Bid Enq Doc Mans");
      headtbl.enableRowSelect();
      headtbl.setWrap();
      headlay = headblk.getASPBlockLayout();
      headlay.setDefaultLayoutMode(headlay.MULTIROW_LAYOUT);
      headlay.setDataSpan("NOTE", 5);
      headbar.addCustomCommand("activateITEM1",mgr.translate("BIDENQQUANLIST: Bid Enq Quan List"));
      headbar.addCustomCommand("activateITEM2",mgr.translate("BIDENQMATLIST: Bid Enq Mat List"));
      headlay.setSimple("DESCRIPTION");
      headlay.setSimple("GENERAL_PROJECT_PROJ_DESC");
      headlay.setSimple("CREATE_BID_NAME");
      headlay.setSimple("CREATE_PERSON_NAME");
      headlay.setSimple("START_ORG_NAME");
      
      bid_enq_quan_list_blk = mgr.newASPBlock("ITEM1");
      bid_enq_quan_list_blk.addField("ITEM0_OBJID").
                            setHidden().
                            setDbName("OBJID");
      bid_enq_quan_list_blk.addField("ITEM0_OBJVERSION").
                            setHidden().
                            setDbName("OBJVERSION");
      bid_enq_quan_list_blk.addField("ITEM0_PROJ_NO").
                            setDbName("PROJ_NO").
                            setMandatory().
                            setHidden().
                            setLabel("BIDENQQUANLISTITEM0PROJNO: Proj No").
                            setSize(30);
      bid_enq_quan_list_blk.addField("ITEM0_CRE_ID").
                            setDbName("CRE_ID").
                            setMandatory().
                            setHidden().
                            setLabel("BIDENQQUANLISTITEM0CREID: Cre Id").
                            setSize(30);
      bid_enq_quan_list_blk.addField("ITEM0_DOC_ID").
                            setDbName("DOC_ID").
                            setHidden().
                            setMandatory().
                            setLabel("BIDENQQUANLISTITEM0DOCID: Doc Id").
                            setSize(30);
      bid_enq_quan_list_blk.addField("QUAN_LINE_NO").
                            setMandatory().
                            setHidden().
                            setLabel("BIDENQQUANLISTQUANLINENO: Quan Line No").
                            setSize(30);
      bid_enq_quan_list_blk.addField("BUDGET_LINE_NO").
                            setInsertable().
                            setDynamicLOV("PROJECT_BUDGET_LINE","ITEM0_PROJ_NO PROJ_NO").
                            setLOVProperty("WHERE", "STATUS='1'").  
                      /*      setLOVProperty("ORDER_BY", "BUDGET_LINE_NO").
                            setLOVProperty("TREE_PARE_FIELD", "PARENT_NO").
                            setLOVProperty("TREE_DISP_FIELD", "BUDGET_LINE_NO,BUDGET_NAME").*/
                            setLabel("BIDENQQUANLISTBUDGETLINENO: Budget Line No").
                            setCustomValidation("ITEM0_PROJ_NO,BUDGET_LINE_NO", "BUDGET_NAME,BUDGET_AMOUNT,BUDGET_PRICE").
                            setSize(30);
      bid_enq_quan_list_blk.addField("BUDGET_NAME").
                            setFunction("PROJECT_BUDGET_LINE_API.Get_Budget_Name ( :ITEM0_PROJ_NO, :BUDGET_LINE_NO)").
                            setLabel("PBMCREPROJAPPLYBUDGETNAME: Budget Name").
                            setReadOnly().
                            setSize(30);
      bid_enq_quan_list_blk.addField("BUDGET_AMOUNT","Number","#0.00").
                            setFunction("PROJECT_BUDGET_LINE_API.Get_Amount ( :ITEM0_PROJ_NO, :BUDGET_LINE_NO)").
                            setLabel("PBMCREPROJAPPLYBUDGETAMOUNT: Budget Amount").
                            setReadOnly().
                            setSize(30);
      bid_enq_quan_list_blk.addField("BUDGET_PRICE","Number","#0.00").
                            setFunction("PROJECT_BUDGET_LINE_API.Get_Price ( :ITEM0_PROJ_NO, :BUDGET_LINE_NO)").
                            setLabel("PBMCREPROJAPPLYBUDGETPRICE: Budget Price").
                            setReadOnly().
                            setSize(30);
      
      bid_enq_quan_list_blk.addField("CONTRACT_SIGN_COUNT","Number").
                            setInsertable().
                            setHidden().
                            setLabel("BIDENQQUANLISTCONTRACTSIGNCOUNT: Contract Sign Count").
                            setSize(30);
      bid_enq_quan_list_blk.addField("CONTRACT_SIGN_AMOUNT","Number").
                            setInsertable().
                            setHidden().
                            setLabel("BIDENQQUANLISTCONTRACTSIGNAMOUNT: Contract Sign Amount").
                            setSize(30);
      bid_enq_quan_list_blk.addField("FEE_NAME").
                            setInsertable().
                            setLabel("BIDENQQUANLISTFEENAME: Fee Name").
                            setSize(30);
      bid_enq_quan_list_blk.addField("UNIT_CODE").
                            setLabel("PBMCREPROJAPPLYUNITCODE: Unit Code").
                            setInsertable().
                            setSize(30).
                            setDynamicLOV("ISO_UNIT");
      bid_enq_quan_list_blk.addField("PRICE","Number","#0.00").
                            setInsertable().
                            setHidden().
                            setLabel("BIDENQQUANLISTPRICE: Price").
                            setCustomValidation("PRICE,COUNT","TOTAL_PRICE").
                            setSize(30);
      bid_enq_quan_list_blk.addField("COUNT","Number","#0.00").
                            setInsertable().
                            setLabel("BIDENQQUANLISTCOUNT: Count").
//                            setCustomValidation("PRICE,COUNT","TOTAL_PRICE").
                            setSize(30);
      bid_enq_quan_list_blk.addField("TOTAL_PRICE","Number","#0.00").
                            setReadOnly().
                            setHidden().
                            setLabel("BIDENQQUANLISTTOTALPRICE: Total Price").
                            setSize(30);
      bid_enq_quan_list_blk.setView("BID_ENQ_QUAN_LIST");
      bid_enq_quan_list_blk.defineCommand("BID_ENQ_QUAN_LIST_API","New__,Modify__,Remove__");
      bid_enq_quan_list_blk.setMasterBlock(headblk);
      bid_enq_quan_list_set = bid_enq_quan_list_blk.getASPRowSet();
      bid_enq_quan_list_bar = mgr.newASPCommandBar(bid_enq_quan_list_blk);
      bid_enq_quan_list_bar.defineCommand(bid_enq_quan_list_bar.OKFIND, "okFindITEM1");
      bid_enq_quan_list_bar.defineCommand(bid_enq_quan_list_bar.NEWROW, "newRowITEM1");
      bid_enq_quan_list_tbl = mgr.newASPTable(bid_enq_quan_list_blk);
      bid_enq_quan_list_tbl.setTitle("BIDENQQUANLISTITEMHEAD1: BidEnqQuanList");
      bid_enq_quan_list_tbl.enableRowSelect();
      bid_enq_quan_list_tbl.setWrap();
      bid_enq_quan_list_lay = bid_enq_quan_list_blk.getASPBlockLayout();
      bid_enq_quan_list_lay.setDefaultLayoutMode(bid_enq_quan_list_lay.MULTIROW_LAYOUT);
      
      bid_enq_mat_list_blk = mgr.newASPBlock("ITEM2");
      bid_enq_mat_list_blk.addField("ITEM1_OBJID").
                           setHidden().
                           setDbName("OBJID");
      bid_enq_mat_list_blk.addField("ITEM1_OBJVERSION").
                           setHidden().
                           setDbName("OBJVERSION");
      bid_enq_mat_list_blk.addField("ITEM1_PROJ_NO").
                           setDbName("PROJ_NO").
                           setMandatory().
                           setHidden().
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1PROJNO: Proj No").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_CRE_ID").
                           setDbName("CRE_ID").
                           setHidden().
                           setMandatory().
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1CREID: Cre Id").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_DOC_ID").
                           setDbName("DOC_ID").
                           setMandatory().
                           setInsertable().
                           setHidden().
                           setLabel("BIDENQMATLISTITEM1DOCID: Doc Id").
                           setSize(30);
      bid_enq_mat_list_blk.addField("MAT_LINE_NO").
                           setMandatory().
                           setHidden().
                           setInsertable().
                           setLabel("BIDENQMATLISTMATLINENO: Mat Line No").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_CONTRACT_SIGN_COUNT","Number").
                           setDbName("CONTRACT_SIGN_COUNT").
                           setHidden().
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1CONTRACTSIGNCOUNT: Contract Sign Count").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_CONTRACT_SIGN_AMOUNT","Number").
                           setDbName("CONTRACT_SIGN_AMOUNT").
                           setHidden().
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1CONTRACTSIGNAMOUNT: Contract Sign Amount").
                           setSize(30);
      bid_enq_mat_list_blk.addField("MAT_NO").
                           setInsertable().
                           setLabel("BIDENQMATLISTMATNO: Mat No").
                           setDynamicLOV("MAT_CODE_LOV", "PROJ_NO").
                           setCustomValidation("ITEM1_PROJ_NO,MAT_NO", "MAT_NAME,PROD_MODLE").
                           setSize(30);
      bid_enq_mat_list_blk.addField("MAT_NAME").
                           setReadOnly().
                           setLabel("BIDENQMATLISTMATNAME: Mat Name").
                           setSize(30);
      bid_enq_mat_list_blk.addField("PROD_MODLE").
                           setReadOnly().
                           setLabel("BIDENQMATLISTPRODMODLE: Prod Modle").
                           setSize(30);
      //add budget_no & name
      bid_enq_mat_list_blk.addField("ITEM1_BUDGET_LINE_NO").
                           setDbName("BUDGET_LINE_NO").
                           setInsertable().
                           setLabel("MATCODEBUDGETLINENO: Budget Line No").
                           setDynamicLOV("PROJECT_BUDGET_LINE").
                           setLOVProperty("WHERE", "STATUS='1'").
                           setCustomValidation("PROJ_NO,ITEM1_BUDGET_LINE_NO", "ITEM1_BUDGET_NAME,ITEM1_AMOUNT,ITEM2_PRICE,ITEM1_UNIT_CODE").
                           setSize(30);
      
    //概算编码带出以下字段
      bid_enq_mat_list_blk.addField("ITEM1_BUDGET_NAME").
                           setLabel("BIDMATLISTBUDGETNAME: Budget Name").
                           setFunction("PROJECT_BUDGET_LINE_API.GET_BUDGET_NAME ( :PROJ_NO,:ITEM1_BUDGET_LINE_NO)").
                           setSize(30).
                           setReadOnly();
      bid_enq_mat_list_blk.addField("ITEM1_AMOUNT","Number","#0.00").
                           setLabel("BIDENQDOCMANITEM1AMOUNT: Amount").
                           setFunction("PROJECT_BUDGET_LINE_API.GET_AMOUNT ( :PROJ_NO,:ITEM1_BUDGET_LINE_NO)").
                           setSize(30).
                           setReadOnly();
      bid_enq_mat_list_blk.addField("ITEM2_PRICE","Number","#0.00").
                           setLabel("BIDENQDOCMANITEM2PRICE: Price").
                           setFunction("PROJECT_BUDGET_LINE_API.GET_PRICE ( :PROJ_NO,:ITEM1_BUDGET_LINE_NO)").
                           setSize(30).
                           setReadOnly();
      bid_enq_mat_list_blk.addField("ITEM1_UNIT_CODE").
                           setLabel("BIDMATLISTUNITCODE: Unit Code").
                           setFunction("PROJECT_BUDGET_LINE_API.GET_UNIT_CODE ( :PROJ_NO,:ITEM1_BUDGET_LINE_NO)").
                           setSize(30).
                           setReadOnly();
      
      //end of add
      bid_enq_mat_list_blk.addField("ITEM1_PRICE","Number","#0.00").
                           setDbName("PRICE").
                           setInsertable().
                           setHidden().
                           setLabel("BIDENQMATLISTITEM1PRICE: Price").
                           setCustomValidation("ITEM1_PRICE,ITEM1_COUNT","ITEM1_TOTAL_PRICE").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_COUNT","Number","#0.00").
                           setDbName("COUNT").
                           setInsertable().
                           setLabel("BIDENQMATLISTITEM1COUNT: Count").
                           setCustomValidation("ITEM1_PRICE,ITEM1_COUNT","ITEM1_TOTAL_PRICE").
                           setSize(30);
      bid_enq_mat_list_blk.addField("ITEM1_TOTAL_PRICE","Number","#0.00").
                           setDbName("TOTAL_PRICE").
                           setReadOnly().
                           setHidden().
                           setLabel("BIDENQMATLISTITEM1TOTALPRICE: Total Price").
                           setSize(30);
      
      bid_enq_mat_list_blk.setView("BID_ENQ_MAT_LIST");
      bid_enq_mat_list_blk.defineCommand("BID_ENQ_MAT_LIST_API","New__,Modify__,Remove__");
      bid_enq_mat_list_blk.setMasterBlock(headblk);
      bid_enq_mat_list_set = bid_enq_mat_list_blk.getASPRowSet();
      bid_enq_mat_list_bar = mgr.newASPCommandBar(bid_enq_mat_list_blk);
      bid_enq_mat_list_bar.defineCommand(bid_enq_mat_list_bar.OKFIND, "okFindITEM2");
      bid_enq_mat_list_bar.defineCommand(bid_enq_mat_list_bar.NEWROW, "newRowITEM2");
      bid_enq_mat_list_tbl = mgr.newASPTable(bid_enq_mat_list_blk);
      bid_enq_mat_list_tbl.setTitle("BIDENQMATLISTITEMHEAD2: BidEnqMatList");
      bid_enq_mat_list_tbl.enableRowSelect();
      bid_enq_mat_list_tbl.setWrap();
      bid_enq_mat_list_lay = bid_enq_mat_list_blk.getASPBlockLayout();
      bid_enq_mat_list_lay.setDefaultLayoutMode(bid_enq_mat_list_lay.MULTIROW_LAYOUT);
      bid_enq_mat_list_lay.setSimple("MAT_NAME");
      
      tabs = newASPTabContainer("TAB");      
      tabs.addTab("BIDENQQUANLIST: Bid Enq Quan List","javascript:commandSet('MAIN.activateITEM1','')");
      tabs.addTab("BIDENQMATLIST: Bid Enq Mat List","javascript:commandSet('MAIN.activateITEM2','')");
      tabs.setContainerSpace(0);
      tabs.setLeftTabSpace(0);
      tabs.setTabWidth(68);
      tabs.setTableVisibility(false); 
   }

   public void  adjust()
   {
      // fill function body
      ASPManager mgr = getASPManager();
      String projType;
      if(headset.countRows()>0){
         projType = (headset.getValue("BID_PROJ_TYPE_DB")==null||"".equals(headset.getValue("BID_PROJ_TYPE_DB"))) ? "": headset.getValue("BID_PROJ_TYPE_DB");
         if(projType.equals("PROJECTSERVER")){
            tabs.setTabRemoved(2, true);
         }else{
            tabs.setTabRemoved(1, true);
         }
      }
      headbar.removeCustomCommand("activateITEM1");
      headbar.removeCustomCommand("activateITEM2");
   }

   public String tabsInit()
   {
      return(tabs.showTabsInit());
   }

   public String tabsFinish()
   {
      return(tabs.showTabsFinish());
   } 
   public void activateITEM1() {
      tabs.setActiveTab(1);  
      okFindITEM1();
  }
  public void activateITEM2() {
      tabs.setActiveTab(2); 
      okFindITEM2();
  }      

   //-----------------------------------------------------------------------------
   //------------------------  Presentation functions  ---------------------------
   //-----------------------------------------------------------------------------

   protected String getDescription()
   {
      return "BIDENQDOCMANDESC: Bid Enq Doc Man";
   }


   protected String getTitle()
   {
      return "BIDENQDOCMANTITLE: Bid Enq Doc Man";
   }


   protected void printContents() throws FndException
   {
      if (headlay.isVisible())
          appendToHTML(headlay.show());
      else 
      {
         headlay.setLayoutMode(headlay.CUSTOM_LAYOUT);
         appendToHTML(headlay.show());
      }  
      if(headset.countRows()>0){
         if (  (headlay.isSingleLayout() || headlay.isCustomLayout())) {  
               appendToHTML(tabsInit());
               if (tabs.getActiveTab() == 1){
                   appendToHTML(bid_enq_quan_list_lay.show());
               }else{
                  if (tabs.getActiveTab() == 2){
                      appendToHTML(bid_enq_mat_list_lay.show());
                  }
               }
               appendToHTML(tabsFinish());  
            }            
      }
    }
}
