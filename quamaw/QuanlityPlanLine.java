/*
*                 IFS Research & Development
*
*  This program is protected by copyright law and by international
*  conventions. All licensing, renting, lending or copying (including
*  for private use), and all other use of the program, which is not
*  expressively permitted by IFS Research & Development (IFS), is a
*  violation of the rights of IFS. Such violations will be reported to the
*  appropriate authorities.
*
*  VIOLATIONS OF ANY COPYRIGHT IS PUNISHABLE BY LAW AND CAN LEAD
*  TO UP TO TWO YEARS OF IMPRISONMENT AND LIABILITY TO PAY DAMAGES.
* ----------------------------------------------------------------------------
* File                          :
* Description                   :
* Notes                         :
* Other Programs Called :
* ----------------------------------------------------------------------------
* Modified    : Automatically generated by IFS/Design
* ----------------------------------------------------------------------------
*/

//-----------------------------------------------------------------------------
//-----------------------------   Package def  ------------------------------
//-----------------------------------------------------------------------------

package ifs.quamaw;
//-----------------------------------------------------------------------------
//-----------------------------   Import def  ------------------------------
//-----------------------------------------------------------------------------

import net.sf.morph.reflect.reflectors.SetReflector;
import ifs.fnd.asp.*;
import ifs.fnd.buffer.*;
import ifs.fnd.service.*;
import ifs.fnd.*;

 
//-----------------------------------------------------------------------------
//-----------------------------   Class def  ------------------------------
//-----------------------------------------------------------------------------

public class QuanlityPlanLine extends ASPPageProvider
{

   //-----------------------------------------------------------------------------
   //---------- Static constants ------------------------------------------------
   //-----------------------------------------------------------------------------

   public static boolean DEBUG = Util.isDebugEnabled("ifs.quamaw.QuanlityPlanLines");

   //-----------------------------------------------------------------------------
   //---------- Header Instances created on page creation --------
   //-----------------------------------------------------------------------------

   private ASPBlock headblk;
   private ASPRowSet headset;
   private ASPCommandBar headbar;
   private ASPTable headtbl;
   private ASPBlockLayout headlay;
   
   private ASPBlock quanlity_plan_line_blk;
   private ASPRowSet quanlity_plan_line_set;
   private ASPCommandBar quanlity_plan_line_bar;
   private ASPTable quanlity_plan_line_tbl;
   private ASPBlockLayout quanlity_plan_line_lay;    
   
   private ASPBlock Pending_doc_reference_object_blk;
   private ASPRowSet Pending_doc_reference_object_set;
   private ASPCommandBar Pending_doc_reference_object_bar;
   private ASPTable Pending_doc_reference_object_tbl;
   private ASPBlockLayout Pending_doc_reference_object_lay;
   
   private ASPBlock Conference_doc_reference_object_blk;
   private ASPRowSet Conference_doc_reference_object_set;
   private ASPCommandBar Conference_doc_reference_object_bar;  
   private ASPTable Conference_doc_reference_object_tbl;
   private ASPBlockLayout Conference_doc_reference_object_lay; 
   
   private ASPTabContainer tabs;
   private ASPTabContainer item_tabs;
   
   private String plan_no;
   private String project_no;
   private String proj_type;
   private String sub_proj_no;
   private String standard_no;

   //-----------------------------------------------------------------------------
   //------------------------  Construction  ---------------------------
   //-----------------------------------------------------------------------------

   public  QuanlityPlanLine (ASPManager mgr, String page_path)
   {
      super(mgr,page_path);
   }

   public void run()
   {
      ASPManager mgr = getASPManager();

      if( mgr.commandBarActivated() )
         eval(mgr.commandBarFunction());
      else if(mgr.dataTransfered())
         okFind();
      else if( !mgr.isEmpty(mgr.getQueryStringValue("SUB_PROJ_NO"))&&!mgr.isEmpty(mgr.getQueryStringValue("PLAN_NO"))&&!mgr.isEmpty(mgr.getQueryStringValue("PROJ_NO")) )
         okFind();
      else
         okFindQuery();    
      adjust();
      
      tabs.saveActiveTab(); 
      item_tabs.saveActiveTab(); 
   }
   //-----------------------------------------------------------------------------
   //------------------------  Command Bar functions  ---------------------------
   //-----------------------------------------------------------------------------

   public void  okFindQuery()
   {
//     headset.addRow(null);
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      String projNo;
      String planNo;
      String subProjNo;
      projNo = mgr.getQueryStringValue("PROJ_NO");
      planNo = mgr.getQueryStringValue("PLAN_NO");
//      subProjNo = mgr.getQueryStringValue("SUB_PROJ_NO");
      q = trans.addEmptyQuery(headblk);
      q.addWhereCondition("PROJ_NO = ? AND SUB_PROJ_NO = ? AND PLAN_NO = ?");
//      q.addWhereCondition("PROJ_NO = ?  AND PLAN_NO = ?");
      q.addParameter("PROJ_NO", projNo);
      q.addParameter("SUB_PROJ_NO", "1");
      q.addParameter("PLAN_NO", planNo);
      q.includeMeta("ALL");
      mgr.submit(trans);   
//      okFindITEM11();
      if (  headset.countRows() == 0 )
      {
         mgr.showAlert("QUANLITYPLANLINENODATA: No data found.");
         headset.clear();
      }
   }
   public void okFind()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      String projNo;
      String planNo;
      String subProjNo;

      if(headset.countRows() == 0){      
         projNo = mgr.getQueryStringValue("PROJ_NO");
         planNo = mgr.getQueryStringValue("PLAN_NO");
         subProjNo = mgr.getQueryStringValue("SUB_PROJ_NO");
         q = trans.addEmptyQuery(headblk);
         q.addWhereCondition("PROJ_NO = ? AND SUB_PROJ_NO = ? AND PLAN_NO = ?");
         q.addParameter("PROJ_NO", projNo);
         q.addParameter("SUB_PROJ_NO", subProjNo);
         q.addParameter("PLAN_NO", planNo);
         q.includeMeta("ALL");
         mgr.submit(trans);   
         okFindITEM11();
         if (  headset.countRows() == 0 )
         {
            mgr.showAlert("QUANLITYPLANLINENODATA: No data found.");
            headset.clear();
         }
         
      }else if("".equals(headset.getValueAt(0, "PROJ_NO"))||headset.getValueAt(0, "PROJ_NO") == null){
         headset.addRow(null);
      }
      else{
         projNo = headset.getValueAt(0, "PROJ_NO");
         planNo = headset.getValueAt(0, "PLAN_NO");
         subProjNo = headset.getValueAt(0, "SUB_PROJ_NO"); 
         q = trans.addEmptyQuery(headblk);
         q.addWhereCondition("PROJ_NO = ? AND SUB_PROJ_NO = ? AND PLAN_NO = ?");
         q.addParameter("PROJ_NO", projNo);
         q.addParameter("SUB_PROJ_NO", subProjNo);
         q.addParameter("PLAN_NO", planNo);
         q.includeMeta("ALL");
         mgr.submit(trans);    
         if (  headset.countRows() == 0 )
         {
            mgr.showAlert("QUANLITYPLANLINENODATA: No data found.");
            headset.clear();
         }
         okFindITEM11();
      }
      
   }



   public void countFind()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;

      q = trans.addQuery(headblk);
      q.setSelectList("to_char(count(*)) N");
      mgr.submit(trans);
      headlay.setCountValue(toInt(headset.getValue("N")));
      headset.clear();
   }



   public void newRow()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPBuffer data;
      ASPCommand cmd;

      cmd = trans.addEmptyCommand("ITEM1","PROJECT_TYPE_API.New__",headblk);
      cmd.setOption("ACTION","PREPARE");
      trans = mgr.perform(trans);
      data = trans.getBuffer("ITEM1/DATA");
      headset.addRow(data);
   }  
   
   public void okFindITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      String projNo;
      String planNo;
      String subProjNo;
      
//      if("".equals(headset.getValueAt(0, "PROJ_NO"))||headset.getValueAt(0, "PROJ_NO") == null){
//         quanlity_plan_line_set.addRow(null);            
//      }else{
//         projNo = headset.getValueAt(0, "PROJ_NO");
//         planNo = headset.getValueAt(0, "PLAN_NO");
//         subProjNo = headset.getValueAt(0, "SUB_PROJ_NO"); 
//         q = trans.addEmptyQuery(quanlity_plan_line_blk);
////         q.addWhereCondition("PROJ_NO = ? AND PARENT_PROJ_NO = ? AND PLAN_NO = ?");
//         q.addWhereCondition("PROJ_NO = ? AND PLAN_NO = ?");
//         q.addParameter("PROJ_NO", projNo);
////         q.addParameter("PARENT_PROJ_NO", subProjNo);
//         q.addParameter("PLAN_NO", planNo);
//         if (!mgr.isEmpty(subProjNo)){
//            q.addWhereCondition("sub_proj_no IN (SELECT sub_proj_no from QUANLITY_PLAN_LINE WHERE PROJ_NO = ? AND  PLAN_NO = ? START WITH parent_proj_no  = ? connect by prior sub_proj_no = parent_proj_no) ");
//            q.addParameter("ITEM0_PROJ_NO",projNo);
//            q.addParameter("ITEM0_PLAN_NO",planNo);    
//            q.addParameter("ITEM0_SUB_PROJ_NO", subProjNo);  
//        }
         projNo = headset.getValueAt(0, "PROJ_NO");
         planNo = headset.getValueAt(0, "PLAN_NO");
         subProjNo = headset.getValueAt(0, "SUB_PROJ_NO");
         mgr.createSearchURL(quanlity_plan_line_blk);
         q = trans.addQuery(quanlity_plan_line_blk);
         if (!mgr.isEmpty(projNo) ){
             q.addWhereCondition("PROJ_NO = ?");
             q.addParameter("ITEM0_PROJ_NO",projNo); 
         }     
         if (!mgr.isEmpty(planNo) ){
             q.addWhereCondition("PLAN_NO = ? " );
             q.addParameter("ITEM0_PLAN_NO",planNo);
         }  
         if (!mgr.isEmpty(subProjNo)){
            if(!subProjNo.equals("1")){           
               q.addWhereCondition("sub_proj_no like '"+subProjNo+"%' "); 
//             q.addWhereCondition("sub_proj_no IN (SELECT sub_proj_no from IFSAPP.QUANLITY_PLAN_LINE WHERE PROJ_NO = ? AND  PLAN_NO = ? START WITH parent_proj_no  = ? connect by prior sub_proj_no = parent_proj_no) ");
//             q.addParameter("ITEM0_PROJ_NO",projNo);
//             q.addParameter("ITEM0_PLAN_NO",planNo);    
//             q.addParameter("ITEM0_SUB_PROJ_NO", subProjNo);  
         } 
         }
         q.includeMeta("ALL");
         if(mgr.dataTransfered())
            q.addOrCondition(mgr.getTransferedData());
         mgr.submit(trans);    
         if (  quanlity_plan_line_set.countRows() == 0 ){
             quanlity_plan_line_set.clear();
         }
      
   }
   public void newRowITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPBuffer data;
      ASPCommand cmd;

      cmd = trans.addEmptyCommand("ITEM1","QUANLITY_PLAN_LINE_API.New__",quanlity_plan_line_blk);
      cmd.setOption("ACTION","PREPARE");
      cmd.setParameter("ITEM0_PROJ_NO", headset.getValue("PROJ_NO"));
      cmd.setParameter("ITEM0_PLAN_NO", headset.getValue("PLAN_NO"));
      cmd.setParameter("ITEM0_PARENT_PROJ_NO", headset.getValue("SUB_PROJ_NO"));
      trans = mgr.perform(trans);
      data = trans.getBuffer("ITEM1/DATA");
      data.setFieldItem("ITEM0_PROJ_NO",headset.getValue("PROJ_NO"));
      data.setFieldItem("ITEM0_PLAN_NO",headset.getValue("PLAN_NO"));
      data.setFieldItem("ITEM0_PARENT_PROJ_NO",headset.getValue("SUB_PROJ_NO"));
      data.setFieldItem("ITEM0_PROJECT_TYPE_NO",headset.getValue("PROJECT_TYPE_NO"));
      quanlity_plan_line_set.addRow(data);
   }   
   
   public void countFindITEM2()
   {
      ASPManager mgr = getASPManager();
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      ASPQuery q;
      String projNo;
      String planNo;
      String subProjNo;
      projNo = headset.getValueAt(0, "PROJ_NO");
      planNo = headset.getValueAt(0, "PLAN_NO");;
      subProjNo = headset.getValueAt(0, "SUB_PROJ_NO");
      q = trans.addQuery(quanlity_plan_line_blk);
      if (!mgr.isEmpty(projNo) ){
         q.addWhereCondition("PROJ_NO = ?");
         q.addParameter("ITEM0_PROJ_NO",projNo); 
     }     
     if (!mgr.isEmpty(planNo) ){
         q.addWhereCondition("PLAN_NO = ? " );
         q.addParameter("ITEM0_PLAN_NO",planNo);
     }  
     if (!mgr.isEmpty(subProjNo)){
        if(!subProjNo.equals("1")){           
           q.addWhereCondition("sub_proj_no like '"+subProjNo+"%' "); 
//         q.addWhereCondition("sub_proj_no IN (SELECT sub_proj_no from IFSAPP.QUANLITY_PLAN_LINE WHERE PROJ_NO = ? AND  PLAN_NO = ? START WITH parent_proj_no  = ? connect by prior sub_proj_no = parent_proj_no) ");
//         q.addParameter("ITEM0_PROJ_NO",projNo);
//         q.addParameter("ITEM0_PLAN_NO",planNo);    
//         q.addParameter("ITEM0_SUB_PROJ_NO", subProjNo);  
     } 
     }
      q.setSelectList("to_char(count(*)) N");
      mgr.submit(trans);
      quanlity_plan_line_lay.setCountValue(toInt(quanlity_plan_line_set.getValue("N")));
      quanlity_plan_line_set.clear();
   }   

   public void okFindITEM11()
   {
      ASPManager mgr = getASPManager();
      if(headset.countRows() == 0){
         return;
      }
      String luName = headblk.getLUName();//
      String view = headblk.getView();//
      String objid  = headset.getValue("OBJID");
      if(!"".equals(headset.getValue("PROJ_NO"))&&headset.getValue("PROJ_NO") != null){  
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPQuery q;
         ASPCommand  cmd = trans.addCustomCommand("KEYREF", " client_sys.get_key_reference");
         cmd.addParameter("KEYREF", "S", "OUT", null);
         cmd.addParameter("BIZ_LU", "S", "IN", "QuanlityStandardLine");
         cmd.addParameter("BIZ_OBJID", "S", "IN", objid);
         trans = mgr.validate(trans);
         String keyReference = trans.getValue("KEYREF/DATA/KEYREF");
         trans.clear();
         q = trans.addQuery(Pending_doc_reference_object_blk);
         q.addWhereCondition("LU_NAME = ?");
         q.addWhereCondition("KEY_REF = ?");
//         q.addWhereCondition("DOC_CLASS = ?");
         q.addParameter("ITEM1_LU_NAME", "QuanlityStandardLine");
         q.addParameter("ITEM1_KEY_REF", headset.getValue("KEY_REF"));
//         q.addParameter("ITEM1_DOC_CLASS", "5111");  
         q.includeMeta("ALL");
         int headrowno = headset.getCurrentRowNo();
         mgr.querySubmit(trans,Pending_doc_reference_object_blk);
         headset.goTo(headrowno);
      }
   }
   
   public void okFindITEM12()
   {
      ASPManager mgr = getASPManager();
      if(headset.countRows() == 0){
         return;
      }
      String luName = headblk.getLUName();//
      String view = headblk.getView();//
      String objid  = headset.getValue("OBJID");
      if(!"".equals(headset.getValue("PROJ_NO"))&&headset.getValue("PROJ_NO") != null){     
         ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
         ASPQuery q;
         ASPCommand  cmd = trans.addCustomCommand("KEYREF", " client_sys.get_key_reference");
         cmd.addParameter("KEYREF", "S", "OUT", null);
         cmd.addParameter("BIZ_LU", "S", "IN", luName);
         cmd.addParameter("BIZ_OBJID", "S", "IN", objid);
         trans = mgr.validate(trans);
         String keyReference = trans.getValue("KEYREF/DATA/KEYREF");
         trans.clear();
         q = trans.addQuery(Conference_doc_reference_object_blk);
         q.addWhereCondition("LU_NAME = ?");
         q.addWhereCondition("KEY_REF = ?");
//         q.addWhereCondition("DOC_CLASS = ?");
         q.addParameter("ITEM2_LU_NAME", luName);
         q.addParameter("ITEM2_KEY_REF", keyReference);
//         q.addParameter("ITEM2_DOC_CLASS", "HYJY");  
         q.includeMeta("ALL");  
         int headrowno = headset.getCurrentRowNo();
         mgr.querySubmit(trans,Conference_doc_reference_object_blk);
         headset.goTo(headrowno);  
      }
   }
   
   //-----------------------------------------------------------------------------
   //------------------------  Predefines Head ---------------------------
   //-----------------------------------------------------------------------------

   public void  preDefine()
   {
      ASPManager mgr = getASPManager();

      headblk = mgr.newASPBlock("MAIN");
      headblk.addField("OBJID").
              setHidden();
      headblk.addField("OBJVERSION").
              setHidden();
      headblk.addField("OBJSTATE").
              setHidden();
      headblk.addField("OBJEVENTS").
              setHidden();
      headblk.addField("PROJ_NO").
              setHidden().
              setInsertable().
              setLabel("QUANLITYPLANLINEPROJNO: Proj No").
              setSize(50);
      headblk.addField("PLAN_NO").
              setHidden().
              setInsertable().
              setLabel("QUANLITYPLANLINEPLANNO: Plan No").
              setSize(50);
      headblk.addField("PARENT_PROJ_NO").
              setHidden().
              setInsertable().
              setLabel("QUANLITYPLANLINEPARENTPROJNO: Parent Proj No").
              setSize(50);
      headblk.addField("SUB_PROJ_NAME").
              setInsertable().
              setLabel("QUANLITYPLANLINESUBPROJNAME: Sub Proj Name").
              setSize(50);
      headblk.addField("SUB_PROJ_NO").
              setInsertable().
              setLabel("QUANLITYPLANLINESUBPROJNO: Sub Proj No").
              setSize(50);
      headblk.addField("NODE_LEVEL","Number").
              setInsertable().
              setHidden().
              setLabel("QUANLITYPLANLINENODELEVEL: Node Level").
              setSize(30);

      headblk.addField("QUA_STANDARD_NO").
              setInsertable().
              setHidden().
              setLabel("QUANLITYPLANLINEQUASTANDARDNO: Qua Standard No").
              setSize(50);
      headblk.addField("IS_LEAF").
              setInsertable().
              setHidden().
              setLabel("QUANLITYPLANLINEISLEAF: Is Leaf").
              setSize(5);
      headblk.addField("IS_MAIN_CONTROL").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINEISMAINCONTROL: Is Main Control").
              setSize(5);
      headblk.addField("SHOULD_CHECK_NUM","Number").
              setInsertable().
              setLabel("QUANLITYPLANLINESHOULDCHECKNUM: Should Check Num").
              setSize(50);
      headblk.addField("TEMPLET_NO").
              setInsertable().
              setLabel("QUANLITYPLANLINETEMPLETNO: Templet No").
              setSize(50);
      headblk.addField("PROJECT_TYPE_NO").
              setInsertable().
//              setHidden().
              setLabel("QUANLITYPLANLINEPROJECTTYPENO: Project Type No").
              setSize(50);
      headblk.addField("QUA_CLASS_NO").
              setInsertable().
              setMandatory().
              setDynamicLOV("QUA_PROJECT_CLASS","PROJECT_TYPE_NO").
              setLabel("QUANLITYPLANLINEQUACLASSNO: Qua Class No").
              setSize(50);
      headblk.addField("QUA_CLASS_DESC").
              setFunction("QUA_PROJECT_CLASS_API.Get_Description(:PROJECT_TYPE_NO,:QUA_CLASS_NO)").
              setLabel("QUANLITYSTANDARDLINEQUACLASSDESC: Qua Class Desc").
              setReadOnly();      
      mgr.getASPField("QUA_CLASS_NO").setValidation("QUA_CLASS_DESC");
      headblk.addField("CONSTRUCT_ORG").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINECONSTRUCTORG: Construct Org").
              setSize(5);
      headblk.addField("SURVEY_ORG").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINESURVEYORG: Survey Org").
              setSize(5);
      headblk.addField("DESIGN_ORG").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINEDESIGNORG: Design Org").
              setSize(5);
      headblk.addField("SUPERVISION_ORG").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINESUPERVISIONORG: Supervision Org").
              setSize(5);
      headblk.addField("BULIDING_ORG").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINEBULIDINGORG: Buliding Org").
              setSize(5);
      headblk.addField("MANUFACTURE_ORG").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINEMANUFACTUREORG: Manufacture Org").
              setSize(5);
      headblk.addField("STANDARD_PRE").
              setInsertable().
              setLabel("QUANLITYPLANLINESTANDARDPRE: Standard Pre").
              setSize(50);      
      headblk.addField("QUA_MODE_NO").
              setInsertable().
              setDynamicLOV("QUA_CONTROL_MODE").
              setLabel("QUANLITYPLANLINEQUAMODENO: Qua Mode No").
              setSize(50);
      headblk.addField("QUA_MODE_DESC").
              setFunction("Qua_Control_Mode_Api.Get_Description(:QUA_MODE_NO)").
              setLabel("QUANLITYSTANDARDLINEQUAMODEDESC: Qua Mode Desc").
              setReadOnly();      
      mgr.getASPField("QUA_MODE_NO").setValidation("QUA_MODE_DESC");      
      headblk.addField("KEY_REF").
              setHidden().
              setReadOnly().
              setSize(50);


      headblk.addField("ENGINEERING_CATEGORY").
              setInsertable().
              setLabel("QUANLITYPLANLINEENGINEERINGCATEGORY: Engineering Category").
              setSize(20).
              setMaxLength(50);
      headblk.addField("WELDING_JOINT_CATEGORY").
              setInsertable().
              setLabel("QUANLITYPLANLINEWELDINGJOINTCATEGORY: Welding Joint Category").
              setSize(20).
              setMaxLength(50);
      
      headblk.addField("CON_UNIT_TEAM").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINECONUNITTEAM: Con Unit Team").
              setSize(20).
              setMaxLength(50);
      headblk.addField("CON_UNIT_SITE").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINECONUNITSITE: Con Unit Site").
              setSize(20).
              setMaxLength(50);
      headblk.addField("CON_UNIT_QC").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINECONUNITQC: Con Unit QC").
              setSize(20).
              setMaxLength(50);
      headblk.addField("CON_UNIT_PROFE_COMPANY").
              setInsertable().
              setCheckBox("FALSE,TRUE").
              setLabel("QUANLITYPLANLINECONUNITPROFECOMPANY: Con Unit Profe Company").
              setSize(20).
              setMaxLength(50);
      headblk.setView("QUANLITY_PLAN_LINE");
      headblk.defineCommand("QUANLITY_PLAN_LINE_API","Modify__,Remove__");
      headset = headblk.getASPRowSet();
      headbar = mgr.newASPCommandBar(headblk);
      //headbar.disableCommand(headbar.FIND);
      //headbar.disableCommand(headbar.OKFIND);
      headbar.disableCommand(headbar.BACK);
      headbar.disableCommand(headbar.DUPLICATEROW);
      headbar.disableCommand(headbar.FORWARD);
      headbar.disableCommand(headbar.BACKWARD);
      headbar.disableCommand(headbar.SAVENEW); 
      headbar.disableCommand(headbar.NEWROW);
      headbar.addCustomCommand("activateITEM1",mgr.translate("QUAPLANLINE: Qua Plan Line"));
      headbar.addCustomCommand("activateITEM2",mgr.translate("QUAPLANLINESUB: Qua Plan Line Sub"));
      headbar.addCustomCommand("activateITEM11",mgr.translate("QUAPLANLINEPENDDOC: Qua Plan Line Pend Doc"));
      headbar.addCustomCommand("activateITEM12",mgr.translate("QUAPLANLINEDOC: Qua Plan Line Doc"));
      
      headbar.addCustomCommand("addQuanlityItem",mgr.translate("ADDQUANLITYITEM: Add Quanlity Item"));
      
      headtbl = mgr.newASPTable(headblk);
      headtbl.setTitle("QUANLITYPLANLINETBLHEAD: Quanlity Plan Lines");
      headtbl.enableRowSelect();
      headtbl.setWrap();
      headlay = headblk.getASPBlockLayout();
      headlay.setDefaultLayoutMode(headlay.SINGLE_LAYOUT);
      headlay.setDialogColumns(2);

      quanlity_plan_line_blk = mgr.newASPBlock("ITEM1");
      quanlity_plan_line_blk.addField("ITEM0_OBJID").
                             setHidden().
                             setDbName("OBJID");
      quanlity_plan_line_blk.addField("ITEM0_OBJVERSION").
                             setHidden().
                             setDbName("OBJVERSION");
      quanlity_plan_line_blk.addField("ITEM0_OBJSTATE").
                             setHidden().
                             setDbName("OBJSTATE");
      quanlity_plan_line_blk.addField("ITEM0_OBJEVENTS").
                             setHidden().
                             setDbName("OBJEVENTS");
      quanlity_plan_line_blk.addField("ITEM0_PROJ_NO").
                             setDbName("PROJ_NO").
                             setHidden().
                             setInsertable().
                             setLabel("QUANLITYPLANLINEITEM0PROJNO: Proj No").
                             setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_PROJECT_TYPE_NO").
                            setDbName("PROJECT_TYPE_NO").
                            setInsertable().
                            setHidden().
                            setLabel("QUANLITYPLANLINEPROJECTTYPENO: Project Type No").
                            setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_PLAN_NO").
                             setDbName("PLAN_NO").
                             setHidden().
                             setMandatory().
                             setInsertable().
                             setLabel("QUANLITYPLANLINEITEM0PLANNO: Plan No").
                             setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_PARENT_PROJ_NO").
                             setDbName("PARENT_PROJ_NO").
                             setHidden().
                             setInsertable().
                             setLabel("QUANLITYPLANLINEPARENTPROJNO: Parent Proj No").
                             setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_SUB_PROJ_NAME").
                             setDbName("SUB_PROJ_NAME").
                             setInsertable().
                             setMandatory().
                             setLabel("QUANLITYPLANLINESUBPROJNAME: Sub Proj Name").
                             setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_SUB_PROJ_NO").
                             setDbName("SUB_PROJ_NO").
//                             setReadOnly().
                             setInsertable().
                             setLabel("QUANLITYPLANLINESUBPROJNO: Sub Proj No").
                             setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_NODE_LEVEL","Number").
                             setDbName("NODE_LEVEL").
                             setInsertable().
                             setHidden().
                             setLabel("QUANLITYPLANLINENODELEVEL: Node Level").
                             setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_IS_LEAF").
                             setDbName("IS_LEAF").
                             setHidden().
                             setInsertable().
                             setLabel("QUANLITYPLANLINEISLEAF: Is Leaf").
                             setSize(5);
      quanlity_plan_line_blk.addField("ITEM0_IS_MAIN_CONTROL").
                             setDbName("IS_MAIN_CONTROL").
                             setInsertable().
                             setCheckBox("FALSE,TRUE").
                             setLabel("QUANLITYPLANLINEISMAINCONTROL: Is Main Control").
                             setSize(5);
      quanlity_plan_line_blk.addField("ITEM0_SHOULD_CHECK_NUM","Number").
                             setDbName("SHOULD_CHECK_NUM").
                             setInsertable().
                             setMandatory().
                             setLabel("QUANLITYPLANLINESHOULDCHECKNUM: Should Check Num").
                             setSize(50);
    
      quanlity_plan_line_blk.addField("ITEM0_QUA_CLASS_NO").
                             setDbName("QUA_CLASS_NO").
                             setDynamicLOV("QUA_PROJECT_CLASS","ITEM0_PROJECT_TYPE_NO").
                             setInsertable().
                             setMandatory().
                             setLabel("QUANLITYPLANLINEQUACLASSNO: Qua Class No").
                             setSize(50);      
      quanlity_plan_line_blk.addField("ITEM0_QUA_CLASS_DESC").
                             setFunction("QUA_PROJECT_CLASS_API.Get_Description (:ITEM0_PROJECT_TYPE_NO,:ITEM0_QUA_CLASS_NO)").
                             setLabel("QUANLITYSTANDARDLINEQUACLASSDESC: Qua Class Desc").
                             setReadOnly();      
      mgr.getASPField("ITEM0_QUA_CLASS_NO").setValidation("ITEM0_QUA_CLASS_DESC");
      quanlity_plan_line_blk.addField("ITEM0_QUA_MODE_NO").
                             setDbName("QUA_MODE_NO").
                             setDynamicLOV("QUA_CONTROL_MODE").
                             setInsertable().
                             setLabel("QUANLITYPLANLINEQUAMODENO: Qua Mode No").
                             setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_QUA_MODE_DESC").
                             setFunction("Qua_Control_Mode_Api.Get_Description(:ITEM0_QUA_MODE_NO)").
                             setLabel("QUANLITYSTANDARDLINEQUAMODEDESC: Qua Mode Desc").
                             setReadOnly();      
      mgr.getASPField("ITEM0_QUA_MODE_NO").setValidation("ITEM0_QUA_MODE_DESC");
      quanlity_plan_line_blk.addField("ITEM0_TEMPLET_NO").
                             setDbName("TEMPLET_NO").
                             setInsertable().
                             setLabel("QUANLITYPLANLINETEMPLETNO: Templet No").
                             setSize(50);
      quanlity_plan_line_blk.addField("ITEM0_CONSTRUCT_ORG").
                             setDbName("CONSTRUCT_ORG").
                             setInsertable().
                             setCheckBox("FALSE,TRUE").
                             setLabel("QUANLITYPLANLINEITEM0CONSTRUCTORG: Construct Org").
                             setSize(5);
      quanlity_plan_line_blk.addField("ITEM0_SURVEY_ORG").
                             setDbName("SURVEY_ORG").
                             setInsertable().
                             setCheckBox("FALSE,TRUE").
                             setLabel("QUANLITYPLANLINESURVEYORG: Survey Org").
                             setSize(5);
      quanlity_plan_line_blk.addField("ITEM0_DESIGN_ORG").
                             setDbName("DESIGN_ORG").
                             setInsertable().
                             setCheckBox("FALSE,TRUE").
                             setLabel("QUANLITYPLANLINEDESIGNORG: Design Org").
                             setSize(5);
      quanlity_plan_line_blk.addField("ITEM0_SUPERVISION_ORG").
                             setDbName("SUPERVISION_ORG").
                             setInsertable().
                             setCheckBox("FALSE,TRUE").
                             setLabel("QUANLITYPLANLINESUPERVISIONORG: Supervision Org").
                             setSize(5);
      quanlity_plan_line_blk.addField("ITEM0_BULIDING_ORG").
                             setDbName("BULIDING_ORG").
                             setInsertable().
                             setCheckBox("FALSE,TRUE").
                             setLabel("QUANLITYPLANLINEBULIDINGORG: Buliding Org").
                             setSize(5);
      quanlity_plan_line_blk.addField("ITEM0_MANUFACTURE_ORG").
                             setDbName("MANUFACTURE_ORG").
                             setInsertable().
                             setCheckBox("FALSE,TRUE").
                             setLabel("QUANLITYPLANLINEMANUFACTUREORG: Manufacture Org").
                             setSize(5);
      quanlity_plan_line_blk.addField("ITEM0_STANDARD_PRE").
                             setDbName("STANDARD_PRE").
                             setInsertable().
                             setHidden().
                             setLabel("QUANLITYPLANLINEITEM0STANDARDPRE: Standard Pre").
                             setSize(50);
      
      quanlity_plan_line_blk.addField("HAS_NODE").
                             setLabel("QUANLITYPLANLINEITEM0STATE: HAS_NODE").
                             setHidden().
                             setFunction("QUANLITY_PLAN_LINE_API.Fun_PlanLine_HasNode__ ( :ITEM0_PROJ_NO,:ITEM0_PLAN_NO,:ITEM0_SUB_PROJ_NO)").
                             setSize(30);
      
      quanlity_plan_line_blk.setView("QUANLITY_PLAN_LINE");
      quanlity_plan_line_blk.defineCommand("QUANLITY_PLAN_LINE_API","New__,Modify__,Remove__");
      
      quanlity_plan_line_set = quanlity_plan_line_blk.getASPRowSet();
      quanlity_plan_line_bar = mgr.newASPCommandBar(quanlity_plan_line_blk);
      //quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.FIND);
      //quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.OKFIND);
      quanlity_plan_line_bar.defineCommand(quanlity_plan_line_bar.OKFIND,"okFindITEM2");
      quanlity_plan_line_bar.defineCommand(quanlity_plan_line_bar.NEWROW, "newRowITEM2");
      quanlity_plan_line_bar.defineCommand(quanlity_plan_line_bar.COUNTFIND,"countFindITEM2");
      quanlity_plan_line_tbl = mgr.newASPTable(quanlity_plan_line_blk);
      quanlity_plan_line_tbl.setTitle("QUACONTROLMODETBLHEAD: Quatity Control Modes");
      quanlity_plan_line_tbl.enableRowSelect();
      quanlity_plan_line_tbl.setWrap();
      quanlity_plan_line_lay = quanlity_plan_line_blk.getASPBlockLayout();
      quanlity_plan_line_lay.setDefaultLayoutMode(quanlity_plan_line_lay.MULTIROW_LAYOUT);
      quanlity_plan_line_lay.setDataSpan("ITEM0_TEMPLET_NO", 5);
          
      Pending_doc_reference_object_blk = mgr.newASPBlock("ITEM2");
      Pending_doc_reference_object_blk.addField("ITEM1_VIEW_FILE").
                                       setFunction("''").
                                       setReadOnly().  
                                       unsetQueryable().
                                       setLabel("DOCSENDTRANSREFERENCEBLKVIEWFILE: View File").
                                       setHyperlink("../docmaw/EdmMacro.page?PROCESS_DB=VIEW&DOC_TYPE=ORIGINAL", "ITEM1_DOC_CLASS DOC_CLASS,ITEM1_DOC_NO DOC_NO,ITEM1_DOC_SHEET DOC_SHEET,ITEM1_DOC_REV DOC_REV", "NEWWIN").
                                       setAsImageField();
      Pending_doc_reference_object_blk.addField("ITEM1_DOC_CLASS").setDbName("DOC_CLASS").setLabel("DOCSENDTRANSREFERENCEBLKDOCCLASS: Doc Class");
      Pending_doc_reference_object_blk.addField("ITEM1_DOC_NO").setDbName("DOC_NO").setLabel("DOCSENDTRANSREFERENCEBLKDOCNO: Doc No").setHidden();
      Pending_doc_reference_object_blk.addField("ITEM1_DOC_SHEET").setDbName("DOC_SHEET").setLabel("DOCSENDTRANSREFERENCEBLKDOCSHEET: Doc sheet").setHidden();
      Pending_doc_reference_object_blk.addField("ITEM1_DOC_REV").setDbName("DOC_REV").setLabel("DOCSENDTRANSREFERENCEBLKDOCREV: Doc Rev").setHidden();
      Pending_doc_reference_object_blk.addField("ITEM1_LU_NAME").setDbName("LU_NAME").setLabel("DOCSENDTRANSREFERENCEBLKLUNAME: Lu Name").setHidden();
      Pending_doc_reference_object_blk.addField("ITEM1_KEY_REF").setDbName("KEY_REF").setLabel("DOCSENDTRANSREFERENCEBLKKEYREF: Key Ref").setHidden();
      Pending_doc_reference_object_blk.addField("ITEM1_KEY_VALUE").setDbName("KEY_VALUE").setLabel("DOCSENDTRANSREFERENCEBLKKEYVALUE: Key Value").setHidden();
      Pending_doc_reference_object_blk.addField("ITEM1_REV_TITLE").setDbName("DOC_TITLE").setLabel("DOCSENDTRANSREFERENCEBLKREVTITLE: Rev Title").setFieldHyperlink("../docmaw/DocIssue.page", "ITEM1_PAGE_URL","ITEM1_DOC_CLASS DOC_CLASS,ITEM1_DOC_NO DOC_NO,ITEM1_DOC_SHEET DOC_SHEET,ITEM1_DOC_REV DOC_REV");
      Pending_doc_reference_object_blk.addField("ITEM1_DOC_CODE").setDbName("DOC_CODE").setLabel("DOCSENDTRANSREFERENCEBLKDOCCODE: Doc Code");
      Pending_doc_reference_object_blk.addField("ITEM1_SUB_CLASS").setDbName("SUB_CLASS").setLabel("DOCSENDTRANSREFERENCEBLKSUBCLASS: Sub Class");
      Pending_doc_reference_object_blk.addField("ITEM1_PAGE_URL").setFunction("nvl(DOC_CLASS_API.Get_Page_Url(:ITEM1_DOC_CLASS), DOC_SUB_CLASS_API.Get_Page_Url(:ITEM1_DOC_CLASS,:ITEM1_SUB_CLASS))").setHidden();
      Pending_doc_reference_object_blk.addField("ITEM1_IS_ELE_DOC").
                                       setFunction("EDM_FILE_API.Have_Edm_File(:ITEM1_DOC_CLASS,:ITEM1_DOC_NO,:ITEM1_DOC_SHEET,:ITEM1_DOC_REV)").
                                       setHidden().
                                       setLabel("DOCSENDTRANSREFERENCEBLKISELEDOC: Is Ele Doc").
                                       setSize(5);
      
      Pending_doc_reference_object_blk.setView("DOC_REFERENCE_OBJECT");
      Pending_doc_reference_object_blk.setMasterBlock(headblk);
      Pending_doc_reference_object_set = Pending_doc_reference_object_blk.getASPRowSet();
      Pending_doc_reference_object_bar = mgr.newASPCommandBar(Pending_doc_reference_object_blk);
      Pending_doc_reference_object_bar.defineCommand(Pending_doc_reference_object_bar.OKFIND, "okFindITEM11");
      Pending_doc_reference_object_tbl = mgr.newASPTable(Pending_doc_reference_object_blk);
      Pending_doc_reference_object_tbl.enableRowSelect();
      Pending_doc_reference_object_tbl.setWrap();
      Pending_doc_reference_object_lay = Pending_doc_reference_object_blk.getASPBlockLayout();
      Pending_doc_reference_object_lay.setDefaultLayoutMode(Pending_doc_reference_object_lay.MULTIROW_LAYOUT);
      
      Conference_doc_reference_object_blk = mgr.newASPBlock("ITEM3");
      Conference_doc_reference_object_blk.addField("ITEM2_VIEW_FILE").
                                          setFunction("''").
                                          setReadOnly().
                                          unsetQueryable().
                                          setLabel("DOCSENDTRANSREFERENCEBLKVIEWFILE: View File").
                                          setHyperlink("../docmaw/EdmMacro.page?PROCESS_DB=VIEW&DOC_TYPE=ORIGINAL", "ITEM2_DOC_CLASS DOC_CLASS,ITEM2_DOC_NO DOC_NO,ITEM2_DOC_SHEET DOC_SHEET,ITEM2_DOC_REV DOC_REV", "NEWWIN").
                                          setAsImageField();
      Conference_doc_reference_object_blk.addField("ITEM2_DOC_CLASS").setDbName("DOC_CLASS").setLabel("DOCSENDTRANSREFERENCEBLKDOCCLASS: Doc Class");
      Conference_doc_reference_object_blk.addField("ITEM2_DOC_NO").setDbName("DOC_NO").setLabel("DOCSENDTRANSREFERENCEBLKDOCNO: Doc No").setHidden();
      Conference_doc_reference_object_blk.addField("ITEM2_DOC_SHEET").setDbName("DOC_SHEET").setLabel("DOCSENDTRANSREFERENCEBLKDOCSHEET: Doc sheet").setHidden();
      Conference_doc_reference_object_blk.addField("ITEM2_DOC_REV").setDbName("DOC_REV").setLabel("DOCSENDTRANSREFERENCEBLKDOCREV: Doc Rev").setHidden();
      Conference_doc_reference_object_blk.addField("ITEM2_LU_NAME").setDbName("LU_NAME").setLabel("DOCSENDTRANSREFERENCEBLKLUNAME: Lu Name").setHidden();
      Conference_doc_reference_object_blk.addField("ITEM2_KEY_REF").setDbName("KEY_REF").setLabel("DOCSENDTRANSREFERENCEBLKKEYREF: Key Ref").setHidden();
      Conference_doc_reference_object_blk.addField("ITEM2_KEY_VALUE").setDbName("KEY_VALUE").setLabel("DOCSENDTRANSREFERENCEBLKKEYVALUE: Key Value").setHidden();
      Conference_doc_reference_object_blk.addField("ITEM2_REV_TITLE").setDbName("DOC_TITLE").setLabel("DOCSENDTRANSREFERENCEBLKREVTITLE: Rev Title").setFieldHyperlink("../docmaw/DocIssue.page", "ITEM2_PAGE_URL","ITEM2_DOC_CLASS DOC_CLASS,ITEM2_DOC_NO DOC_NO,ITEM2_DOC_SHEET DOC_SHEET,ITEM2_DOC_REV DOC_REV");
      Conference_doc_reference_object_blk.addField("ITEM2_DOC_CODE").setDbName("DOC_CODE").setLabel("DOCSENDTRANSREFERENCEBLKDOCCODE: Doc Code");
      Conference_doc_reference_object_blk.addField("ITEM2_SUB_CLASS").setDbName("SUB_CLASS").setLabel("DOCSENDTRANSREFERENCEBLKSUBCLASS: Sub Class");
      Conference_doc_reference_object_blk.addField("ITEM2_PAGE_URL").setFunction("nvl(DOC_CLASS_API.Get_Page_Url(:ITEM2_DOC_CLASS), DOC_SUB_CLASS_API.Get_Page_Url(:ITEM2_DOC_CLASS,:ITEM2_SUB_CLASS))").setHidden();
      Conference_doc_reference_object_blk.addField("ITEM2_IS_ELE_DOC").
                                          setFunction("EDM_FILE_API.Have_Edm_File(:ITEM2_DOC_CLASS,:ITEM2_DOC_NO,:ITEM2_DOC_SHEET,:ITEM2_DOC_REV)").
                                          setHidden().
                                          setLabel("DOCSENDTRANSREFERENCEBLKISELEDOC: Is Ele Doc").
                                          setSize(5);    
      
      Conference_doc_reference_object_blk.setView("DOC_REFERENCE_OBJECT");
      Conference_doc_reference_object_blk.setMasterBlock(headblk);
      Conference_doc_reference_object_set = Conference_doc_reference_object_blk.getASPRowSet();
      Conference_doc_reference_object_bar = mgr.newASPCommandBar(Conference_doc_reference_object_blk);
      Conference_doc_reference_object_bar.defineCommand(Conference_doc_reference_object_bar.OKFIND, "okFindITEM12");
      Conference_doc_reference_object_tbl = mgr.newASPTable(Conference_doc_reference_object_blk);
      Conference_doc_reference_object_tbl.enableRowSelect();
      Conference_doc_reference_object_tbl.setWrap();
      Conference_doc_reference_object_lay = Conference_doc_reference_object_blk.getASPBlockLayout();
      Conference_doc_reference_object_lay.setDefaultLayoutMode(Conference_doc_reference_object_lay.MULTIROW_LAYOUT);
     
      
      headlay.defineGroup("Main", "SUB_PROJ_NAME,SUB_PROJ_NO,PROJECT_TYPE_NO,QUA_STANDARD_NO,IS_MAIN_CONTROL,SHOULD_CHECK_NUM,QUA_CLASS_NO,QUA_CLASS_DESC,QUA_MODE_NO,QUA_MODE_DESC,TEMPLET_NO,ENGINEERING_CATEGORY,WELDING_JOINT_CATEGORY", false, true);
      headlay.defineGroup(mgr.translate("QUANLITYSTANDARDLINETBLITEMORG: Check Org Info"),"CONSTRUCT_ORG,SURVEY_ORG,DESIGN_ORG,SUPERVISION_ORG,BULIDING_ORG,MANUFACTURE_ORG,CON_UNIT_TEAM,CON_UNIT_SITE,CON_UNIT_QC,CON_UNIT_PROFE_COMPANY", true, true);
    
      tabs = newASPTabContainer("TAB1");      
      tabs.addTab("QUAPLANLINE: Qua Plan Line","javascript:commandSet('MAIN.activateITEM1','')");
      tabs.addTab("QUAPLANLINESUB: Qua Plan Line Sub","javascript:commandSet('MAIN.activateITEM2','')");
      tabs.setContainerSpace(0);
      tabs.setLeftTabSpace(0);
      tabs.setTabWidth(68);
//      tabs.setTableVisibility(false);        

      item_tabs = newASPTabContainer("TAB2");
      item_tabs.addTab("QUAPLANLINEPENDDOC: Qua Plan Line Pend Doc","javascript:commandSet('MAIN.activateITEM11','')");
      item_tabs.addTab("QUAPLANLINEDOC: Qua Plan Line Doc","javascript:commandSet('MAIN.activateITEM12','')");
      
      headbar.removeCustomCommand("activateITEM1");
      headbar.removeCustomCommand("activateITEM2");
      headbar.removeCustomCommand("activateITEM11");
      headbar.removeCustomCommand("activateITEM12");

   }
   
   public void addQuanlityItem() throws FndException{
      ASPManager mgr = getASPManager();
      ASPCommand cmd = mgr.newASPCommand(); 
      ASPTransactionBuffer trans = mgr.newASPTransactionBuffer();
      headset.storeSelections();  
      if (headlay.isSingleLayout())
         headset.selectRow();
      ASPBuffer selected_fields=headset.getSelectedRows("PROJECT_TYPE_NO,PROJ_NO,PLAN_NO,SUB_PROJ_NO,QUA_STANDARD_NO");
      proj_type = headset.getValue("PROJECT_TYPE_NO");
      plan_no    = headset.getValue("PLAN_NO");
      project_no    = headset.getValue("PROJ_NO");   
      sub_proj_no    = headset.getValue("SUB_PROJ_NO");       
      standard_no    = headset.getValue("QUA_STANDARD_NO");        
      callNewWindow("QuaStandardFindTree.page", selected_fields);
   }
         
   private void callNewWindow(String transfer_page, ASPBuffer buff) throws FndException 
   {
       String id;
       ASPManager mgr = getASPManager();

        id=buff.getBufferAt(0).getValueAt(0);
        ASPContext ctx = mgr.getASPContext();
        ctx.setGlobal("PROJ_NO",project_no);
        ctx.setGlobal("PLAN_NO",plan_no);
        ctx.setGlobal("SUB_PROJ_NO",sub_proj_no);
        ctx.setGlobal("STANDARD_NO",standard_no);
        project_no = buff.getBufferAt(0).getValueAt(1);
        plan_no = buff.getBufferAt(0).getValueAt(2);
        sub_proj_no = buff.getBufferAt(0).getValueAt(3);
        standard_no = buff.getBufferAt(0).getValueAt(4);

      String url = transfer_page+"?USERCOMMAND=submitTree2&PROJ_NO="+project_no+"&PLAN_NO="+plan_no+"&PROJECT_TYPE_NO="+id+"&STANDARD_NO="+standard_no+"&SUB_PROJ_NO="+sub_proj_no;
      appendDirtyJavaScript("showNewBrowser_('"+ url + "', 550, 550, 'YES'); \n");
   }

   public void  adjust()
   {
      ASPManager mgr = getASPManager();     
      String has_node = "";
     /* 把所有编辑、新增功能都保留
      * if ((tabs.getActiveTab() == 2) && (quanlity_plan_line_set.countRows() > 0)){
         has_node = quanlity_plan_line_set.getValueAt(quanlity_plan_line_set.getCurrentRowNo(), "HAS_NODE");
         if(!"".equals(has_node)&&has_node != null){
            if(Integer.parseInt(has_node) > 0){
               quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.DELETE);
               quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.EDITROW);
               quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.NEWROW);
            }
         }else{
            quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.DELETE);
            quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.EDITROW);
            quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.NEWROW);
         }
      }
      if ((tabs.getActiveTab() == 2) && (quanlity_plan_line_set.countRows() == 0)){
         quanlity_plan_line_bar.disableCommand(quanlity_plan_line_bar.NEWROW);
      }*/
   }
   
   public String tabsInit()
   {
      return(tabs.showTabsInit());
   }

   public String tabsFinish()
   {
      return(tabs.showTabsFinish());
   } 

   public String itemtabsInit()
   {
      return(item_tabs.showTabsInit());
   }

   public String itemtabsFinish()
   {
      return(item_tabs.showTabsFinish());
   }  

   public void activateITEM1() {
       tabs.setActiveTab(1);  
       okFind(); 
   }
   public void activateITEM2() {
       tabs.setActiveTab(2); 
       okFindITEM2();
   }      

   public void activateITEM11() {
      item_tabs.setActiveTab(1);  
      okFindITEM11();
  }   
   
   public void activateITEM12() {
      item_tabs.setActiveTab(2);  
      okFindITEM12();
  }
   
   //-----------------------------------------------------------------------------
   //------------------------  Presentation functions  ---------------------------
   //-----------------------------------------------------------------------------

   protected String getDescription()
   {
      return null;
   }
  

   protected String getTitle()
   {
      return null;
   }
  

   protected String getImageFieldTag(ASPField imageField, ASPRowSet rowset, int rowNum) throws FndException
   {
      ASPManager mgr = getASPManager();
      String imgSrc = mgr.getASPConfig().getImagesLocation();
      if (rowset.countRows() > 0)
      {
         if(("ITEM1_VIEW_FILE").equals(imageField.getName()))
         {
            if ("TRUE".equals(rowset.getValueAt(rowNum, "ITEM1_IS_ELE_DOC")))
            {
               imgSrc += "folder.gif";
               return "<img src=\""+imgSrc+"\" height=\"16\" width=\"16\" border=\"0\">";
            }
            else
            {
               return "";
            }
        }else if ("ITEM2_VIEW_FILE".equals(imageField.getName()))
        {
            if ("TRUE".equals(rowset.getValueAt(rowNum, "ITEM2_IS_ELE_DOC")))
            {
               imgSrc += "folder.gif";
               return "<img src=\""+imgSrc+"\" height=\"16\" width=\"16\" border=\"0\">";
            }    
            else
            {
               return "";
            } 
        }    
    }
     return "" ;        
  }
   
//   protected void printContents() throws FndException
//   {
//          appendToHTML(tabsInit());
//
//          if (tabs.getActiveTab() == 1){
//             appendToHTML(headlay.show());
//             if (  (headlay.isSingleLayout() || headlay.isCustomLayout())) {  
//                appendToHTML(itemtabsInit());
//                if (item_tabs.getActiveTab() == 1  ) 
//                {
//                   appendToHTML(Pending_doc_reference_object_lay.show());
//                }else if (item_tabs.getActiveTab() == 2  ) 
//                   appendToHTML(Conference_doc_reference_object_lay.show());
//                appendToHTML(itemtabsFinish());
//             }
//          }
//          else if (tabs.getActiveTab() == 2)
//             appendToHTML(quanlity_plan_line_lay.show());
//                      
//          appendToHTML(tabsFinish());       
//     
//   }     
  /* protected AutoString getContents() throws FndException
   {
      AutoString out = getOutputStream();
      out.clear();
      ASPManager mgr = getASPManager();
      ASPForm frm = mgr.getASPForm();
      ASPHTMLFormatter fmt = mgr.newASPHTMLFormatter();
      out.append("<html>\n");
      out.append("<head>\n");
      out.append(mgr.generateHeadTag(""));
      out.append("</head>\n");
      out.append("<body ");
      out.append(">\n");
      out.append("<form ");
      out.append(mgr.generateFormTag());
      out.append(">\n");
      
      appendToHTML(tabsInit());

      if (tabs.getActiveTab() == 1){
         appendToHTML(headlay.show());
      }
      else if (tabs.getActiveTab() == 2)
         appendToHTML(quanlity_plan_line_lay.show());
                  
      appendToHTML(tabsFinish());    
      
      out.append(mgr.endPresentation());
      out.append("</form>\n");
      out.append("</body>\n");
      out.append("</html>");   
      
      return out;      
   }*/

   protected AutoString getContents() throws FndException{
      ASPManager mgr = getASPManager();
      AutoString out = getOutputStream();
      out.clear();  
      out.append("<html>\n");
      out.append("<head>\n");
      out.append(mgr.generateHeadTag(""));
      out.append("</head>\n");
      out.append("<body ");
      out.append(mgr.generateBodyTag());
      out.append(">\n");
      out.append("<form ");
      out.append(mgr.generateFormTag());
      out.append(">\n");
      out.append("\n");
      
      appendToHTML(tabsInit());

      if (tabs.getActiveTab() == 1){
         appendToHTML(headlay.show());
         if (  (headlay.isSingleLayout() || headlay.isCustomLayout())) {  
            appendToHTML(itemtabsInit());
            if (item_tabs.getActiveTab() == 1  ) 
            {
               appendToHTML(Pending_doc_reference_object_lay.show());
            }else if (item_tabs.getActiveTab() == 2  ) 
               appendToHTML(Conference_doc_reference_object_lay.show());
            appendToHTML(itemtabsFinish());
         }
      }
      else if (tabs.getActiveTab() == 2)
         appendToHTML(quanlity_plan_line_lay.show());
                  
      appendToHTML(tabsFinish());       
 
      
      appendDirtyJavaScript("function refreshTree()\n");
      appendDirtyJavaScript("{\n");
      appendDirtyJavaScript("   parent_url = this.parent.location.href;\n");
      appendDirtyJavaScript("  url_str = this.parent.frames[\"contents\"].location.href;\n");  
      appendDirtyJavaScript("        this.parent.frames[\"contents\"].location.href = url_str;\n");
      appendDirtyJavaScript("}\n");    
     
      out.append(mgr.endPresentation());
      out.append("</form>\n");
      out.append("</body>\n");
      out.append("</html>");
      return out;
 }

}
